<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>[Lua5.4.4源码]结构分析 | frog&#39;s Blog</title>
<meta name="keywords" content="">
<meta name="description" content="lua源码结构分析">
<meta name="author" content="
作者:&nbsp;frog">
<link rel="canonical" href="https://frog-game.github.io/posts/read/lua5.4.4jiegoufenxi/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8b1bcfe952e1e1a78b44fa99f358fddf187aee65873bbc85ca10d6f18a3bff33.css" integrity="sha256-ixvP6VLh4aeLRPqZ81j93xh67mWHO7yFyhDW8Yo7/zM=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
        onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://frog-game.github.io/img/Q.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://frog-game.github.io/img/Q.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://frog-game.github.io/img/Q.gif">
<link rel="apple-touch-icon" href="https://frog-game.github.io/img/Q.gif">
<link rel="mask-icon" href="https://frog-game.github.io/img/Q.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta property="og:title" content="[Lua5.4.4源码]结构分析" />
<meta property="og:description" content="lua源码结构分析" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://frog-game.github.io/posts/read/lua5.4.4jiegoufenxi/" />
<meta property="og:image" content="https://frog-game.github.io/posts/read/lua5.4.4jiegoufenxi/image-20230122214914018.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-22T01:30:29&#43;08:00" />
<meta property="article:modified_time" content="2022-01-22T01:30:29&#43;08:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://frog-game.github.io/posts/read/lua5.4.4jiegoufenxi/image-20230122214914018.png" />
<meta name="twitter:title" content="[Lua5.4.4源码]结构分析"/>
<meta name="twitter:description" content="lua源码结构分析"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "📚文章",
      "item": "https://frog-game.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "📕 阅读",
      "item": "https://frog-game.github.io/posts/read/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "[Lua5.4.4源码]结构分析",
      "item": "https://frog-game.github.io/posts/read/lua5.4.4jiegoufenxi/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "[Lua5.4.4源码]结构分析",
  "name": "[Lua5.4.4源码]结构分析",
  "description": "lua源码结构分析",
  "keywords": [
    ""
  ],
  "articleBody": "lua简介 lua 很小\n将lua添加到应用程序不会让代码膨胀,也不会有很多的第三方库,繁琐的配置,很容易就能键入到你的应用程序当中\nLua 5.4.4的压缩包含源代码和文档，压缩值为353K，未压缩值为1.3M。源代码包含大约30000行c语言。在64位Linux下，用所有标准Lua库构建的Lua解释器占用281K, Lua库占用468K\nlua是可移植性\nlua以一个小包的形式发布,可以在所有具有标准c编译器的平台上开箱即用\nlua速度很快\nlua在经过不断的版本迭代现在lua5.4.4上应用分代GC和增量GC GC这块已经不是什么卡壳点,还有TBC局部变量,元表提供的GC元方法,等等一些新特性能够让你更好的优化自己项目的性能\nlua已经经过很多应用和游戏的验证\n比如魔兽世界,愤怒的小鸟,巴西数字电视的ginga中间件,还有skynet的actor方式的微服务框架\nlua 嵌入\nlua可以很方便的和c,c++ 语言进行嵌入,还用于Java c# Smalltalk Fortran Ada Erlang，甚至其他脚本语言(如Perl和Ruby)编写的程序\n下载 本人已经在GitHub上对lua作者的源码进行大部分注解,后面还会逐步继续完善\nlua-5.4.4-每行都加注释版本\nlua 源码结构 虚拟机运转的核心功能 文件 作用 lapi.c Lua API。实现大量的Lua C API（lua_ *函数） ldebug.c 调试接口 ldo.c 函数调用以及栈管理 lfunc.c 函数原型及闭包管理 lgc.c 垃圾回收 lmem.c 内存管理接口[luaM_realloc / luaM_growaux_] lobject.c 对象操作的一些函数。包括数据类型\u003c-\u003e字符串转换 lstate.c 状态机 管理全局信息,和状态机相关的逻辑 lstring.c 字符串池 ltable.c 表类型的相关操作。Lua表（哈希） ltm.c 标记方法。实现从对象访问元方法。 lvm.c 虚拟机。执行字节码（luaV_execute）。还公开了lapi.c使用的一些功能（例如luaV_concat） lzio.c 通用的缓冲输入流接口 内嵌库 文件 作用 lauxlib.c c库编写用到的辅助函数库 lbaselib.c lua基础库 lcorolib.c 协程库 lctype.c 标准库中ctype相关实现 ldblib.c Debug库 linit.c 内嵌库的初始化 liolib.c IO库 lmathlib.c 数学库 loadlib.c 动态扩展库管理 loslib.c OS库 lstrlib.c 字符串库 ltablib.c 表处理库 源代码解析以及预编译字节码 文件 作用 lcode.c Lua的代码生成器。由lparser.c使用 ldump.c 序列化预编译的Lua字节码 llex.c 词法分析器。由lparser.c使用 lparser.c 解析器 lundump.c 还原预编译的字节码 可执行的解析器，字节码编译器 文件 作用 lua.c Lua独立解释器 luac.c Lua编译器（将字节码保存到文件中；还列出字节码） ",
  "wordCount" : "986",
  "inLanguage": "en",
  "image":"https://frog-game.github.io/posts/read/lua5.4.4jiegoufenxi/image-20230122214914018.png","datePublished": "2022-01-22T01:30:29+08:00",
  "dateModified": "2022-01-22T01:30:29+08:00",
  "author":[{
    "@type": "Person",
    "name": "frog"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://frog-game.github.io/posts/read/lua5.4.4jiegoufenxi/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "frog's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://frog-game.github.io/img/Q.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>



<script async src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>


<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://frog-game.github.io/" accesskey="h" title="frog&#39;s Blog (Alt + H)">
            <img src="https://frog-game.github.io/img/Q.gif" alt="logo" aria-label="logo"
                 height="35">frog&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://frog-game.github.io/search" title="🔍 搜索 (Alt &#43; /)" accesskey=/>
                <span>🔍 搜索</span>
                </a>
            </li>
            <li>
                <a href="https://frog-game.github.io/" title="🏠 主页">
                <span>🏠 主页</span>
                </a>
            </li>
            <li>
                <a href="https://frog-game.github.io/posts" title="📚 文章">
                <span>📚 文章</span>
                </a>
            </li>
            <li>
                <a href="https://frog-game.github.io/tags" title="🧩 标签">
                <span>🧩 标签</span>
                </a>
            </li>
            <li>
                <a href="https://frog-game.github.io/archives/" title="⏱ 时间轴">
                <span>⏱ 时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://frog-game.github.io/about" title="🙋🏻‍♂️ 关于">
                <span>🙋🏻‍♂️ 关于</span>
                </a>
            </li>
            <li>
                <a href="https://frog-game.github.io/links" title="🤝 友链">
                <span>🤝 友链</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs"><a href="https://frog-game.github.io/">主页</a>&nbsp;»&nbsp;<a href="https://frog-game.github.io/posts/">📚文章</a>&nbsp;»&nbsp;<a href="https://frog-game.github.io/posts/read/">📕 阅读</a></div>
            <h1 class="post-title">
                [Lua5.4.4源码]结构分析
            </h1>
            <div class="post-description">
                lua源码结构分析
            </div>
            <div class="post-meta">创建:&nbsp;<span title='2022-01-22 01:30:29 +0800 CST'>2022-01-22</span>&nbsp;|&nbsp;更新:&nbsp;2022-01-22&nbsp;|&nbsp;字数:&nbsp;986字&nbsp;|&nbsp;时长:&nbsp;2分钟&nbsp;|&nbsp;
作者:&nbsp;frog



                &nbsp;|&nbsp;标签: &nbsp;
                <ul class="post-tags-meta">
                    <a href="https://frog-game.github.io/tags/lua5.4.4%E6%BA%90%E7%A0%81/">Lua5.4.4源码</a>
                </ul>

                
                <span id="busuanzi_container_page_pv">
                &nbsp;| 访问: <span id="busuanzi_value_page_pv"></span>
            </span>

</div>
        </header> 
<figure class="entry-cover1"><img loading="lazy" src="https://frog-game.github.io/posts/read/lua5.4.4jiegoufenxi/image-20230122214914018.png" alt="">
        
</figure>
        <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">文章目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#lua%e7%ae%80%e4%bb%8b" aria-label="lua简介">lua简介</a></li>
                <li>
                    <a href="#%e4%b8%8b%e8%bd%bd" aria-label="下载">下载</a></li>
                <li>
                    <a href="#lua-%e6%ba%90%e7%a0%81%e7%bb%93%e6%9e%84" aria-label="lua 源码结构">lua 源码结构</a><ul>
                        
                <li>
                    <a href="#%e8%99%9a%e6%8b%9f%e6%9c%ba%e8%bf%90%e8%bd%ac%e7%9a%84%e6%a0%b8%e5%bf%83%e5%8a%9f%e8%83%bd" aria-label="虚拟机运转的核心功能">虚拟机运转的核心功能</a></li>
                <li>
                    <a href="#%e5%86%85%e5%b5%8c%e5%ba%93" aria-label="内嵌库">内嵌库</a></li>
                <li>
                    <a href="#%e6%ba%90%e4%bb%a3%e7%a0%81%e8%a7%a3%e6%9e%90%e4%bb%a5%e5%8f%8a%e9%a2%84%e7%bc%96%e8%af%91%e5%ad%97%e8%8a%82%e7%a0%81" aria-label="源代码解析以及预编译字节码">源代码解析以及预编译字节码</a></li>
                <li>
                    <a href="#%e5%8f%af%e6%89%a7%e8%a1%8c%e7%9a%84%e8%a7%a3%e6%9e%90%e5%99%a8%e5%ad%97%e8%8a%82%e7%a0%81%e7%bc%96%e8%af%91%e5%99%a8" aria-label="可执行的解析器，字节码编译器">可执行的解析器，字节码编译器</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        
        <div class="post-content"><h2 id="lua简介">lua简介<a hidden class="anchor" aria-hidden="true" href="#lua简介">#</a></h2>
<ul>
<li>
<p>lua 很小</p>
<p>将lua添加到应用程序不会让代码膨胀,也不会有很多的第三方库,繁琐的配置,很容易就能键入到你的应用程序当中</p>
<p><code>Lua 5.4.4</code>的压缩包含源代码和文档，压缩值为<code>353K</code>，未压缩值为<code>1.3M</code>。源代码包含大约<code>30000</code>行c语言。在<code>64</code>位<code>Linux</code>下，用所有标准<code>Lua</code>库构建的<code>Lua</code>解释器占用<code>281K</code>, <code>Lua</code>库占用<code>468K</code></p>
</li>
<li>
<p>lua是可移植性</p>
<p><code>lua</code>以一个小包的形式发布,可以在所有具有标准c编译器的平台上开箱即用</p>
</li>
<li>
<p>lua速度很快</p>
<p><code>lua</code>在经过不断的版本迭代现在<code>lua5.4.4</code>上应用<code>分代GC</code>和<code>增量GC</code> <code>GC</code>这块已经不是什么卡壳点,还有<code>TBC局部变量</code>,元表提供的<code>GC元方法</code>,等等一些新特性能够让你更好的优化自己项目的性能</p>
</li>
<li>
<p>lua已经经过很多应用和游戏的验证</p>
<p>比如魔兽世界,愤怒的小鸟,巴西数字电视的<code>ginga</code>中间件,还有<code>skyne</code>t的<code>actor</code>方式的微服务框架</p>
</li>
<li>
<p>lua 嵌入</p>
<p><code>lua</code>可以很方便的和<code>c</code>,<code>c++</code> 语言进行嵌入,还用于<code>Java</code> <code>c#</code> <code>Smalltalk</code> <code>Fortran</code> <code>Ada</code> <code>Erlang</code>，甚至其他脚本语言(如<code>Perl</code>和<code>Ruby</code>)编写的程序</p>
</li>
</ul>
<h2 id="下载">下载<a hidden class="anchor" aria-hidden="true" href="#下载">#</a></h2>
<p>本人已经在<code>GitHub</code>上对<code>lua</code>作者的源码进行大部分注解,后面还会逐步继续完善</p>
<p><a href="https://github.com/frog-game/lua-5.4.4-comments"><strong>lua-5.4.4-每行都加注释版本</strong></a></p>
<h2 id="lua-源码结构">lua 源码结构<a hidden class="anchor" aria-hidden="true" href="#lua-源码结构">#</a></h2>
<p><img loading="lazy" src="image-20230122214914018.png" alt="image-20230122214914018"  />
</p>
<h3 id="虚拟机运转的核心功能">虚拟机运转的核心功能<a hidden class="anchor" aria-hidden="true" href="#虚拟机运转的核心功能">#</a></h3>
<table>
<thead>
<tr>
<th>文件</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>lapi.c</td>
<td>Lua API。实现大量的Lua C API（lua_ *函数）</td>
</tr>
<tr>
<td>ldebug.c</td>
<td>调试接口</td>
</tr>
<tr>
<td>ldo.c</td>
<td>函数调用以及栈管理</td>
</tr>
<tr>
<td>lfunc.c</td>
<td>函数原型及闭包管理</td>
</tr>
<tr>
<td>lgc.c</td>
<td>垃圾回收</td>
</tr>
<tr>
<td>lmem.c</td>
<td>内存管理接口[luaM_realloc / luaM_growaux_]</td>
</tr>
<tr>
<td>lobject.c</td>
<td>对象操作的一些函数。包括数据类型&lt;-&gt;字符串转换</td>
</tr>
<tr>
<td>lstate.c</td>
<td>状态机 管理全局信息,和状态机相关的逻辑</td>
</tr>
<tr>
<td>lstring.c</td>
<td>字符串池</td>
</tr>
<tr>
<td>ltable.c</td>
<td>表类型的相关操作。Lua表（哈希）</td>
</tr>
<tr>
<td>ltm.c</td>
<td>标记方法。实现从对象访问元方法。</td>
</tr>
<tr>
<td>lvm.c</td>
<td>虚拟机。执行字节码（luaV_execute）。还公开了lapi.c使用的一些功能（例如luaV_concat）</td>
</tr>
<tr>
<td>lzio.c</td>
<td>通用的缓冲输入流接口</td>
</tr>
</tbody>
</table>
<h3 id="内嵌库">内嵌库<a hidden class="anchor" aria-hidden="true" href="#内嵌库">#</a></h3>
<table>
<thead>
<tr>
<th>文件</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>lauxlib.c</td>
<td>c库编写用到的辅助函数库</td>
</tr>
<tr>
<td>lbaselib.c</td>
<td>lua基础库</td>
</tr>
<tr>
<td>lcorolib.c</td>
<td>协程库</td>
</tr>
<tr>
<td>lctype.c</td>
<td>标准库中ctype相关实现</td>
</tr>
<tr>
<td>ldblib.c</td>
<td>Debug库</td>
</tr>
<tr>
<td>linit.c</td>
<td>内嵌库的初始化</td>
</tr>
<tr>
<td>liolib.c</td>
<td>IO库</td>
</tr>
<tr>
<td>lmathlib.c</td>
<td>数学库</td>
</tr>
<tr>
<td>loadlib.c</td>
<td>动态扩展库管理</td>
</tr>
<tr>
<td>loslib.c</td>
<td>OS库</td>
</tr>
<tr>
<td>lstrlib.c</td>
<td>字符串库</td>
</tr>
<tr>
<td>ltablib.c</td>
<td>表处理库</td>
</tr>
</tbody>
</table>
<h3 id="源代码解析以及预编译字节码">源代码解析以及预编译字节码<a hidden class="anchor" aria-hidden="true" href="#源代码解析以及预编译字节码">#</a></h3>
<table>
<thead>
<tr>
<th>文件</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>lcode.c</td>
<td>Lua的代码生成器。由lparser.c使用</td>
</tr>
<tr>
<td>ldump.c</td>
<td>序列化预编译的Lua字节码</td>
</tr>
<tr>
<td>llex.c</td>
<td>词法分析器。由lparser.c使用</td>
</tr>
<tr>
<td>lparser.c</td>
<td>解析器</td>
</tr>
<tr>
<td>lundump.c</td>
<td>还原预编译的字节码</td>
</tr>
</tbody>
</table>
<h3 id="可执行的解析器字节码编译器">可执行的解析器，字节码编译器<a hidden class="anchor" aria-hidden="true" href="#可执行的解析器字节码编译器">#</a></h3>
<table>
<thead>
<tr>
<th>文件</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>lua.c</td>
<td>Lua独立解释器</td>
</tr>
<tr>
<td>luac.c</td>
<td>Lua编译器（将字节码保存到文件中；还列出字节码）</td>
</tr>
</tbody>
</table>


        </div>
        <div class="post-reward">
            <div style="padding: 0 0 0 0; margin: 0 0 0 0; width: 100%; font-size:16px; text-align: center;">
                <div id="QR" style="opacity: 0;">
                    <div id="wechat" style="display: inline-block">
                        <a class="fancybox" rel="group">
                            <img id="wechat_qr" src="https://frog-game.github.io/img/wechat_pay.png" alt="wechat_pay"></a>
                        <p>微信</p>
                    </div>
                    <div id="alipay" style="display: inline-block">
                        <a class="fancybox" rel="group">
                            <img id="alipay_qr" src="https://frog-game.github.io/img/alipay_pay.png" alt="alipay"></a>
                        <p>支付宝</p>
                    </div>
                </div>
                <button id="rewardButton"
                        onclick="
                    var qr = document.getElementById('QR');
                    if (qr.style.opacity === '0') {
                        qr.style.opacity='1';
                    } else {
                        qr.style.opacity='0'
                    }"
                >
                    <span>🧧 鼓励</span>
                </button>
            </div>
        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="prev" href="https://frog-game.github.io/posts/read/lua5.4.4shujuleixing/">
    <span class="title">« 上一页</span>
    <br>
    <span>[Lua5.4.4源码]数据类型</span>
  </a>
</nav>

        </footer>
    </div>



<div>
    <div class="pagination__title">
        <span class="pagination__title-h" style="font-size: 20px;">💬评论</span>
        <hr />
    </div>

    <div id="tcomment"></div>

    <script src="https://cdn.staticfile.org/twikoo/1.6.7/twikoo.all.min.js">
    </script>
    

    

    <script>
        twikoo.init({
            envId: "https://www.frog-game.work/", 
            el: "#tcomment",
            lang: 'zh-CN',
            region: "ap-beijing",
            path: window.TWIKOO_MAGIC_PATH||window.location.pathname,
            
            
            
            
            
            
            
        });
    </script>

</div>
</article>
</main>


<script async src="https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js"></script>


<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<footer class="footer">
    <span>
        Copyright
        &copy;
        2020-2023 
        <a href="https://frog-game.github.io/" style="color:#939393;">frog&#39;s Blog</a>
         All Rights Reserved
    </span>

    <a href="https://beian.miit.gov.cn/" target="_blank" style="color:#939393;">备案号</a>&nbsp;

    <span>
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null"style="display:inline-block;text-decoration:none;height:20px;color:#939393;">
            <img src="https://frog-game.github.io/img/beian.png" style="float:left;margin: 0px 5px 0px 0px;"/>
            公网安备
        </a>
    </span>

    <span id="busuanzi_container">
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
        总访客数: <span id="busuanzi_value_site_uv"></span>
        总访问量: <span id="busuanzi_value_site_pv"></span>
    </span>
    
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 400 || document.documentElement.scrollTop > 400) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\n————————————————\r\n' +
                    '版权声明：本文为「'+"frog's Blog"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                    '\r\n原文链接：' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\n————————————————\r\n' +
                    '版权声明：本文为「'+"frog's Blog"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                    '\r\n原文链接：' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = '📄复制';

        function copyingDone() {
            copybutton.innerText = '👌🏻已复制!';
            setTimeout(() => {
                copybutton.innerText = '📄复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\n————————————————\r\n' +
                    '版权声明：本文为「'+"frog's Blog"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                    '\r\n原文链接：' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {
            }
            ;
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
