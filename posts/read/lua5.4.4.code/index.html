<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>[Lua5.4.4æºç ].æŒ‡ä»¤é›† | frog&#39;s Blog</title>
<meta name="keywords" content="">
<meta name="description" content="luaæºç æŒ‡ä»¤é›†åˆ†æ">
<meta name="author" content="
ä½œè€…:&nbsp;frog">
<link rel="canonical" href="https://frog-game.github.io/posts/read/lua5.4.4.code/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8b75bf56d6fb0c429b5f3ce03bce19c9ef1e90cc024b64bd12ec321c68cca894.css" integrity="sha256-i3W/Vtb7DEKbXzzgO84Zye8ekMwCS2S9EuwyHGjMqJQ=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
        onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://frog-game.github.io/img/Q.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://frog-game.github.io/img/Q.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://frog-game.github.io/img/Q.gif">
<link rel="apple-touch-icon" href="https://frog-game.github.io/img/Q.gif">
<link rel="mask-icon" href="https://frog-game.github.io/img/Q.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta property="og:title" content="[Lua5.4.4æºç ].æŒ‡ä»¤é›†" />
<meta property="og:description" content="luaæºç æŒ‡ä»¤é›†åˆ†æ" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://frog-game.github.io/posts/read/lua5.4.4.code/" />
<meta property="og:image" content="https://frog-game.github.io/posts/read/lua5.4.4.code/image-20230223204632470.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-28T01:30:29&#43;08:00" />
<meta property="article:modified_time" content="2023-02-28T01:30:29&#43;08:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://frog-game.github.io/posts/read/lua5.4.4.code/image-20230223204632470.png" />
<meta name="twitter:title" content="[Lua5.4.4æºç ].æŒ‡ä»¤é›†"/>
<meta name="twitter:description" content="luaæºç æŒ‡ä»¤é›†åˆ†æ"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "ğŸ“šæ–‡ç« ",
      "item": "https://frog-game.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ğŸ“• é˜…è¯»",
      "item": "https://frog-game.github.io/posts/read/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "[Lua5.4.4æºç ].æŒ‡ä»¤é›†",
      "item": "https://frog-game.github.io/posts/read/lua5.4.4.code/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "[Lua5.4.4æºç ].æŒ‡ä»¤é›†",
  "name": "[Lua5.4.4æºç ].æŒ‡ä»¤é›†",
  "description": "luaæºç æŒ‡ä»¤é›†åˆ†æ",
  "keywords": [
    ""
  ],
  "articleBody": "æŒ‡ä»¤é›†ç®€ä»‹ Luaè™šæ‹Ÿæœºé‡‡ç”¨å®šé•¿æŒ‡ä»¤,æ¯æ¡æŒ‡ä»¤å 4ä¸ªå­—èŠ‚\nLua 5.4å°†æ“ä½œç æ‰©å±•åˆ°äº†ç¬¬7ä½æ€»å…±èƒ½å¤Ÿå®¹çº³128æ¡æŒ‡ä»¤,ç°åœ¨å®šä¹‰äº†83æ¡\næ“ä½œæ•°ç¼–ç æ¨¡å¼ä¸€å…±5ä¸­ enum OpMode {iABC, iABx, iAsBx, iAx, isJ}; ç¬¦å· ä½œç”¨ i instruction æŒ‡ä»¤çš„æ„æ€ A æŒ‡ä»¤1å‚æ•° ä¸€èˆ¬ç”¨ä½œç›®æ ‡å¯„å­˜å™¨ç´¢å¼• B æŒ‡ä»¤2å‚æ•° æ—¢å¯ä»¥æ˜¯å¯„å­˜å™¨ç´¢å¼•,ä¹Ÿå¯ä»¥æ˜¯å¸¸é‡æ± ç´¢å¼• C æŒ‡ä»¤3å‚æ•° æ—¢å¯ä»¥æ˜¯å¯„å­˜å™¨ç´¢å¼•,ä¹Ÿå¯ä»¥æ˜¯å¸¸é‡æ± ç´¢å¼• k ä¸€bitæ ‡å¿—ä½ æ¯”å¦‚ æ ‡å¿—ä½kä¸º1è¡¨ç¤ºå¸¸é‡æ± ç´¢å¼•,å¦åˆ™è¡¨ç¤ºå¯„å­˜å™¨ç´¢å¼• x extended æ‰©å±•çš„æ„æ€ s signed ç¬¦å· è¯¥å‚æ•°åº”è¯¥è¢«è§£é‡Šä¸ºæœ‰ç¬¦å·æ•´æ•° sJ è¡¨ç¤ºè·³è½¬çš„PCåç§»é‡ sBx sbxè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæœ‰ç¬¦å·çš„æ•°,ä¹Ÿå°±æ˜¯sbxå¯ä»¥æ˜¯è´Ÿæ•° bx bxæ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•° Ax åšå‚æ•°æ‰©å±•ä½¿ç”¨,åªèƒ½å’Œåˆ«çš„æŒ‡ä»¤æ­é…ä½¿ç”¨,æ¯”å¦‚LOADKXæŒ‡ä»¤ åŸºäºCPUå¯„å­˜å™¨æ¶æ„\nä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¿™äº›å¯„å­˜å™¨ç»„ä»¶æ˜¯å’ŒCPUæ†ç»‘åœ¨ä¸€å—çš„,æ‰€ä»¥è·¨å¹³å°å’Œå…¼å®¹æ€§å°±å¾ˆå·®,ä½†æ˜¯å› ä¸ºæ˜¯ç›´æ¥åœ¨CPUä¸Šç›´æ¥å¯¹æ•°æ®è¿›è¡Œè¿ç®—,æ‰€ä»¥é€Ÿåº¦å¾ˆå¿«\nLuaè™šæ‹Ÿæœºæ ˆ\nä»ä¸Šå›¾ä¸­æˆ‘ä»¬èƒ½çœ‹å‡ºLuaçš„å¯„å­˜å™¨æ˜¯åŸºäºè™šæ‹Ÿæœºçš„,ä½†æ˜¯è¿™äº›å¯„å­˜å™¨å’ŒCPUå¯„å­˜å™¨æ˜¯ä¸ä¸€æ ·çš„ä¸œè¥¿å’ŒCPUæ˜¯æ²¡æœ‰ä»»ä½•å…³è”,å¦‚æœæœ‰å…³è”çš„è¯,å› ä¸ºCPUçš„æ¯ä¸ªå¹³å°ä½¿ç”¨çš„æ¶æ„ä¸ä¸€æ ·,ä¼šå¯¼è‡´Luaå¤±å»ç§»æ¤å’Œå…¼å®¹æ€§,æ‰€ä»¥Luaä½¿ç”¨äº†ä¸€ä¸ªæ ˆæ¥ä¿å­˜è¿™äº›å¯„å­˜å™¨,åŒæ—¶æ¯ä¸€ä¸ªè¿è¡Œçš„å‡½æ•°éƒ½æœ‰è‡ªå·±çš„æ´»åŠ¨æ•°æ®,å•ç‹¬çš„å¯„å­˜å™¨æ•°é‡,åŒæ—¶åœ¨Lua5.4.4ä¸­ä¹Ÿè§„å®šäº†æ¯ä¸ªå‡½æ•°æœ€å¤§çš„å¯„å­˜å™¨ä¸ªæ•°æ˜¯255ä¸ª\nä¹Ÿå¯ä»¥çœ‹å‡ºæˆ‘ä»¬çš„æŒ‡ä»¤å…¶å®éƒ½æ˜¯å­˜åœ¨äº†Protoç»“æ„ä½“é‡Œé¢çš„codeå­—æ®µ\nç”±äºLuaæœ‰å¦‚æ­¤å¤§é‡çš„å¯„å­˜å™¨,æ‰€ä»¥åœ¨é¢„ç¼–è¯‘æ—¶èƒ½å¤Ÿå°†æ‰€æœ‰çš„å±€éƒ¨å˜é‡å­˜æ”¾åˆ°å¯„å­˜å™¨ä¸­,å› ä¸ºå¯„å­˜å™¨æ•°æ®æ˜¯åœ¨æ ˆä¸­,upvalueå˜é‡å­˜æ”¾åœ¨é“¾è¡¨ä¸­,globalå˜é‡å­˜æ”¾åœ¨å…¨å±€çš„è¡¨ä¸­ä¹Ÿå¯ä»¥è¯´æ˜¯åœ¨envè¡¨ä¸­\næ•ˆç‡ä»å¤§åˆ°å°:local \u003e upvalue \u003e global\næ‰€ä»¥ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨å¦‚ä¸‹é¢çš„å®šä¹‰æ–¹å¼æ¥æé«˜æ•ˆç‡,æ¯•ç«Ÿè¿™æ ·åšçœå»è°ƒç”¨æ—¶å†å»å…¨å±€è¡¨ä¸­,ä¸Šå€¼é“¾è¡¨ä¸­æŸ¥æ‰¾çš„å¼€é”€,åŒæ—¶ç”Ÿæˆçš„æŒ‡ä»¤ä¹Ÿä¼šå‡å°‘å¾ˆå¤š\nlocal sin = math.sin local table_remove_f = table_t.remove local table_insert_f = table_t.insert local table_unpack_f = table_t.unpack çœ‹æŒ‡ä»¤å‰çš„ä¸€äº›ç¬¦å·è§£é‡Š ç¬¦å· è§£é‡Š R(x) ä¸€å®šæ˜¯å¯„å­˜å™¨ç´¢å¼• ä¸€å®šä¼šè®¿é—®Luaæ ˆ Kst(x) ä¸€å®šæ˜¯å¸¸é‡ç´¢å¼• ä¸€å®šä¼šè®¿é—®å¸¸é‡è¡¨ RK(x) å¯èƒ½æ˜¯å¸¸é‡ç´¢å¼•ä¹Ÿæœ‰å¯èƒ½æ˜¯å¯„å­˜å™¨ç´¢å¼•,å–å†³äºç´¢å¼•kçš„ç±»å‹ ç«‹å³æ•° ç«‹å³æ•°å°±æ˜¯å†™åœ¨æŒ‡ä»¤é‡Œçš„å¸¸æ•°.ç”¨CPUæ¶æ„ä¸‹çš„movæŒ‡ä»¤ä¸¾ä¾‹å­,mov 12, %rax\né‚£ä¹ˆè¿™ä¸ª 12 å°±åœ¨æ“ä½œè¯­å¥é‡Œ.é‚£ä¹ˆ 12 ç›¸å½“äºæŒ‡ä»¤é‡Œçš„ç«‹å³æ•°,\nluaä¸­çš„æŒ‡ä»¤ä¹Ÿç±»ä¼¼,ç›´æ¥ä»æŒ‡ä»¤å‚æ•°ä¸­åŠ è½½çš„æ•´æ•°å’Œæµ®ç‚¹æ•°å°±æ˜¯ç«‹å³æ•° PC ç¨‹åºæŒ‡ä»¤è®¡æ•°å™¨,ä¸»è¦æ˜¯ä¸ºäº†è®¡ç®—æŒ‡ä»¤çš„ç›¸å¯¹ä½ç½®ç”¨çš„ Upvalue[n] ä¸‹æ ‡ç´¢å¼•ä¸ºnçš„ä¸Šå€¼ iABCæ“ä½œæ•°æ¨¡å¼ é¦–å…ˆè¿™ä¸ªæŒ‡ä»¤å’Œlua5.4ç‰ˆæœ¬ä¹‹å‰çš„luaè¡¨è¾¾æ–¹å¼ä¸ä¸€æ ·,lua5.4ä½¿ç”¨kä½æ¥è¡¨ç¤ºB,Cä¸¤ä½åˆ°åº•æ˜¯å¯„å­˜å™¨ç´¢å¼•[å…¶å®å°±æ˜¯æ ˆç´¢å¼•],è¿˜æ˜¯å¸¸é‡æ± ç´¢å¼•\nk:1è¡¨ç¤ºå¸¸é‡æ± ç´¢å¼• 0è¡¨ç¤ºå¯„å­˜å™¨ç´¢å¼• B,C:ä¸Šé¢çš„kå€¼å†³å®šæ˜¯å¯„å­˜å™¨ç´¢å¼•[å…¶å®å°±æ˜¯æ ˆç´¢å¼•],è¿˜æ˜¯å¸¸é‡æ± ç´¢å¼• A:ç›®æ ‡ç´¢å¼• å ç”¨bitä½èŒƒå›´\næ“ä½œ èŒƒå›´(å•ä½bit) Op(7) 0~6 A(8) 7~14 k(1) 15 B(8) 16~23 C(8) 24~31 èµ‹å€¼åŠ è½½æŒ‡ä»¤ OP_MOVE å…¬å¼:A B R[A] := R[B] å°†Bå¯„å­˜å™¨çš„å€¼èµ‹å€¼ç»™Aå¯„å­˜å™¨\nluaç¤ºä¾‹ä»£ç \nlocal B = 10 local A = B æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (4 instructions at 00CA2290) 0+ params, 2 slots, 1 upvalue, 2 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 æŸ¥çœ‹å¯å˜å‚æ•°æ–¹å¼ä¸‹å›ºå®šå‚æ•°ä¸ªæ•° 2 [1] LOADI 0 10 å°†æ•´å‹ç«‹å³æ•°10åŠ è½½åˆ°å¯„å­˜å™¨çš„0å·ä½ç½® 3 [2] MOVE 1 0 å°†(å¯„å­˜å™¨çš„0å·ä½ç½®)ä¸Šé¢çš„å±€éƒ¨å˜é‡Bçš„å€¼ä»˜ç»™(å¯„å­˜å™¨çš„1å·ä½ç½®)ä¸Šé¢å±€éƒ¨å˜é‡A 4 [2] RETURN 2 1 1 ; 0 out è¿”å›0ä¸ªå€¼ ä¸Šé¢æ­¥éª¤å¤§æ¦‚æ„æ€æ˜¯\nåœ¨ç¼–è¯‘è¿‡ç¨‹,Luaä¼šå°†æ¯ä¸ªlocalå˜é‡éƒ½åˆ†é…åˆ°ä¸€ä¸ªæŒ‡å®šçš„å¯„å­˜å™¨ä¸­,æ¯”å¦‚å±€éƒ¨å˜é‡Båˆ†é…åˆ°å¯„å­˜å™¨0å·ä½ç½®,å±€éƒ¨å˜é‡Aåˆ†é…åˆ°å¯„å­˜å™¨1å·ä½ç½®\nç„¶åæ‰§è¡ŒVARARGPREPæŒ‡ä»¤æŸ¥çœ‹ä¸‹å¯å˜å‚æ•°æ–¹å¼ä¸‹çš„å›ºå®šå‚æ•°æ•°é‡ è°ƒç”¨LOADIæ‰§è¡Œå°†æ•´å‹ç«‹å³æ•°10åŠ è½½åˆ°å¯„å­˜å™¨0å·ä½ç½® è°ƒç”¨MOVEå°†å¯„å­˜å™¨çš„0å·ä½ç½®ä¸Šé¢çš„å±€éƒ¨å˜é‡Bçš„å€¼ä»˜ç»™å¯„å­˜å™¨çš„1å·ä½ç½®ä¸Šé¢å±€éƒ¨å˜é‡A 0 out çš„æ„æ€æ˜¯è¿”å›0ä¸ªå€¼ OP_LOADFALSE å…¬å¼:A\tR[A] := false åŠ è½½falseåˆ°å¯„å­˜å™¨\nluaç¤ºä¾‹ä»£ç \nlocal a = false æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (3 instructions at 00F32290) 0+ params, 2 slots, 1 upvalue, 1 local, 0 constants, 0 functions 1 [1] VARARGPREP 0 æŸ¥çœ‹å¯å˜å‚æ•°æ–¹å¼ä¸‹å›ºå®šå‚æ•°ä¸ªæ•° 2 [1] LOADFALSE 0 å°†falseåŠ è½½åˆ°å¯„å­˜å™¨çš„0å·ä½ç½® 3 [1] RETURN 1 1 1 ; 0 out OP_LFALSESKIP å…¬å¼:A\tR[A] := false; pc++\t(*) åŠ è½½falseåˆ°å¯„å­˜å™¨,åŒæ—¶è·³è¿‡ä¸‹ä¸€æ¡æŒ‡ä»¤\nluaç¤ºä¾‹ä»£ç \nlocal a = 5 \u003e 2 æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\n0+ params, 2 slots, 1 upvalue, 1 local, 0 constants, 0 functions 1 [1] VARARGPREP 0 æŸ¥çœ‹å¯å˜å‚æ•°æ–¹å¼ä¸‹å›ºå®šå‚æ•°ä¸ªæ•° 2 [1] LOADI 0 2 å°†ç«‹å³æ•´æ•°2åŠ è½½åˆ°å¯„å­˜å™¨0å·ä½ç½® 3 [1] LTI 0 5 1 æ¯”è¾ƒå¤§å° 4 [1] JMP 1 ; to 6 è¿›è¡Œè·³è½¬ 5 [1] LFALSESKIP 0\tåŠ è½½falseåˆ°å¯„å­˜å™¨,åŒæ—¶è·³è¿‡ä¸‹ä¸€æ¡æŒ‡ä»¤ 6 [1] LOADTRUE 0 åŠ è½½trueåˆ°å¯„å­˜å™¨ 7 [1] RETURN 1 1 1 ; 0 out OP_LOADTRUE å…¬å¼:A\tR[A] := true åŠ è½½trueåˆ°å¯„å­˜å™¨\nluaç¤ºä¾‹ä»£ç \nlocal a = true æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (3 instructions at 014C2290) 0+ params, 2 slots, 1 upvalue, 1 local, 0 constants, 0 functions 1 [1] VARARGPREP 0 æŸ¥çœ‹å¯å˜å‚æ•°æ–¹å¼ä¸‹å›ºå®šå‚æ•°ä¸ªæ•° 2 [1] LOADTRUE 0 å°†trueåŠ è½½åˆ°å¯„å­˜å™¨çš„0å·ä½ç½® 3 [1] RETURN 1 1 1 ; 0 out OP_LOADNIL å…¬å¼:A B\tR[A], R[A+1], ..., R[A+B] := nil å°†åºå·[A,A+B]è¿ç»­B+1ä¸ªå¯„å­˜å™¨è®¾ç½®æˆnilå€¼,ç”¨äºåŠ è½½nilåˆ°ä¸€æ‰¹å¯„å­˜å™¨\nluaç¤ºä¾‹ä»£ç \nlocal a = nil local a1 = nil local a2 = nil local a3 = nil local a4 = nil æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (3 instructions at 015422A0) 0+ params, 5 slots, 1 upvalue, 5 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADNIL 0 4 ; 5 out å°†åºå·[A:0,A:0+B:4]è¿ç»­B:4+1ä¸ªå¯„å­˜å™¨è®¾ç½®æˆnilå€¼ 3 [5] RETURN 5 1 1 ; 0 out OP_GETUPVAL å…¬å¼:A B\tR[A] := UpValue[B] è¯»å–ä¸€ä¸ªä¸Šå€¼åˆ°å¯„å­˜å™¨\nluaç¤ºä¾‹ä»£ç \nlocal a function test() a = 1 return a end æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (5 instructions at 01542290) 0+ params, 2 slots, 1 upvalue, 1 local, 1 constant, 1 function 1 [1] VARARGPREP 0 2 [1] LOADNIL 0 0 ; 1 out 3 [5] CLOSURE 1 0 ; 01543CB8 4 [2] SETTABUP 0 0 1 ; _ENV \"test\" 5 [5] RETURN 1 1 1k ; 0 out function \u003c.\\helloworld.lua:2,5\u003e (5 instructions at 01543CB8) 0 params, 2 slots, 1 upvalue, 0 locals, 0 constants, 0 functions 1 [3] LOADI 0 1 2 [3] SETUPVAL 0 0 ; a 3 [4] GETUPVAL 0 0 ; a æŠŠå½“å‰é—­åŒ…çš„B:0ä½ç½®çš„å€¼æ‹·è´åˆ°ç›®æ ‡å¯„å­˜å™¨A:0ä¸­ 4 [4] RETURN1 0 5 [5] RETURN0 OP_SETUPVAL å…¬å¼:A B\tUpValue[B] := R[A] å†™ä¸€ä¸ªå¯„å­˜å™¨å€¼åˆ°ä¸Šå€¼\nluaç¤ºä¾‹ä»£ç \nlocal a function test() a = 1 return a end æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (5 instructions at 01542290) 0+ params, 2 slots, 1 upvalue, 1 local, 1 constant, 1 function 1 [1] VARARGPREP 0 2 [1] LOADNIL 0 0 ; 1 out 3 [5] CLOSURE 1 0 ; 01543CB8 4 [2] SETTABUP 0 0 1 ; _ENV \"test\" 5 [5] RETURN 1 1 1k ; 0 out function \u003c.\\helloworld.lua:2,5\u003e (5 instructions at 01543CB8) 0 params, 2 slots, 1 upvalue, 0 locals, 0 constants, 0 functions 1 [3] LOADI 0 1 2 [3] SETUPVAL 0 0 ; a æŠŠå½“å‰å¯„å­˜å™¨A:0ä½ç½®çš„å€¼è®¾ç½®åˆ°B:0ä½ç½®å¹¶åšä¸ºé—­åŒ…çš„ä¸Šå€¼ 3 [4] GETUPVAL 0 0 ; a 4 [4] RETURN1 0 5 [5] RETURN0 è¡¨æ“ä½œ OP_GETTABUP å…¬å¼:A B C\tR[A] := UpValue[B][K[C]:string] ä»è¡¨å–å€¼åˆ°å¯„å­˜å™¨,è¡¨åœ¨upvalue\nluaç¤ºä¾‹ä»£ç \nglobal_var = 40 local local_var = global_var æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (4 instructions at 012C2290) 0+ params, 2 slots, 1 upvalue, 1 local, 2 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] SETTABUP 0 0 1k ; _ENV \"global_var\" 40 3 [2] GETTABUP 0 0 0 ; _ENV \"global_var\" å°†upvaluesè¡¨ç´¢å¼•ä¸ºB:0çš„upvalue(å³ï¼š_ENV)ä¸­keyä¸ºå¸¸é‡è¡¨ç´¢å¼•ä¸ºC:0çš„(å³global_var),æ”¾åˆ°å¯„å­˜å™¨ç´¢å¼•ä¸ºA:0çš„åœ°æ–¹ 4 [2] RETURN 1 1 1 ; 0 out OP_GETTABUPå’Œä¸OP_GETTABLEæŒ‡ä»¤ç›¸ä¼¼,åªæ˜¯è¡¨è¢«å¼•ç”¨ä¸ºä¸Šå€¼.è¿™äº›æŒ‡ä»¤ç”¨äºè®¿é—®å…¨å±€å˜é‡,æ˜¯é€šè¿‡åä¸º_ENVçš„ä¸Šå€¼è®¿é—®çš„\nOP_GETTABLE å…¬å¼:A B C\tR[A] := R[B][R[C]] å°†å¯„å­˜å™¨Bä½ç½®çš„è¡¨t,ä¸‹æ ‡ä¸ºkeyä¸ºCé‡Œé¢çš„å†…å®¹æ‹·è´åˆ°å¯„å­˜å™¨Aä¸Š\nluaç¤ºä¾‹ä»£ç \nlocal k = \"a\" local ra = t[k] æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (5 instructions at 01202290) 0+ params, 2 slots, 1 upvalue, 2 locals, 2 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADK 0 0 ; \"a\" 3 [2] GETTABUP 1 0 1 ; _ENV \"t\" å°†upvaluesè¡¨ç´¢å¼•ä¸ºB:0çš„upvalue(å³ï¼š_ENV)ä¸­keyä¸ºå¸¸é‡è¡¨ç´¢å¼•ä¸ºC:1çš„(å³t),æ”¾åˆ°å¯„å­˜å™¨ç´¢å¼•ä¸ºA:1çš„åœ°æ–¹ 4 [2] GETTABLE 1 1 0 å°†å¯„å­˜å™¨B:1ä½ç½®çš„è¡¨t,ä¸‹æ ‡ä¸ºkeyä¸ºC:0é‡Œé¢çš„å†…å®¹æ‹·è´åˆ°å¯„å­˜å™¨A:1 5 [2] RETURN 2 1 1 ; 0 out OP_GETI å…¬å¼:A B C\tR[A] := R[B][C]\tä»è¡¨å–keyä¸ºæ•´å‹çš„å†…å®¹ç»™å¯„å­˜å™¨\nluaç¤ºä¾‹ä»£ç \nlocal a = t[2] æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (4 instructions at 01492290) 0+ params, 2 slots, 1 upvalue, 1 local, 1 constant, 0 functions 1 [1] VARARGPREP 0 2 [1] GETTABUP 0 0 0 ; _ENV \"t\" å°†upvaluesè¡¨ç´¢å¼•ä¸ºB:0çš„upvalue(å³ï¼š_ENV)ä¸­keyä¸ºå¸¸é‡è¡¨ç´¢å¼•ä¸ºC:0çš„(å³t),æ”¾åˆ°å¯„å­˜å™¨ç´¢å¼•ä¸ºA:0çš„åœ°æ–¹ 3 [1] GETI 0 0 2 å°†å¯„å­˜å™¨B:0ä½ç½®çš„è¡¨t,ä¸‹æ ‡ä¸ºkeyä¸ºç«‹å³æ•´æ•°2é‡Œé¢çš„å†…å®¹æ‹·è´åˆ°å¯„å­˜å™¨A:0 4 [1] RETURN 1 1 1 ; 0 out OP_GETFIELD å…¬å¼:A B C\tR[A] := R[B][K[C]:string] ä»è¡¨å–keyä¸ºå­—ç¬¦ä¸²çš„å†…å®¹ç»™å¯„å­˜å™¨\nluaç¤ºä¾‹ä»£ç \nlocal ra = t[\"11\"] æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (4 instructions at 00AC2290) 0+ params, 2 slots, 1 upvalue, 1 local, 2 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] GETTABUP 0 0 0 ; _ENV \"t\" å°†upvaluesè¡¨ç´¢å¼•ä¸ºB:0çš„upvalue(å³ï¼š_ENV)ä¸­keyä¸ºå¸¸é‡è¡¨ç´¢å¼•ä¸ºC:0çš„(å³t),æ”¾åˆ°å¯„å­˜å™¨ç´¢å¼•ä¸ºA:0çš„åœ°æ–¹ 3 [1] GETFIELD 0 0 1 ; \"11\" å°†å¯„å­˜å™¨B:0ä½ç½®çš„è¡¨t,ä¸‹æ ‡ä¸ºkeyä¸ºC:1çš„å†…å®¹æ‹·è´åˆ°å¯„å­˜å™¨A:0 4 [1] RETURN 1 1 1 ; 0 out OP_SETTABUP å…¬å¼:A B C\tUpValue[A][K[B]:string] := RK(C) è®¾ç½®å¯„å­˜å™¨å€¼ç»™è¡¨å…ƒç´ ,è¡¨åœ¨upvalue\nluaç¤ºä¾‹ä»£ç \nglobal_var = 40 local local_var = global_var æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (4 instructions at 012C2290) 0+ params, 2 slots, 1 upvalue, 1 local, 2 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] SETTABUP 0 0 1k ; _ENV \"global_var\" 40 å°†å¸¸é‡è¡¨ä¸­Keyä¸ºC:1ä¸Šçš„å€¼40 èµ‹å€¼ç»™å¯„å­˜å™¨A:0ä¸Šçš„ä¸Šå€¼è¡¨keyä¸ºB:0çš„ä¸Šå€¼ 3 [2] GETTABUP 0 0 0 ; _ENV \"global_var\" å°†upvaluesè¡¨ç´¢å¼•ä¸ºB:0çš„upvalue(å³ï¼š_ENV)ä¸­keyä¸ºå¸¸é‡è¡¨ç´¢å¼•ä¸ºC:0çš„(å³global_var),æ”¾åˆ°å¯„å­˜å™¨ç´¢å¼•ä¸ºA:0çš„åœ°æ–¹ 4 [2] RETURN 1 1 1 ; 0 out OP_NEWTABLE å…¬å¼:A B C k\tR[A] := {} æ–°å»ºä¸€ä¸ªè¡¨\nluaç¤ºä¾‹ä»£ç \nlocal t = {} æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (4 instructions at 00A522A8) 0+ params, 2 slots, 1 upvalue, 1 local, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] NEWTABLE 0 0 0 ; 0 åˆ›å»ºä¸€ä¸ªç©ºè¡¨,å¹¶å°†ç©ºè¡¨æ”¾åˆ°å¯„å­˜å™¨A:0ä½ç½® 3 [1] EXTRAARG 0 4 [1] RETURN 1 1 1 ; 0 out OP_SELF å…¬å¼:A B C\tR[A+1] := R[B]; R[A] := R[B][RK(C):string] å‡†å¤‡ä¸€ä¸ªå¯¹è±¡æ–¹æ³•çš„è°ƒç”¨\nluaç¤ºä¾‹ä»£ç \nfoo:getLua(\"lua\") æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 012E2290) 0+ params, 3 slots, 1 upvalue, 0 locals, 3 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] GETTABUP 0 0 0 ; _ENV \"foo\" 3 [1] SELF 0 0 1k ; \"getLua\" æŠŠå¯„å­˜å™¨ä¸­å¯¹è±¡B:0(å³foo)å’Œå¸¸é‡è¡¨ä¸­æ–¹æ³•C:1(å³getLua)æ‹·è´åˆ°ç›¸é‚»çš„ä¸¤ä¸ªç›®æ ‡å¯„å­˜å™¨ä¸­,ç›¸é‚»ç›®æ ‡çš„å…¶å®ä½ç½®ç”±A:0å†³å®š 4 [1] LOADK 2 2 ; \"lua\" 5 [1] CALL 0 3 1 ; 2 in 0 out 6 [1] RETURN 0 1 1 ; 0 out ä¸Šé¢æ–¹æ³•foo:getLua(\"lua\")è°ƒç”¨ç›¸å½“äºfoo.getLua(foo,\"lua\"),è®©å…¨å±€fooåªè¢«æŸ¥æ‰¾ä¸€æ¬¡,ä¸‹é¢åœ¨ä»‹ç»ä¸‹æ²¡æœ‰selfæŒ‡ä»¤æƒ…å†µä¸‹çš„æƒ…å†µ\nluaç¤ºä¾‹ä»£ç \nfoo.getLua(foo,\"lua\") luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (7 instructions at 008F2290) 0+ params, 3 slots, 1 upvalue, 0 locals, 3 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] GETTABUP 0 0 0 ; _ENV \"foo\" 3 [1] GETFIELD 0 0 1 ; \"getLua\" å°†upvaluesè¡¨ç´¢å¼•ä¸ºB:0çš„upvalue(å³ï¼š_ENV)ä¸­keyä¸ºå¸¸é‡è¡¨ç´¢å¼•ä¸ºC:1çš„(å³getLua),æ”¾åˆ°å¯„å­˜å™¨ç´¢å¼•ä¸ºA:0çš„åœ°æ–¹ 4 [1] GETTABUP 1 0 0 ; _ENV \"foo\" å°†upvaluesè¡¨ç´¢å¼•ä¸ºB:0çš„upvalue(å³ï¼š_ENV)ä¸­keyä¸ºå¸¸é‡è¡¨ç´¢å¼•ä¸ºC:0çš„(å³\"foo\"),æ”¾åˆ°å¯„å­˜å™¨ç´¢å¼•ä¸ºA:1çš„åœ°æ–¹ 5 [1] LOADK 2 2 ; \"lua\" 6 [1] CALL 0 3 1 ; 2 in 0 out 7 [1] RETURN 0 1 1 ; 0 out ä»å¯¹ä¸¤ä¸ªå‡½æ•°è¿›è¡ŒæŒ‡ä»¤é›†å¯¹æ¯”ä»¥åæˆ‘ä»¬å¯ä»¥çœ‹å‡ºfoo:getLua(\"lua\")å‡½æ•°çš„ç¬¬3è¡Œçš„\n3 [1] SELF 0 0 1k ; \"getLua\"\nå’Œ\nfoo.getLua(foo,\"lua\")å‡½æ•°ç¬¬3,4è¡Œ\n3 [1] GETFIELD 0 0 1 ; \"getLua\"\n4 [1] GETTABUP 1 0 0 ; _ENV \"foo\"\nç­‰ä»·\næ‰€ä»¥ç»¼åˆæ¥è¯´SELFæŒ‡ä»¤èŠ‚çœäº†é¢å¤–çš„æŒ‡ä»¤,å¹¶åŠ å¿«äº†é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­æ–¹æ³•çš„è°ƒç”¨.ä½†æ˜¯å®ƒåªä¸ºä½¿ç”¨å†’å·è¯­æ³•çš„æ–¹æ³•è°ƒç”¨ç”ŸæˆæœåŠ¡\nOP_SETLIST å…¬å¼:A B C k R[A][C+i] := R[A+i], 1 \u003c= i \u003c= B ç»™è¡¨è®¾ç½®ä¸€æ‰¹æ•°ç»„å…ƒç´ \nluaç¤ºä¾‹ä»£ç \nlocal q = {1,2,3,4,5} æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (10 instructions at 01572290) 0+ params, 6 slots, 1 upvalue, 1 local, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] NEWTABLE 0 0 5 ; 5 3 [1] EXTRAARG 0 4 [1] LOADI 1 1 5 [1] LOADI 2 2 6 [1] LOADI 3 3 7 [1] LOADI 4 4 8 [1] LOADI 5 5 9 [1] SETLIST 0 5 0 è¿™é‡Œçš„5å°±æ˜¯æ•°ç»„æ•°é‡ 10 [1] RETURN 1 1 1 ; 0 out å¦‚æœéœ€è¦å†™å…¥æ•°ç»„çš„ä¸€ç³»åˆ—å€¼å¹¶ä¸”æ˜¯ç´§æŒ¨ç€æ•°ç»„åˆ™æ•°é‡ç”±æ“ä½œæ•°BæŒ‡å®š,æ•°ç»„èµ·å§‹ç´¢å¼•åˆ™ç”±æ“ä½œCæŒ‡å®š\nå…¶å®è¿™ä¹ˆåšä¹Ÿæ˜¯ä¸ºäº†çœæŒ‡ä»¤æ¡æ•°,åªéœ€è¦ä¸€æ¡æŒ‡ä»¤OP_SETLISTå°±å¤Ÿäº†\nç®—æœ¯å’Œä½è¿ç®— OP_ADDI å…¬å¼:A B sC\tR[A] := R[B] + sC ç«‹å³æ•°åŠ \nluaç¤ºä¾‹ä»£ç \nlocal a,b = 1,2 a = a + 5 luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 00812290) 0+ params, 2 slots, 1 upvalue, 2 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [1] LOADI 1 2 4 [2] ADDI 0 0 5 ç«‹å³æ•°ç›¸åŠ  5 [2] MMBINI 0 5 6 0 ; __add 6 [2] RETURN 2 1 1 ; 0 out OP_ADDK å…¬å¼:A B C\tR[A] := R[B] + K[C]:number å¸¸é‡åŠ \nluaç¤ºä¾‹ä»£ç \nlocal a,b = 1,2 a = a + 5.0 luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 007B2290) 0+ params, 2 slots, 1 upvalue, 2 locals, 1 constant, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [1] LOADI 1 2 4 [2] ADDK 0 0 0 ; 5.0 å¸¸é‡åŠ  5 [2] MMBINK 0 0 6 0 ; __add 5.0 6 [2] RETURN 2 1 1 ; 0 out OP_SUBK å…¬å¼:A B C\tR[A] := R[B] - K[C]:number å¸¸é‡å‡\nluaç¤ºä¾‹ä»£ç \nlocal a,b = 1,2 a = a - 5.0 luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 00DB2290) 0+ params, 2 slots, 1 upvalue, 2 locals, 1 constant, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [1] LOADI 1 2 4 [2] SUBK 0 0 0 ; 5.0 å¸¸é‡å‡ 5 [2] MMBINK 0 0 7 0 ; __sub 5.0 6 [2] RETURN 2 1 1 ; 0 out OP_MULK å…¬å¼:A B C\tR[A] := R[B] * K[C]:number å¸¸é‡ä¹˜\nluaç¤ºä¾‹ä»£ç \nlocal a,b = 1,2 a = a * 5.0 luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 015D2290) 0+ params, 2 slots, 1 upvalue, 2 locals, 1 constant, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [1] LOADI 1 2 4 [2] MULK 0 0 0 ; 5.0 å¸¸é‡ä¹˜ 5 [2] MMBINK 0 0 8 0 ; __mul 5.0 6 [2] RETURN 2 1 1 ; 0 out OP_MODK å…¬å¼:A B C\tR[A] := R[B] % K[C]:number å¸¸é‡æ¨¡\nluaç¤ºä¾‹ä»£ç \nlocal a,b = 1,2 a = a % 5.0 luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 01732290) 0+ params, 2 slots, 1 upvalue, 2 locals, 1 constant, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [1] LOADI 1 2 4 [2] MODK 0 0 0 ; 5.0 å¸¸é‡æ¨¡ 5 [2] MMBINK 0 0 9 0 ; __mod 5.0 6 [2] RETURN 2 1 1 ; 0 out OP_DIVK å…¬å¼:A B C\tR[A] := R[B] / K[C]:number å¸¸é‡é™¤\nluaç¤ºä¾‹ä»£ç \nlocal a,b = 1,2 a = a / 5.0 luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 008E2298) 0+ params, 2 slots, 1 upvalue, 2 locals, 1 constant, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [1] LOADI 1 2 4 [2] DIVK 0 0 0 ; 5.0 å¸¸é‡é™¤ 5 [2] MMBINK 0 0 11 0 ; __div 5.0 6 [2] RETURN 2 1 1 ; 0 out OP_IDIVK å…¬å¼:A B C\tR[A] := R[B] // K[C]:number å¸¸é‡æ•´é™¤\nluaç¤ºä¾‹ä»£ç \nlocal a,b = 1,2 a = a // 5.0 luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 00BB2290) 0+ params, 2 slots, 1 upvalue, 2 locals, 1 constant, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [1] LOADI 1 2 4 [2] IDIVK 0 0 0 ; 5.0 å¸¸é‡æ•´é™¤ 5 [2] MMBINK 0 0 12 0 ; __idiv 5.0 6 [2] RETURN 2 1 1 ; 0 out OP_BANDK å…¬å¼:A B C\tR[A] := R[B] \u0026 K[C]:integer å¸¸é‡ä¸\nluaç¤ºä¾‹ä»£ç \nlocal a,b = 1,2 a = a \u0026 5 luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 00C22290) 0+ params, 2 slots, 1 upvalue, 2 locals, 1 constant, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [1] LOADI 1 2 4 [2] BANDK 0 0 0 ; 5 å¸¸é‡ä¸ 5 [2] MMBINK 0 0 13 0 ; __band 5 6 [2] RETURN 2 1 1 ; 0 out OP_BORK å…¬å¼:A B C\tR[A] := R[B] | K[C]:integer å¸¸é‡æˆ–\nluaç¤ºä¾‹ä»£ç \nlocal a,b = 1,2 a = a | 5 luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 00832428) 0+ params, 2 slots, 1 upvalue, 2 locals, 1 constant, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [1] LOADI 1 2 4 [2] BORK 0 0 0 ; 5 å¸¸é‡æˆ– 5 [2] MMBINK 0 0 14 0 ; __bor 5 6 [2] RETURN 2 1 1 ; 0 out OP_BXORK å…¬å¼:A B C\tR[A] := R[B] ~ K[C]:integer\tå¸¸é‡å¼‚æˆ–\nluaç¤ºä¾‹ä»£ç \nlocal a,b = 1,2 a = a ~ 5 luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 009E2290) 0+ params, 2 slots, 1 upvalue, 2 locals, 1 constant, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [1] LOADI 1 2 4 [2] BXORK 0 0 0 ; 5 å¸¸é‡å¼‚æˆ– 5 [2] MMBINK 0 0 15 0 ; __bxor 5 6 [2] RETURN 2 1 1 ; 0 out OP_SHRI å…¬å¼:A B sC\tR[A] := R[B] \u003e\u003e sC\tç«‹å³æ•°å³ç§»\nluaç¤ºä¾‹ä»£ç \nlocal a,b = 1,2 a = a \u003e\u003e 5 luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 007625B8) 0+ params, 2 slots, 1 upvalue, 2 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [1] LOADI 1 2 4 [2] SHRI 0 0 5 ç«‹å³æ•°å³ç§» 5 [2] MMBINI 0 5 17 0 ; __shr 6 [2] RETURN 2 1 1 ; 0 out OP_SHLI å…¬å¼:A B sC\tR[A] := sC \u003c\u003c R[B]\tç«‹å³æ•°å·¦ç§»\nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = 2 local a = a + b luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 00A22290) 0+ params, 2 slots, 1 upvalue, 2 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [1] LOADI 1 2 4 [2] SHLI 0 0 5 ç«‹å³æ•°å·¦ç§» 5 [2] MMBINI 0 5 16 1 ; __shl flip 6 [2] RETURN 2 1 1 ; 0 out OP_ADD å…¬å¼:A B C\tR[A] := R[B] + R[C]\tåŠ \nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = 2 local a = a + b luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 00ED22A0) 0+ params, 3 slots, 1 upvalue, 3 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [2] LOADI 1 2 4 [3] ADD 2 0 1 åŠ  5 [3] MMBIN 0 1 6 ; __add 6 [3] RETURN 3 1 1 ; 0 out OP_SUB å…¬å¼:A B C\tR[A] := R[B] - R[C]\tå‡\nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = 2 local a = a - b luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 00FC22A0) 0+ params, 3 slots, 1 upvalue, 3 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [2] LOADI 1 2 4 [3] SUB 2 0 1 å‡ 5 [3] MMBIN 0 1 7 ; __sub 6 [3] RETURN 3 1 1 ; 0 out OP_MUL å…¬å¼:A B C\tR[A] := R[B] * R[C]\tä¹˜\nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = 2 local a = a * b luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 00EF2290) 0+ params, 3 slots, 1 upvalue, 3 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [2] LOADI 1 2 4 [3] MUL 2 0 1 ä¹˜ 5 [3] MMBIN 0 1 8 ; __mul 6 [3] RETURN 3 1 1 ; 0 out OP_MOD å…¬å¼:A B C\tR[A] := R[B] % R[C]\tæ¨¡\nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = 2 local a = a % b luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 01102290) 0+ params, 3 slots, 1 upvalue, 3 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [2] LOADI 1 2 4 [3] MOD 2 0 1 æ¨¡ 5 [3] MMBIN 0 1 9 ; __mod 6 [3] RETURN 3 1 1 ; 0 out OP_POW å…¬å¼:A B C\tR[A] := R[B] ^ R[C]\tå¹‚\nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = 2 local a = a ^ b luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 006F2290) 0+ params, 3 slots, 1 upvalue, 3 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [2] LOADI 1 2 4 [3] POW 2 0 1 å¹‚ 5 [3] MMBIN 0 1 10 ; __pow 6 [3] RETURN 3 1 1 ; 0 out OP_DIV å…¬å¼:A B C\tR[A] := R[B] / R[C]\tæµ®ç‚¹é™¤\nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = 2 local a = a / b luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 008B2290) 0+ params, 3 slots, 1 upvalue, 3 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [2] LOADI 1 2 4 [3] DIV 2 0 1 æµ®ç‚¹é™¤ 5 [3] MMBIN 0 1 11 ; __div 6 [3] RETURN 3 1 1 ; 0 out OP_IDIV å…¬å¼:A B C\tR[A] := R[B] // R[C]\tæ•´é™¤\nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = 2 local a = a // b luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 011A22A8) 0+ params, 3 slots, 1 upvalue, 3 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [2] LOADI 1 2 4 [3] IDIV 2 0 1 æ•´é™¤ 5 [3] MMBIN 0 1 12 ; __idiv 6 [3] RETURN 3 1 1 ; 0 out OP_BAND å…¬å¼:A B C\tR[A] := R[B] \u0026 R[C]\tä½ä¸\nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = 2 local a = a \u0026 b luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 00C32290) 0+ params, 3 slots, 1 upvalue, 3 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [2] LOADI 1 2 4 [3] BAND 2 0 1 ä½ä¸ 5 [3] MMBIN 0 1 13 ; __band 6 [3] RETURN 3 1 1 ; 0 out OP_BOR å…¬å¼:A B C\tR[A] := R[B] | R[C]\tä½æˆ–\nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = 2 local a = a | b luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 00D422A8) 0+ params, 3 slots, 1 upvalue, 3 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [2] LOADI 1 2 4 [3] BOR 2 0 1 ä½æˆ– 5 [3] MMBIN 0 1 14 ; __bor 6 [3] RETURN 3 1 1 ; 0 out OP_BXOR å…¬å¼:A B C\tR[A] := R[B] ~ R[C]\tä½å¼‚æˆ–\nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = 2 local a = a ~ b luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 01592748) 0+ params, 3 slots, 1 upvalue, 3 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [2] LOADI 1 2 4 [3] BXOR 2 0 1 ä½å¼‚æˆ– 5 [3] MMBIN 0 1 15 ; __bxor 6 [3] RETURN 3 1 1 ; 0 out OP_SHL å…¬å¼:A B C\tR[A] := R[B] \u003c\u003c R[C]\tå·¦ç§»\nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = 2 local a = a \u003c\u003c b luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 015F2280) 0+ params, 3 slots, 1 upvalue, 3 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [2] LOADI 1 2 4 [3] SHL 2 0 1 å·¦ç§» 5 [3] MMBIN 0 1 16 ; __shl 6 [3] RETURN 3 1 1 ; 0 out OP_SHL å…¬å¼:A B C\tR[A] := R[B] \u003e\u003e R[C]\tå³ç§»\nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = 2 local a = a \u003e\u003e b luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 00D72290) 0+ params, 3 slots, 1 upvalue, 3 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [2] LOADI 1 2 4 [3] SHR 2 0 1 å³ç§» 5 [3] MMBIN 0 1 17 ; __shr 6 [3] RETURN 3 1 1 ; 0 out å‰é¢ç®—æœ¯å’Œä½è¿ç®—å¤±è´¥å°è¯•è°ƒç”¨Cå±‚å…ƒæ–¹æ³• OP_MMBIN å…¬å¼:A B C\tcall C metamethod over R[A] and R[B]\t(*) ä½å¼‚æˆ–å¤±è´¥ä»¥åè°ƒç”¨Cå…ƒæ–¹æ³•\nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = 2 local a = a ~ b luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 01592748) 0+ params, 3 slots, 1 upvalue, 3 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [2] LOADI 1 2 4 [3] BXOR 2 0 1 ä½å¼‚æˆ– 5 [3] MMBIN 0 1 15 ; __bxor ä½å¼‚æˆ–å¤±è´¥äº†å°±ä¼šå»è°ƒç”¨__bxorå…ƒæ–¹æ³• 6 [3] RETURN 3 1 1 ; 0 out OP_MMBINI å…¬å¼:A B sC\tR[A] := sC \u003c\u003c R[B]\tç«‹å³æ•°å·¦ç§»å¤±è´¥ä»¥åè°ƒç”¨Cå…ƒæ–¹æ³•\nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = 2 local a = a + b luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 00A22290) 0+ params, 2 slots, 1 upvalue, 2 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [1] LOADI 1 2 4 [2] SHLI 0 0 5 ç«‹å³æ•°å·¦ç§» 5 [2] MMBINI 0 5 16 1 ; __shl flip ç«‹å³æ•°å·¦ç§»å¤±è´¥äº†å°±ä¼šå»è°ƒç”¨__shlå…ƒæ–¹æ³• 6 [2] RETURN 2 1 1 ; 0 out OP_MMBINK å…¬å¼:A B C k call C metamethod over R[A] and K[B] å¸¸é‡å¼‚æˆ–å¤±è´¥ä»¥åè°ƒç”¨Cå…ƒæ–¹æ³•\nluaç¤ºä¾‹ä»£ç \nlocal a,b = 1,2 a = a ~ 5 luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 009E2290) 0+ params, 2 slots, 1 upvalue, 2 locals, 1 constant, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [1] LOADI 1 2 4 [2] BXORK 0 0 0 ; 5 å¸¸é‡å¼‚æˆ– 5 [2] MMBINK 0 0 15 0 ; __bxor 5 å¸¸é‡å¼‚æˆ–å¤±è´¥äº†å°±ä¼šå»è°ƒç”¨__bxorå…ƒæ–¹æ³• 6 [2] RETURN 2 1 1 ; 0 out ä¸€å…ƒè¿ç®— OP_UNM å…¬å¼:A B\tR[A] := -R[B] ä¸€å…ƒå‡\nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = -a luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (4 instructions at 009722B8) 0+ params, 2 slots, 1 upvalue, 2 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [2] UNM 1 0 ä¸€å…ƒå‡ 4 [2] RETURN 2 1 1 ; 0 out OP_BNOT å…¬å¼:A B\tR[A] := ~R[B] ä½é\nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = ~a luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (4 instructions at 00CB2290) 0+ params, 2 slots, 1 upvalue, 2 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [2] BNOT 1 0 ä½é 4 [2] RETURN 2 1 1 ; 0 out é€»è¾‘è¿ç®— OP_NOT å…¬å¼:A B\tR[A] := not R[B] é€»è¾‘å–å\nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = not(a) luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (4 instructions at 00A12290) 0+ params, 2 slots, 1 upvalue, 2 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [2] NOT 1 0 é€»è¾‘å–å 4 [2] RETURN 2 1 1 ; 0 out å‘¨è¾¹æ“ä½œ OP_LEN å…¬å¼:A B\tR[A] := #R[B] (length operator) å–é•¿åº¦\nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = #a luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (4 instructions at 00952290) 0+ params, 2 slots, 1 upvalue, 2 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [2] LEN 1 0 å–é•¿åº¦ 4 [2] RETURN 2 1 1 ; 0 out OP_CONCAT å…¬å¼:A B\tR[A] := R[A].. ... ..R[A + B - 1] æ‹¼æ¥å¯¹è±¡\nluaç¤ºä¾‹ä»£ç \nlocal a = 1 local b = a .. 22 luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 00D122A8) 0+ params, 3 slots, 1 upvalue, 2 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [2] MOVE 1 0 4 [2] LOADI 2 22 5 [2] CONCAT 1 2 æ‹¼æ¥å¯¹è±¡ 6 [2] RETURN 2 1 1 ; 0 out å…³é—­ä¸Šå€¼ OP_CLOSE å…¬å¼:A\tclose all upvalues \u003e= R[A] å…³é—­ä¸Šå€¼\nluaç¤ºä¾‹ä»£ç \ndo local testvar function fun( ... ) testvar = 22222 end end luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 01172290) 0+ params, 2 slots, 1 upvalue, 1 local, 1 constant, 1 function 1 [1] VARARGPREP 0 2 [2] LOADNIL 0 0 ; 1 out 3 [5] CLOSURE 1 0 ; 01173D38 4 [3] SETTABUP 0 0 1 ; _ENV \"fun\" 5 [5] CLOSE 0 å…³é—­ä¸Šå€¼ 6 [7] RETURN 0 1 1k ; 0 out function \u003c.\\helloworld.lua:3,5\u003e (4 instructions at 01173D38) 0+ params, 2 slots, 1 upvalue, 0 locals, 0 constants, 0 functions 1 [3] VARARGPREP 0 2 [4] LOADI 0 22222 3 [4] SETUPVAL 0 0 ; testvar 4 [5] RETURN 0 1 1 ; 0 out tbcå˜é‡ OP_TBC å…¬å¼:A\tmark variable A \"to be closed\" æ ‡è®°å¯„å­˜å™¨ä¸ºtbc\nluaç¤ºä¾‹ä»£ç \nlocal tt\u003cclose\u003e = t; luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (4 instructions at 011C2428) 0+ params, 2 slots, 1 upvalue, 1 local, 1 constant, 0 functions 1 [1] VARARGPREP 0 2 [1] GETTABUP 0 0 0 ; _ENV \"t\" 3 [1] TBC 0 æ ‡è®°å¯„å­˜å™¨ä¸ºtbc 4 [1] RETURN 1 1 1k ; 0 out åˆ†æ”¯ä¸è·³è½¬ OP_EQ OP_EQåˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„JMPæŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®\nå…¬å¼:A B k\tif ((R[A] == R[B]) ~= k) then pc++ ç›¸ç­‰æµ‹è¯•,æ¡ä»¶è·³è½¬\nluaç¤ºä¾‹ä»£ç \nlocal a = 5 local b = 1 local c = a==b æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (8 instructions at 016F2290) 0+ params, 3 slots, 1 upvalue, 3 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 5 3 [2] LOADI 1 1 4 [3] EQ 0 1 1 æ¯”è¾ƒç›¸ç­‰ 5 [3] JMP 1 ; to 7 ä¸æ»¡è¶³æ¡ä»¶è·³è½¬ 6 [3] LFALSESKIP 2 7 [3] LOADTRUE 2 8 [3] RETURN 3 1 1 ; 0 out OP_LT OP_LTåˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„JMPæŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®\nå…¬å¼:A B k\tif ((R[A] \u003c R[B]) ~= k) then pc++ å°äºæµ‹è¯•,æ¡ä»¶è·³è½¬\nluaç¤ºä¾‹ä»£ç \nlocal a = 5 local b = 1 local c = a \u003c b æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (8 instructions at 00782290) 0+ params, 3 slots, 1 upvalue, 3 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 5 3 [2] LOADI 1 1 4 [3] LT 0 1 1 æ¯”è¾ƒå°äº 5 [3] JMP 1 ; to 7 ä¸æ»¡è¶³æ¡ä»¶è·³è½¬ 6 [3] LFALSESKIP 2 7 [3] LOADTRUE 2 8 [3] RETURN 3 1 1 ; 0 out OP_LE OP_LEåˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„JMPæŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®\nå…¬å¼:A B k\tif ((R[A] \u003c= R[B]) ~= k) then pc++ å°äºç­‰äºæµ‹è¯•,æ¡ä»¶è·³è½¬\nluaç¤ºä¾‹ä»£ç \nlocal a = 5 local b = 1 local c = a \u003c= b æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (8 instructions at 00BA2290) 0+ params, 3 slots, 1 upvalue, 3 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 5 3 [2] LOADI 1 1 4 [3] LE 0 1 1 æ¯”è¾ƒå°äºç­‰äº 5 [3] JMP 1 ; to 7 ä¸æ»¡è¶³æ¡ä»¶è·³è½¬ 6 [3] LFALSESKIP 2 7 [3] LOADTRUE 2 8 [3] RETURN 3 1 1 ; 0 out OP_EQK OP_EQKåˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„JMPæŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®\nå…¬å¼:A B k\tif ((R[A] == K[B]) ~= k) then pc++ å¸¸é‡ç›¸ç­‰æµ‹è¯•,æ¡ä»¶è·³è½¬\nluaç¤ºä¾‹ä»£ç \nlocal c = a == \"1\" æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (7 instructions at 01622290) 0+ params, 2 slots, 1 upvalue, 1 local, 2 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] GETTABUP 0 0 0 ; _ENV \"a\" 3 [1] EQK 0 1 1 ; \"1\" 4 [1] JMP 1 ; to 6 5 [1] LFALSESKIP 0 6 [1] LOADTRUE 0 7 [1] RETURN 1 1 1 ; 0 out OP_EQI OP_EQIåˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„JMPæŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®\nå…¬å¼:A sB k\tif ((R[A] == sB) ~= k) then pc++ ç«‹å³æ•°ç›¸ç­‰æµ‹è¯•,æ¡ä»¶è·³è½¬\nluaç¤ºä¾‹ä»£ç \nlocal c = a == 1 æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (7 instructions at 00802290) 0+ params, 2 slots, 1 upvalue, 1 local, 1 constant, 0 functions 1 [1] VARARGPREP 0 2 [1] GETTABUP 0 0 0 ; _ENV \"a\" 3 [1] EQI 0 1 1 ç«‹å³æ•°ç›¸ç­‰æµ‹è¯• 4 [1] JMP 1 ; to 6 ä¸ç›¸ç­‰è·³è½¬ 5 [1] LFALSESKIP 0 6 [1] LOADTRUE 0 7 [1] RETURN 1 1 1 ; 0 out OP_LTI OP_LTIåˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„JMPæŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®\nå…¬å¼:A sB k\tif ((R[A] \u003c sB) ~= k) then pc++ ç«‹å³æ•°å°äºæµ‹è¯•,æ¡ä»¶è·³è½¬\nluaç¤ºä¾‹ä»£ç \nlocal c = a \u003c 1 æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (7 instructions at 00FF2290) 0+ params, 2 slots, 1 upvalue, 1 local, 1 constant, 0 functions 1 [1] VARARGPREP 0 2 [1] GETTABUP 0 0 0 ; _ENV \"a\" 3 [1] LTI 0 1 1 ç«‹å³æ•°å°äºæµ‹è¯• 4 [1] JMP 1 ; to 6 ä¸ç¬¦åˆæ¡ä»¶è·³è½¬ 5 [1] LFALSESKIP 0 6 [1] LOADTRUE 0 7 [1] RETURN 1 1 1 ; 0 out OP_LEI OP_LEIåˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„JMPæŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®\nå…¬å¼:A sB k\tif ((R[A] \u003c= sB) ~= k) then pc++ ç«‹å³æ•°å°äºç­‰äºæµ‹è¯•,æ¡ä»¶è·³è½¬\nluaç¤ºä¾‹ä»£ç \nlocal c = a \u003c= 1 æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (7 instructions at 00CE2290) 0+ params, 2 slots, 1 upvalue, 1 local, 1 constant, 0 functions 1 [1] VARARGPREP 0 2 [1] GETTABUP 0 0 0 ; _ENV \"a\" 3 [1] LEI 0 1 1 ç«‹å³æ•°å°äºç­‰äºæµ‹è¯• 4 [1] JMP 1 ; to 6 ä¸ç¬¦åˆæ¡ä»¶è·³è½¬ 5 [1] LFALSESKIP 0 6 [1] LOADTRUE 0 7 [1] RETURN 1 1 1 ; 0 out OP_GTI OP_GTIåˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„JMPæŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®\nå…¬å¼:A sB k\tif ((R[A] \u003e sB) ~= k) then pc++ ç«‹å³æ•°å¤§äºæµ‹è¯•,æ¡ä»¶è·³è½¬\nluaç¤ºä¾‹ä»£ç \nlocal c = a \u003e 1 æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (7 instructions at 01142290) 0+ params, 2 slots, 1 upvalue, 1 local, 1 constant, 0 functions 1 [1] VARARGPREP 0 2 [1] GETTABUP 0 0 0 ; _ENV \"a\" 3 [1] GTI 0 1 1 ç«‹å³æ•°å¤§äºæµ‹è¯•,æ¡ä»¶è·³è½¬ 4 [1] JMP 1 ; to 6 ä¸ç¬¦åˆæ¡ä»¶è·³è½¬ 5 [1] LFALSESKIP 0 6 [1] LOADTRUE 0 7 [1] RETURN 1 1 1 ; 0 out OP_GEI OP_GEIåˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„JMPæŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®\nå…¬å¼:A sB k\tif ((R[A] \u003e= sB) ~= k) then pc++ ç«‹å³æ•°å¤§äºç­‰äºæµ‹è¯•,æ¡ä»¶è·³è½¬\nluaç¤ºä¾‹ä»£ç \nlocal c = a \u003e= 1 æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (7 instructions at 00C72290) 0+ params, 2 slots, 1 upvalue, 1 local, 1 constant, 0 functions 1 [1] VARARGPREP 0 2 [1] GETTABUP 0 0 0 ; _ENV \"a\" 3 [1] GEI 0 1 1 ç«‹å³æ•°å¤§äºç­‰äºæµ‹è¯•,æ¡ä»¶è·³è½¬ 4 [1] JMP 1 ; to 6 ä¸ç¬¦åˆæ¡ä»¶è·³è½¬ 5 [1] LFALSESKIP 0 6 [1] LOADTRUE 0 7 [1] RETURN 1 1 1 ; 0 out OP_TEST OP_TESTåˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„JMPæŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®\nOP_TESTé€»è¾‘æŒ‡ä»¤ç”¨äºå®ç° and å’Œ or é€»è¾‘è¿ç®—ç¬¦ å¦‚æœç›¸ç­‰åˆ™å°†å¯„å­˜å™¨Bçš„å€¼ èµ‹ç»™å¯„å­˜å™¨ A,ç„¶åç»§ç»­æ‰§è¡Œ,åä¹‹å¦‚æœä¸ç›¸ç­‰,åˆ™è·³è¿‡åé¢çš„ JMPæŒ‡ä»¤\nå…¬å¼:A k\tif (not R[A] == k) then pc++ boolæµ‹è¯•,æ¡ä»¶è·³è½¬\nluaç¤ºä¾‹ä»£ç \nlocal c = a and 1 local c = a or 1 æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (10 instructions at 00B82290) 0+ params, 2 slots, 1 upvalue, 2 locals, 1 constant, 0 functions 1 [1] VARARGPREP 0 2 [1] GETTABUP 0 0 0 ; _ENV \"a\" 3 [1] TEST 0 0 andè¿ç®—ç¬¦çš„æµ‹è¯• 4 [1] JMP 1 ; to 6 ä¸æ»¡è¶³æ¡ä»¶è·³è½¬ 5 [1] LOADI 0 1 6 [2] GETTABUP 1 0 0 ; _ENV \"a\" 7 [2] TEST 1 1 orè¿ç®—ç¬¦çš„æµ‹è¯• 8 [2] JMP 1 ; to 10 ä¸æ»¡è¶³æ¡ä»¶è·³è½¬ 9 [2] LOADI 1 1 10 [2] RETURN 2 1 1 ; 0 out OP_TESTSET OP_TESTSETåˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„JMPæŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®\nå…¬å¼:A B k\tif (not R[B] == k) then pc++ else R[A] := R[B] (*) boolæµ‹è¯•,æ¡ä»¶è·³è½¬å’Œèµ‹å€¼\nluaç¤ºä¾‹ä»£ç \nlocal a local b local c = a and b æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 00A42290) 0+ params, 3 slots, 1 upvalue, 3 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADNIL 0 1 ; 2 out 3 [3] TESTSET 2 0 0 åˆ¤æ–­å¯„å­˜å™¨B:0ä¸Šé¢çš„å€¼è½¬æˆboolå€¼å,æ˜¯å¦å’Œå¯„å­˜å™¨C:0è¡¨ç¤ºçš„boolå€¼ç›¸ç­‰ å¦‚æœç»“æœä¸€è‡´,å°†å¯„å­˜å™¨B:0ä¸Šé¢çš„å€¼å¤åˆ¶åˆ°å¯„å­˜å™¨A:2ä¸Šé¢,å¦åˆ™æ¡ä»¶è·³è½¬ 4 [3] JMP 1 ; to 6 ä¸ç¬¦åˆæ¡ä»¶è·³è½¬ 5 [3] MOVE 2 1 6 [3] RETURN 3 1 1 ; 0 out åˆ¤æ–­å¯„å­˜å™¨B:0ä¸Šé¢çš„å€¼è½¬æˆboolå€¼å,æ˜¯å¦å’Œå¯„å­˜å™¨C:0è¡¨ç¤ºçš„boolå€¼ç›¸ç­‰ å¦‚æœç»“æœä¸€è‡´,å°†å¯„å­˜å™¨B:0ä¸Šé¢çš„å€¼å¤åˆ¶åˆ°å¯„å­˜å™¨A:2ä¸Šé¢,å¦åˆ™æ¡ä»¶è·³è½¬\nä¸ç¬¦åˆæ¡ä»¶è·³è½¬\nå‡½æ•°è°ƒç”¨ OP_CALL å…¬å¼:A B C\tR[A], ... ,R[A+C-2] := R[A](R[A+1], ... ,R[A+B-1]) å‡½æ•°è°ƒç”¨\nluaç¤ºä¾‹ä»£ç \nfunction fun() end fun() luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 00802290) 0+ params, 2 slots, 1 upvalue, 0 locals, 1 constant, 1 function 1 [1] VARARGPREP 0 2 [3] CLOSURE 0 0 ; 00803BE8 3 [1] SETTABUP 0 0 0 ; _ENV \"fun\" 4 [5] GETTABUP 0 0 0 ; _ENV \"fun\" 5 [5] CALL 0 1 1 ; 0 in 0 out å‡½æ•°è°ƒç”¨ 6 [5] RETURN 0 1 1 ; 0 out function \u003c.\\helloworld.lua:1,3\u003e (1 instruction at 00803BE8) 0 params, 2 slots, 0 upvalues, 0 locals, 0 constants, 0 functions 1 [3] RETURN0 OP_TAILCALL å…¬å¼:A B C k\treturn R[A](R[A+1], ... ,R[A+B-1]) å°¾è°ƒç”¨\nluaç¤ºä¾‹ä»£ç \nfunction fun1() return fun2(111, 222) end luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (4 instructions at 00E82290) 0+ params, 2 slots, 1 upvalue, 0 locals, 1 constant, 1 function 1 [1] VARARGPREP 0 2 [3] CLOSURE 0 0 ; 00E83BE8 3 [1] SETTABUP 0 0 0 ; _ENV \"fun1\" 4 [3] RETURN 0 1 1 ; 0 out function \u003c.\\helloworld.lua:1,3\u003e (6 instructions at 00E83BE8) 0 params, 3 slots, 1 upvalue, 0 locals, 1 constant, 0 functions 1 [2] GETTABUP 0 0 0 ; _ENV \"fun2\" 2 [2] LOADI 1 111 3 [2] LOADI 2 222 4 [2] TAILCALL 0 3 0 ; 2 in å°¾è°ƒç”¨ 5 [2] RETURN 0 0 0 ; all out 6 [3] RETURN0 å› ä¸ºè°ƒç”¨fun2å,fun1ä¸­ä¸å†æ‰§è¡Œä»»ä½•ä»£ç ,æ‰€ä»¥ä¸éœ€è¦ä¿ç•™fun1çš„è°ƒç”¨æ ˆä¿¡æ¯,Luaåšäº†è¿™æ ·çš„ä¼˜åŒ–,ç§°ä¸ºå°¾è°ƒç”¨æ¶ˆé™¤,fun2è¿”å›å,æ§åˆ¶ç‚¹ç›´æ¥è¿”å›åˆ°è°ƒç”¨fun1çš„åœ°æ–¹,æœ‰ç‚¹ç±»ä¼¼cè¯­è¨€çš„gotoè¯­å¥,è¿™æ ·åšèƒ½å‡å°‘æ ˆçš„ç©ºé—´æ¶ˆè€—,éå¸¸nice\nOP_RETURN å…¬å¼:A B C k\treturn R[A], ... ,R[A+B-2]\t(see note) ä»å‡½æ•°è°ƒç”¨è¿”å›\nluaç¤ºä¾‹ä»£ç \nfunction fun1() return 1,2,3,4 end local x,y,z = fun1() luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 00E22280) 0+ params, 3 slots, 1 upvalue, 3 locals, 1 constant, 1 function 1 [1] VARARGPREP 0 2 [3] CLOSURE 0 0 ; 00E23BD8 3 [1] SETTABUP 0 0 0 ; _ENV \"fun1\" 4 [5] GETTABUP 0 0 0 ; _ENV \"fun1\" 5 [5] CALL 0 1 4 ; 0 in 3 out 6 [5] RETURN 3 1 1 ; 0 out function \u003c.\\helloworld.lua:1,3\u003e (6 instructions at 00E23BD8) 0 params, 4 slots, 0 upvalues, 0 locals, 0 constants, 0 functions 1 [2] LOADI 0 1 2 [2] LOADI 1 2 3 [2] LOADI 2 3 4 [2] LOADI 3 4 5 [2] RETURN 0 5 0 ; 4 out è¿”å›4ä¸ªå‚æ•° 6 [3] RETURN0 å¦‚æœå¯„å­˜å™¨B==0 è¾“å‡ºall out å¦‚æœå¯„å­˜å™¨B\u003e0 è¾“å…¥B-1ä¸ªè¿”å›å€¼ OP_RETURN0 å…¬å¼:return è¿”å›æ— ç»“æœ\nluaç¤ºä¾‹ä»£ç \nfunction fun1() return end local x = fun1() luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 00C32290) 0+ params, 2 slots, 1 upvalue, 1 local, 1 constant, 1 function 1 [1] VARARGPREP 0 2 [3] CLOSURE 0 0 ; 00C33BE8 3 [1] SETTABUP 0 0 0 ; _ENV \"fun1\" 4 [5] GETTABUP 0 0 0 ; _ENV \"fun1\" 5 [5] CALL 0 1 2 ; 0 in 1 out 6 [5] RETURN 1 1 1 ; 0 out function \u003c.\\helloworld.lua:1,3\u003e (2 instructions at 00C33BE8) 0 params, 2 slots, 0 upvalues, 0 locals, 0 constants, 0 functions 1 [2] RETURN0 è¿”å›æ— ç»“æœ 2 [3] RETURN0 è¿”å›æ— ç»“æœ OP_RETURN1 å…¬å¼:A\treturn R[A] è¿”å›ä¸€ä¸ªå‚æ•°\nluaç¤ºä¾‹ä»£ç \nfunction fun1() return 1 end local x = fun1() luac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (6 instructions at 00BA2290) 0+ params, 2 slots, 1 upvalue, 1 local, 1 constant, 1 function 1 [1] VARARGPREP 0 2 [3] CLOSURE 0 0 ; 00BA3BE8 3 [1] SETTABUP 0 0 0 ; _ENV \"fun1\" 4 [5] GETTABUP 0 0 0 ; _ENV \"fun1\" 5 [5] CALL 0 1 2 ; 0 in 1 out 6 [5] RETURN 1 1 1 ; 0 out function \u003c.\\helloworld.lua:1,3\u003e (3 instructions at 00BA3BE8) 0 params, 2 slots, 0 upvalues, 0 locals, 0 constants, 0 functions 1 [2] LOADI 0 1 2 [2] RETURN1 0 è¿”å›1ä¸ªå€¼ 3 [3] RETURN0 OP_VARARG å…¬å¼:A C\tR[A], R[A+1], ..., R[A+C-2] = vararg å°†å‡½æ•°çš„å¯å˜å‚æ•°æ‹·è´ç»™å¯„å­˜å™¨\nluaç¤ºä¾‹ä»£ç \nlocal a = ... æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (3 instructions at 00A92290) 0+ params, 2 slots, 1 upvalue, 1 local, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] VARARG 0 2 ; 1 out 3 [1] RETURN 1 1 1 ; 0 out â€‹\tå¦‚æœå¯„å­˜å™¨Cç­‰äº0é‚£ä¹ˆå°±è¾“å‡ºall out å¦åˆ™è¾“å‡º c-1 out\nâ€‹\tè¿™ä¸ªCé‡Œé¢çš„å€¼å°±æ˜¯local a = ... ç­‰å·å‰é¢å±€éƒ¨å˜é‡çš„ä¸ªæ•°,æ¯”å¦‚ç°åœ¨åªæœ‰ä¸€ä¸ªå±€éƒ¨å˜é‡aé‚£ä¹ˆå°±æ˜¯1\nOP_VARARGPREP å…¬å¼:A\t(adjust vararg parameters) æŸ¥çœ‹å¯å˜å‚æ•°æ–¹å¼ä¸‹å›ºå®šå‚æ•°ä¸ªæ•°\nluaç¤ºä¾‹ä»£ç \nfunction func(a,b, ...) end æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (4 instructions at 00F52290) 0+ params, 2 slots, 1 upvalue, 0 locals, 1 constant, 1 function 1 [1] VARARGPREP 0 2 [3] CLOSURE 0 0 ; 00F53BE8 3 [1] SETTABUP 0 0 0 ; _ENV \"func\" 4 [3] RETURN 0 1 1 ; 0 out function \u003c.\\helloworld.lua:1,3\u003e (2 instructions at 00F53BE8) 2+ params, 2 slots, 0 upvalues, 2 locals, 0 constants, 0 functions 1 [1] VARARGPREP 2 æŸ¥çœ‹å¯å˜å‚æ•°æ–¹å¼ä¸‹å›ºå®šå‚æ•°ä¸ªæ•° 2 [3] RETURN 2 1 3 ; 0 out â€‹\tå› ä¸ºfuncå‡½æ•°é‡Œé¢æœ‰a,bå›ºå®šçš„ä¸¤ä¸ªå›ºå®šå˜é‡,æ‰€ä»¥æŒ‡ä»¤å“ªé‡Œå¯ä»¥çœ‹åˆ°æ˜¯2\niABxæ“ä½œæ•°æ¨¡å¼ å ç”¨bitä½èŒƒå›´\næ“ä½œ èŒƒå›´(å•ä½bit) Op(7) 0~6 A(8) 7~14 Bx(17) 15~31 OP_LOADK å…¬å¼:A Bx\tR[A] := K[Bx] åŠ è½½å¸¸é‡ç«‹å³æ•°åˆ°å¯„å­˜å™¨\nluaä¼šå°†\nå¸¸é‡è¡¨è¾¾å¼ å­—ç¬¦ä¸² æ•´å‹,æµ®ç‚¹å‹è¶…å‡ºå¯„å­˜å™¨sBxæ“ä½œæ•°å€¼èŒƒå›´çš„æ•° ç­‰ç­‰ éƒ½æ”¾åˆ°å¸¸é‡è¡¨ä¸­\nluaç¤ºä¾‹ä»£ç \nlocal a = \"lllllll\" å­—ç¬¦ä¸² local b = 333333333333333333333333333333333333333333333 æ•´å‹è¶…å‡ºå¯„å­˜å™¨sBxæ“ä½œæ•°å€¼ local c = 111111111111111111111111.111111111111111111111 æµ®ç‚¹æ•°è¶…å‡ºå¯„å­˜å™¨sBxæ“ä½œæ•°å€¼ æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (5 instructions at 00F822A8) 0+ params, 3 slots, 1 upvalue, 3 locals, 3 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADK 0 0 ; \"lllllll\" ä»å¸¸é‡è¡¨0å·ä½ç½®ä¸­å°†\"lllllll\"åŠ è½½åˆ°å¯„å­˜å™¨çš„0å·ä½ç½® 3 [2] LOADK 1 1 ; 3.3333333333333e+44 ä»å¸¸é‡è¡¨1å·ä½ç½®å°†3.3333333333333e+44åŠ è½½åˆ°å¯„å­˜å™¨çš„1å·ä½ç½® 4 [3] LOADK 2 2 ; 1.1111111111111e+23 ä»å¸¸é‡è¡¨2å·ä½ç½®å°†1.1111111111111e+23åŠ è½½åˆ°å¯„å­˜å™¨çš„2å·ä½ç½® 5 [3] RETURN 3 1 1 ; 0 out OP_LOADKX å…¬å¼:A\tR[A] := K[extra arg] åŠ è½½å¸¸é‡,å¸¸é‡ä»ä¸‹ä¸€æ¡OP_EXTRAARGæŒ‡ä»¤å¾—åˆ°\nå½“éœ€è¦ç”ŸæˆLOADKæŒ‡ä»¤æ—¶,å¦‚æœéœ€è¦ç´¢å¼•çš„å¸¸é‡idè¶…å‡ºäº†Bxæ‰€èƒ½è¡¨ç¤ºçš„æœ‰æ•ˆèŒƒå›´,é‚£ä¹ˆå°±ç”Ÿæˆä¸€ä¸ªLOADKXæŒ‡ä»¤,å–ä»£LOADKæŒ‡ä»¤,å¹¶ä¸”æ¥ä¸‹æ¥ç«‹å³ç”Ÿæˆä¸€ä¸ªEXTRAARGæŒ‡ä»¤,å¹¶ç”¨å…¶Axæ¥å­˜æ”¾è¿™ä¸ªid\nBxçš„ä½æ•°æ˜¯17ä½,é‚£ä¹ˆèƒ½æ ‡è¯†çš„æ— ç¬¦å·æœ€å¤§å€¼æ˜¯17ä¸ª1 ä¹Ÿå°±æ˜¯2^17-1 = 262143ä¸ªç´¢å¼• Axçš„ä½æ•°æ˜¯25ä½,é‚£ä¹ˆèƒ½æ ‡è¯†çš„æ— ç¬¦å·æœ€å¤§å€¼æ˜¯25ä¸ª1 ä¹Ÿå°±æ˜¯2^25-1 = 67108863ä¸ªç´¢å¼• æ‰€ä»¥æˆ‘ä»¬èƒ½å¾—å‡ºç»“è®ºluaå¸¸é‡è¡¨çš„ç´¢å¼•èƒ½è¾¾åˆ°æƒŠäººçš„ 262143 + 67108863 = 67371006ä¸ªç´¢å¼• é‰´äºè¶…çº§å¤§çš„ç´¢å¼•èŒƒå›´,è¿™ä¸ªå°±ä¸å¼„luaç¤ºä¾‹ä»£ç äº†,å¤§å®¶çŸ¥é“åªè¦è¶…è¿‡262143çš„ç´¢å¼•,å°±ä¼šè§¦å‘OP_LOADKXæŒ‡ä»¤,å¹¶ç”¨å…¶Axæ¥å­˜æ”¾è¿™ä¸ªè¶…å‡ºèŒƒå›´çš„idå°±å¥½äº†\nforå¾ªç¯ OP_FORLOOP å…¬å¼:A Bx\tupdate counters; if loop continues then pc-=Bx; æ•°å€¼forå¾ªç¯\nluaç¤ºä¾‹ä»£ç \nfor i=1,100,10 do //åˆå§‹å€¼ä¸º1,æ­¥é•¿ä¸º10,ä¸Šé™ä¸º100 end æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (7 instructions at 00A022A8) 0+ params, 4 slots, 1 upvalue, 4 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [1] LOADI 1 100 4 [1] LOADI 2 10 5 [1] FORPREP 0 0 ; exit to 7 æ•°å€¼forå¾ªç¯ 6 [1] FORLOOP 0 1 ; to 6 æ•°å€¼forå¾ªç¯ 7 [3] RETURN 0 1 1 ; 0 out è¯¥æŒ‡ä»¤å…ˆç»™iåŠ ä¸Šæ­¥é•¿,ç„¶ååˆ¤æ–­iæ˜¯å¦åœ¨èŒƒå›´ä¹‹å†….è‹¥å·²ç»è¶…å‡ºèŒƒå›´,åˆ™å¾ªç¯ç»“æŸ\nè‹¥æ²¡è¶…å‡ºèŒƒå›´,åˆ™å°†æ•°å€¼æ‹·è´ç»™ç”¨æˆ·å®šä¹‰çš„å±€éƒ¨å˜é‡\nç„¶åè·³è½¬åˆ°å¾ªç¯ä½“å†…éƒ¨å¼€å§‹æ‰§è¡Œå…·ä½“çš„ä»£ç å—\nOP_FORPREP å…¬å¼:A Bx\t; if not to run then pc+=Bx+1; æ•°å€¼forå¾ªç¯\nluaç¤ºä¾‹ä»£ç \nfor i=1,100,10 do //åˆå§‹å€¼ä¸º1,æ­¥é•¿ä¸º10,ä¸Šé™ä¸º100 end æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (7 instructions at 00A022A8) 0+ params, 4 slots, 1 upvalue, 4 locals, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 1 3 [1] LOADI 1 100 4 [1] LOADI 2 10 5 [1] FORPREP 0 0 ; exit to 7 æ•°å€¼forå¾ªç¯ 6 [1] FORLOOP 0 1 ; to 6 æ•°å€¼forå¾ªç¯ 7 [3] RETURN 0 1 1 ; 0 out è¯¥æŒ‡ä»¤çš„ç›®çš„æ˜¯åœ¨å¾ªç¯ä¹‹å‰é¢„å…ˆå°†iå‡å»æ­¥é•¿å¾—åˆ°-1,ç„¶åè·³è½¬åˆ°FORLOOPæŒ‡ä»¤æ­£å¼å¼€å§‹å¾ªç¯\nOP_TFORPREP å…¬å¼:A Bx\tcreate upvalue for R[A + 3]; pc+=Bx é™¤äº†é€šç”¨forå¾ªç¯ä½œç”¨è¿˜å…¼é¡¾å…³é—­upvalueå€¼\nluaç¤ºä¾‹ä»£ç \nfor k,v in pairs(t) do print(k,v) end æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (13 instructions at 00C22290) 0+ params, 9 slots, 1 upvalue, 6 locals, 3 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] GETTABUP 0 0 0 ; _ENV \"pairs\" 3 [1] GETTABUP 1 0 1 ; _ENV \"t\" 4 [1] CALL 0 2 5 ; 1 in 4 out 5 [1] TFORPREP 0 4 ; to 10 é™¤äº†é€šç”¨forå¾ªç¯ä½œç”¨è¿˜å…¼é¡¾å…³é—­`upvalue`å€¼ 6 [2] GETTABUP 6 0 2 ; _ENV \"print\" 7 [2] MOVE 7 4 8 [2] MOVE 8 5 9 [2] CALL 6 3 1 ; 2 in 0 out 10 [1] TFORCALL 0 2 11 [1] TFORLOOP 0 6 ; to 6 12 [3] CLOSE 0 13 [3] RETURN 0 1 1k ; 0 out OP_TFORCALL å…¬å¼:A C\tR[A+4], ... ,R[A+3+C] := R[A](R[A+1], R[A+2]); é€šç”¨forå¾ªç¯\nluaç¤ºä¾‹ä»£ç \nfor k,v in pairs(t) do print(k,v) end æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (13 instructions at 00C22290) 0+ params, 9 slots, 1 upvalue, 6 locals, 3 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] GETTABUP 0 0 0 ; _ENV \"pairs\" 3 [1] GETTABUP 1 0 1 ; _ENV \"t\" 4 [1] CALL 0 2 5 ; 1 in 4 out 5 [1] TFORPREP 0 4 ; to 10 6 [2] GETTABUP 6 0 2 ; _ENV \"print\" 7 [2] MOVE 7 4 8 [2] MOVE 8 5 9 [2] CALL 6 3 1 ; 2 in 0 out 10 [1] TFORCALL 0 2 é€šç”¨forå¾ªç¯ 11 [1] TFORLOOP 0 6 ; to 6 12 [3] CLOSE 0 13 [3] RETURN 0 1 1k ; 0 out ç¼–è¯‘å™¨ä½¿ç”¨çš„ç¬¬ä¸€ä¸ªç‰¹æ®Šå˜é‡(generator):få­˜æ”¾çš„æ˜¯è¿­ä»£å™¨,å…¶ä»–ä¸¤ä¸ªç‰¹æ®Šå˜é‡(state):s (control):varæ¥è°ƒç”¨è¿­ä»£å™¨\næŠŠç»“æœä¿å­˜åœ¨ç”¨æˆ·å®šä¹‰çš„å˜é‡k,vä¸­\nOP_TFORLOOP å…¬å¼:A Bx\tif R[A+2] ~= nil then { R[A]=R[A+2]; pc -= Bx } é€šç”¨forå¾ªç¯\nluaç¤ºä¾‹ä»£ç \nfor k,v in pairs(t) do print(k,v) end æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (13 instructions at 00C22290) 0+ params, 9 slots, 1 upvalue, 6 locals, 3 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] GETTABUP 0 0 0 ; _ENV \"pairs\" 3 [1] GETTABUP 1 0 1 ; _ENV \"t\" 4 [1] CALL 0 2 5 ; 1 in 4 out 5 [1] TFORPREP 0 4 ; to 10 6 [2] GETTABUP 6 0 2 ; _ENV \"print\" 7 [2] MOVE 7 4 8 [2] MOVE 8 5 9 [2] CALL 6 3 1 ; 2 in 0 out 10 [1] TFORCALL 0 2 11 [1] TFORLOOP 0 6 ; to 6 é€šç”¨forå¾ªç¯ 12 [3] CLOSE 0 13 [3] RETURN 0 1 1k ; 0 out è‹¥è¿­ä»£å™¨è¿”å›çš„kå€¼ä¸æ˜¯nilï¼Œåˆ™æŠŠè¯¥å€¼æ‹·è´åˆ°(control):var,ç„¶åè·³è½¬åˆ°å¾ªç¯ä½“ å¦åˆ™è‹¥ä¸ºnil,åˆ™å¾ªç¯ç»“æŸ\nå‡½æ•°è°ƒç”¨ OP_CLOSURE å…¬å¼:A Bx\tR[A] := closure(KPROTO[Bx]) æ ¹æ®å‡½æ•°åŸå‹æ–°å»ºä¸€ä¸ªé—­åŒ…\nluaç¤ºä¾‹ä»£ç \nfunction x() end æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (4 instructions at 00BD22A8) 0+ params, 2 slots, 1 upvalue, 0 locals, 1 constant, 1 function 1 [1] VARARGPREP 0 2 [3] CLOSURE 0 0 ; 00BD3C08 æ ¹æ®å‡½æ•°åŸå‹æ–°å»ºä¸€ä¸ªé—­åŒ… 3 [1] SETTABUP 0 0 0 ; _ENV \"x\" 4 [3] RETURN 0 1 1 ; 0 out function \u003c.\\helloworld.lua:1,3\u003e (1 instruction at 00BD3C08) 0 params, 2 slots, 0 upvalues, 0 locals, 0 constants, 0 functions 1 [3] RETURN0 â€‹\tæŠŠå½“å‰Luaå‡½æ•°çš„å­å‡½æ•°åŸå‹å®ä¾‹åŒ–ä¸ºé—­åŒ…\niAsBxæ“ä½œæ•°æ¨¡å¼ å ç”¨bitä½èŒƒå›´\næ“ä½œ èŒƒå›´(å•ä½bit) Op(7) 0~6 A(8) 7~14 sBx(17) 15~31 åŠ è½½ OP_LOADI å…¬å¼:A sBx R[A] := sBx åŠ è½½æ•´å‹ç«‹å³æ•°åˆ°å¯„å­˜å™¨\nluaç¤ºä¾‹ä»£ç \nlocal B = 10 æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (3 instructions at 010F2290) 0+ params, 2 slots, 1 upvalue, 1 local, 0 constants, 0 functions 1 [1] VARARGPREP 0 æŸ¥çœ‹å¯å˜å‚æ•°æ–¹å¼ä¸‹å›ºå®šå‚æ•°ä¸ªæ•° 2 [1] LOADI 0 10 å°†æ•´å‹ç«‹å³æ•°10åŠ è½½åˆ°å¯„å­˜å™¨çš„0å·ä½ç½® 3 [1] RETURN 1 1 1 ; 0 out è¿”å›0ä¸ªå€¼ ä¸Šé¢æ­¥éª¤å¤§æ¦‚æ„æ€\nå°†å±€éƒ¨å˜é‡Båˆ†é…åˆ°å¯„å­˜å™¨0å·ä½ç½®\nç„¶åæ‰§è¡ŒVARARGPREPæŒ‡ä»¤æŸ¥çœ‹ä¸‹å¯å˜å‚æ•°æ–¹å¼ä¸‹çš„å›ºå®šå‚æ•°æ•°é‡ å°†æ•´å‹ç«‹å³æ•°10åŠ è½½åˆ°å¯„å­˜å™¨çš„0å·ä½ç½® 0 out çš„æ„æ€æ˜¯è¿”å›0ä¸ªå€¼ OP_LOADF å…¬å¼:A sBx\tR[A] := (lua_Number)sBx åŠ è½½æµ®ç‚¹ç«‹å³æ•°åˆ°å¯„å­˜å™¨\nluaç¤ºä¾‹ä»£ç \nlocal B = 10.0 æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\nmain \u003c.\\helloworld.lua:0,0\u003e (3 instructions at 010F2290) 0+ params, 2 slots, 1 upvalue, 1 local, 0 constants, 0 functions 1 [1] VARARGPREP 0 æŸ¥çœ‹å¯å˜å‚æ•°æ–¹å¼ä¸‹å›ºå®šå‚æ•°ä¸ªæ•° 2 [1] LOADF 0 10 å°†æµ®ç‚¹ç«‹å³æ•°10åŠ è½½åˆ°å¯„å­˜å™¨çš„0å·ä½ç½® 3 [1] RETURN 1 1 1 ; 0 out è¿”å›0ä¸ªå€¼ ä¸Šé¢æ­¥éª¤å¤§æ¦‚æ„æ€\nå°†å±€éƒ¨å˜é‡Båˆ†é…åˆ°å¯„å­˜å™¨0å·ä½ç½®\nç„¶åæ‰§è¡ŒVARARGPREPæŒ‡ä»¤æŸ¥çœ‹ä¸‹å¯å˜å‚æ•°æ–¹å¼ä¸‹çš„å›ºå®šå‚æ•°æ•°é‡ å°†ç«‹å³æ•°10åŠ è½½åˆ°å¯„å­˜å™¨çš„0å·ä½ç½® 0 out çš„æ„æ€æ˜¯è¿”å›0ä¸ªå€¼ iAxæ“ä½œæ•°æ¨¡å¼ å ç”¨bitä½èŒƒå›´\næ“ä½œ èŒƒå›´(å•ä½bit) Op(7) 0~6 Ax(25) 7~31 é¢å¤–å‚æ•° OP_EXTRAARG Axçš„ä½æ•°æ˜¯25ä½,é‚£ä¹ˆèƒ½æ ‡è¯†çš„æ— ç¬¦å·æœ€å¤§å€¼æ˜¯25ä¸ª1 ä¹Ÿå°±æ˜¯2^25-1 = 67108863ä¸ªç´¢å¼•\næ‰€ä»¥å½“OP_LOADKXæŒ‡ä»¤ç´¢å¼•ä¸å¤Ÿçš„æ—¶å€™,ä¹Ÿç”¨è¿™ä¸ªæŒ‡ä»¤ç»­ç´¢å¼•,OP_LOADKXå¼€è¾Ÿçš„æŒ‡ä»¤ç´¢å¼•åŠ è½½è¿™ä¸ªé¢å¤–æ‰©å±•çš„ç´¢å¼•è¶³å¤Ÿä½¿ç”¨äº†\nisJæ“ä½œæ•°æ¨¡å¼ å ç”¨bitä½èŒƒå›´\næ“ä½œ èŒƒå›´(å•ä½bit) Op(7) 0~6 sJ(25) 7~31 åˆ†æ”¯ä¸è·³è½¬ OP_JMP OP_EQ OP_LT OP_LE OP_EQK OP_EQI OP_LTI OP_LEI OP_GTI OP_GEI OP_TEST OP_TESTSET 11ä¸ªåˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„JMPæŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®\nå…¬å¼:sJ\tpc += sJ æ— æ¡ä»¶è·³è½¬\nluaç¤ºä¾‹ä»£ç \nlocal a = 5 \u003c 2 æ‰§è¡Œluac54 -l Helloworld.luaç»“æœ\n0+ params, 2 slots, 1 upvalue, 1 local, 0 constants, 0 functions 1 [1] VARARGPREP 0 2 [1] LOADI 0 2 3 [1] LTI 0 5 1 æ¯”è¾ƒå¤§å° 4 [1] JMP 1 ; to 6 è¿›è¡Œè·³è½¬ 5 [1] LFALSESKIP 0\t6 [1] LOADTRUE 0 7 [1] RETURN 1 1 1 ; 0 out æŒ‡ä»¤å±æ€§çš„æ©ç  bitä½ ä½œç”¨ 0~2 æŒ‡ä»¤çš„ç±»å‹ ä¹Ÿå°±æ˜¯è¿™äº› {iABC, iABx, iAsBx, iAx, isJ} 3 æŒ‡ä»¤æ˜¯å¦ä¿®æ”¹äº†å¯„å­˜å™¨A 4 åˆ¤æ–­å½“å‰æŒ‡ä»¤æ˜¯å¦æ¶‰åŠä¸€æ¬¡æ¡ä»¶è·³è½¬ å¢åŠ è¿™ä¸ªæ ‡è®°å¯ä»¥ç”¨æ¥æ£€æµ‹åˆ†æ”¯æŒ‡ä»¤è¿™ä¸€ä¸ªæ‰“çš„ç±»åˆ«,\nè¿™æ ·ç®€åŒ–äº†æŒ‡ä»¤é›†,å½“é‡åˆ°è·³è½¬æŒ‡ä»¤çš„æ—¶å€™,\nå¯ä»¥å›åˆ°å‰ä¸€æ¡æŒ‡ä»¤æ¥çœ‹çœ‹é‚£æ˜¯å¦æ˜¯æ¡ä»¶è·³è½¬ 5 ä½¿ç”¨å‰ä¸€æ¡æŒ‡ä»¤è®¾ç½®çš„æ ˆé¡¶å€¼ï¼ˆå½“ B == 0 æ—¶ï¼‰ 6 å°†å€¼æ”¾åˆ°æ ˆé¡¶,ä¾›åé¢çš„æŒ‡ä»¤ä½¿ç”¨ï¼ˆå½“C == 0æ—¶ï¼‰ 7 æŒ‡ä»¤æ˜¯MMæŒ‡ä»¤ï¼ˆè°ƒç”¨å…ƒæ–¹æ³•ï¼‰ æŒ‡ä»¤çš„åˆ›å»º åˆ›å»ºABCKæŒ‡ä»¤ #define CREATE_ABCk(o,a,b,c,k)\t((cast(Instruction, o)\u003c",
  "wordCount" : "16513",
  "inLanguage": "en",
  "image":"https://frog-game.github.io/posts/read/lua5.4.4.code/image-20230223204632470.png","datePublished": "2023-02-28T01:30:29+08:00",
  "dateModified": "2023-02-28T01:30:29+08:00",
  "author":[{
    "@type": "Person",
    "name": "frog"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://frog-game.github.io/posts/read/lua5.4.4.code/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "frog's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://frog-game.github.io/img/Q.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>



<script async src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>


<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://frog-game.github.io/" accesskey="h" title="frog&#39;s Blog (Alt + H)">
            <img src="https://frog-game.github.io/img/Q.gif" alt="logo" aria-label="logo"
                 height="35">frog&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://frog-game.github.io/search" title="ğŸ” æœç´¢ (Alt &#43; /)" accesskey=/>
                <span>ğŸ” æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://frog-game.github.io/" title="ğŸ  ä¸»é¡µ">
                <span>ğŸ  ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://frog-game.github.io/posts" title="ğŸ“š æ–‡ç« ">
                <span>ğŸ“š æ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://frog-game.github.io/tags" title="ğŸ§© æ ‡ç­¾">
                <span>ğŸ§© æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://frog-game.github.io/archives/" title="â± æ—¶é—´è½´">
                <span>â± æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://frog-game.github.io/about" title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº">
                <span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span>
                </a>
            </li>
            <li>
                <a href="https://frog-game.github.io/links" title="ğŸ¤ å‹é“¾">
                <span>ğŸ¤ å‹é“¾</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs"><a href="https://frog-game.github.io/">ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://frog-game.github.io/posts/">ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href="https://frog-game.github.io/posts/read/">ğŸ“• é˜…è¯»</a></div>
            <h1 class="post-title">
                [Lua5.4.4æºç ].æŒ‡ä»¤é›†
            </h1>
            <div class="post-description">
                luaæºç æŒ‡ä»¤é›†åˆ†æ
            </div>
            <div class="post-meta">åˆ›å»º:&nbsp;<span title='2023-02-28 01:30:29 +0800 CST'>2023-02-28</span>&nbsp;|&nbsp;æ›´æ–°:&nbsp;2023-02-28&nbsp;|&nbsp;å­—æ•°:&nbsp;16513å­—&nbsp;|&nbsp;æ—¶é•¿:&nbsp;33åˆ†é’Ÿ&nbsp;|&nbsp;
ä½œè€…:&nbsp;frog



                &nbsp;|&nbsp;æ ‡ç­¾: &nbsp;
                <ul class="post-tags-meta">
                    <a href="https://frog-game.github.io/tags/lua5.4.4%E6%BA%90%E7%A0%81/">Lua5.4.4æºç </a>
                </ul>

                
                <span id="busuanzi_container_page_pv">
            </span>

</div>
        </header> 
<figure class="entry-cover1"><img loading="lazy" src="https://frog-game.github.io/posts/read/lua5.4.4.code/image-20230223204632470.png" alt="">
        
</figure>
        <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">æ–‡ç« ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e6%8c%87%e4%bb%a4%e9%9b%86%e7%ae%80%e4%bb%8b" aria-label="æŒ‡ä»¤é›†ç®€ä»‹">æŒ‡ä»¤é›†ç®€ä»‹</a></li>
                <li>
                    <a href="#%e6%93%8d%e4%bd%9c%e6%95%b0%e7%bc%96%e7%a0%81%e6%a8%a1%e5%bc%8f%e4%b8%80%e5%85%b15%e4%b8%ad" aria-label="æ“ä½œæ•°ç¼–ç æ¨¡å¼ä¸€å…±5ä¸­">æ“ä½œæ•°ç¼–ç æ¨¡å¼ä¸€å…±5ä¸­</a><ul>
                        
                <li>
                    <a href="#%e7%9c%8b%e6%8c%87%e4%bb%a4%e5%89%8d%e7%9a%84%e4%b8%80%e4%ba%9b%e7%ac%a6%e5%8f%b7%e8%a7%a3%e9%87%8a" aria-label="çœ‹æŒ‡ä»¤å‰çš„ä¸€äº›ç¬¦å·è§£é‡Š">çœ‹æŒ‡ä»¤å‰çš„ä¸€äº›ç¬¦å·è§£é‡Š</a></li>
                <li>
                    <a href="#iabc%e6%93%8d%e4%bd%9c%e6%95%b0%e6%a8%a1%e5%bc%8f" aria-label="iABCæ“ä½œæ•°æ¨¡å¼">iABCæ“ä½œæ•°æ¨¡å¼</a><ul>
                        
                <li>
                    <a href="#%e8%b5%8b%e5%80%bc%e5%8a%a0%e8%bd%bd%e6%8c%87%e4%bb%a4" aria-label="èµ‹å€¼åŠ è½½æŒ‡ä»¤">èµ‹å€¼åŠ è½½æŒ‡ä»¤</a><ul>
                        
                <li>
                    <a href="#op_move" aria-label="OP_MOVE">OP_MOVE</a></li>
                <li>
                    <a href="#op_loadfalse" aria-label="OP_LOADFALSE">OP_LOADFALSE</a></li>
                <li>
                    <a href="#op_lfalseskip" aria-label="OP_LFALSESKIP">OP_LFALSESKIP</a></li>
                <li>
                    <a href="#op_loadtrue" aria-label="OP_LOADTRUE">OP_LOADTRUE</a></li>
                <li>
                    <a href="#op_loadnil" aria-label="OP_LOADNIL">OP_LOADNIL</a></li>
                <li>
                    <a href="#op_getupval" aria-label="OP_GETUPVAL">OP_GETUPVAL</a></li>
                <li>
                    <a href="#op_setupval" aria-label="OP_SETUPVAL">OP_SETUPVAL</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%a1%a8%e6%93%8d%e4%bd%9c" aria-label="è¡¨æ“ä½œ">è¡¨æ“ä½œ</a><ul>
                        
                <li>
                    <a href="#op_gettabup" aria-label="OP_GETTABUP">OP_GETTABUP</a></li>
                <li>
                    <a href="#op_gettable" aria-label="OP_GETTABLE">OP_GETTABLE</a></li>
                <li>
                    <a href="#op_geti" aria-label="OP_GETI">OP_GETI</a></li>
                <li>
                    <a href="#op_getfield" aria-label="OP_GETFIELD">OP_GETFIELD</a></li>
                <li>
                    <a href="#op_settabup" aria-label="OP_SETTABUP">OP_SETTABUP</a></li>
                <li>
                    <a href="#op_newtable" aria-label="OP_NEWTABLE">OP_NEWTABLE</a></li>
                <li>
                    <a href="#op_self" aria-label="OP_SELF">OP_SELF</a></li>
                <li>
                    <a href="#op_setlist" aria-label="OP_SETLIST">OP_SETLIST</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%ae%97%e6%9c%af%e5%92%8c%e4%bd%8d%e8%bf%90%e7%ae%97" aria-label="ç®—æœ¯å’Œä½è¿ç®—">ç®—æœ¯å’Œä½è¿ç®—</a><ul>
                        
                <li>
                    <a href="#op_addi" aria-label="OP_ADDI">OP_ADDI</a></li>
                <li>
                    <a href="#op_addk" aria-label="OP_ADDK">OP_ADDK</a></li>
                <li>
                    <a href="#op_subk" aria-label="OP_SUBK">OP_SUBK</a></li>
                <li>
                    <a href="#op_mulk" aria-label="OP_MULK">OP_MULK</a></li>
                <li>
                    <a href="#op_modk" aria-label="OP_MODK">OP_MODK</a></li>
                <li>
                    <a href="#op_divk" aria-label="OP_DIVK">OP_DIVK</a></li>
                <li>
                    <a href="#op_idivk" aria-label="OP_IDIVK">OP_IDIVK</a></li>
                <li>
                    <a href="#op_bandk" aria-label="OP_BANDK">OP_BANDK</a></li>
                <li>
                    <a href="#op_bork" aria-label="OP_BORK">OP_BORK</a></li>
                <li>
                    <a href="#op_bxork" aria-label="OP_BXORK">OP_BXORK</a></li>
                <li>
                    <a href="#op_shri" aria-label="OP_SHRI">OP_SHRI</a></li>
                <li>
                    <a href="#op_shli" aria-label="OP_SHLI">OP_SHLI</a></li>
                <li>
                    <a href="#op_add" aria-label="OP_ADD">OP_ADD</a></li>
                <li>
                    <a href="#op_sub" aria-label="OP_SUB">OP_SUB</a></li>
                <li>
                    <a href="#op_mul" aria-label="OP_MUL">OP_MUL</a></li>
                <li>
                    <a href="#op_mod" aria-label="OP_MOD">OP_MOD</a></li>
                <li>
                    <a href="#op_pow" aria-label="OP_POW">OP_POW</a></li>
                <li>
                    <a href="#op_div" aria-label="OP_DIV">OP_DIV</a></li>
                <li>
                    <a href="#op_idiv" aria-label="OP_IDIV">OP_IDIV</a></li>
                <li>
                    <a href="#op_band" aria-label="OP_BAND">OP_BAND</a></li>
                <li>
                    <a href="#op_bor" aria-label="OP_BOR">OP_BOR</a></li>
                <li>
                    <a href="#op_bxor" aria-label="OP_BXOR">OP_BXOR</a></li>
                <li>
                    <a href="#op_shl" aria-label="OP_SHL">OP_SHL</a></li>
                <li>
                    <a href="#op_shl-1" aria-label="OP_SHL">OP_SHL</a></li>
                <li>
                    <a href="#%e5%89%8d%e9%9d%a2%e7%ae%97%e6%9c%af%e5%92%8c%e4%bd%8d%e8%bf%90%e7%ae%97%e5%a4%b1%e8%b4%a5%e5%b0%9d%e8%af%95%e8%b0%83%e7%94%a8c%e5%b1%82%e5%85%83%e6%96%b9%e6%b3%95" aria-label="å‰é¢ç®—æœ¯å’Œä½è¿ç®—å¤±è´¥å°è¯•è°ƒç”¨Cå±‚å…ƒæ–¹æ³•">å‰é¢ç®—æœ¯å’Œä½è¿ç®—å¤±è´¥å°è¯•è°ƒç”¨Cå±‚å…ƒæ–¹æ³•</a><ul>
                        
                <li>
                    <a href="#op_mmbin" aria-label="OP_MMBIN">OP_MMBIN</a></li>
                <li>
                    <a href="#op_mmbini" aria-label="OP_MMBINI">OP_MMBINI</a></li>
                <li>
                    <a href="#op_mmbink" aria-label="OP_MMBINK">OP_MMBINK</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e4%b8%80%e5%85%83%e8%bf%90%e7%ae%97" aria-label="ä¸€å…ƒè¿ç®—">ä¸€å…ƒè¿ç®—</a><ul>
                        
                <li>
                    <a href="#op_unm" aria-label="OP_UNM">OP_UNM</a></li>
                <li>
                    <a href="#op_bnot" aria-label="OP_BNOT">OP_BNOT</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%80%bb%e8%be%91%e8%bf%90%e7%ae%97" aria-label="é€»è¾‘è¿ç®—">é€»è¾‘è¿ç®—</a><ul>
                        
                <li>
                    <a href="#op_not" aria-label="OP_NOT">OP_NOT</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%91%a8%e8%be%b9%e6%93%8d%e4%bd%9c" aria-label="å‘¨è¾¹æ“ä½œ">å‘¨è¾¹æ“ä½œ</a><ul>
                        
                <li>
                    <a href="#op_len" aria-label="OP_LEN">OP_LEN</a></li>
                <li>
                    <a href="#op_concat" aria-label="OP_CONCAT">OP_CONCAT</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%85%b3%e9%97%ad%e4%b8%8a%e5%80%bc" aria-label="å…³é—­ä¸Šå€¼">å…³é—­ä¸Šå€¼</a><ul>
                        
                <li>
                    <a href="#op_close" aria-label="OP_CLOSE">OP_CLOSE</a></li></ul>
                </li>
                <li>
                    <a href="#tbc%e5%8f%98%e9%87%8f" aria-label="tbcå˜é‡">tbcå˜é‡</a><ul>
                        
                <li>
                    <a href="#op_tbc" aria-label="OP_TBC">OP_TBC</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%88%86%e6%94%af%e4%b8%8e%e8%b7%b3%e8%bd%ac" aria-label="åˆ†æ”¯ä¸è·³è½¬">åˆ†æ”¯ä¸è·³è½¬</a><ul>
                        
                <li>
                    <a href="#op_eq" aria-label="OP_EQ">OP_EQ</a></li>
                <li>
                    <a href="#op_lt" aria-label="OP_LT">OP_LT</a></li>
                <li>
                    <a href="#op_le" aria-label="OP_LE">OP_LE</a></li>
                <li>
                    <a href="#op_eqk" aria-label="OP_EQK">OP_EQK</a></li>
                <li>
                    <a href="#op_eqi" aria-label="OP_EQI">OP_EQI</a></li>
                <li>
                    <a href="#op_lti" aria-label="OP_LTI">OP_LTI</a></li>
                <li>
                    <a href="#op_lei" aria-label="OP_LEI">OP_LEI</a></li>
                <li>
                    <a href="#op_gti" aria-label="OP_GTI">OP_GTI</a></li>
                <li>
                    <a href="#op_gei" aria-label="OP_GEI">OP_GEI</a></li>
                <li>
                    <a href="#op_test" aria-label="OP_TEST">OP_TEST</a></li>
                <li>
                    <a href="#op_testset" aria-label="OP_TESTSET">OP_TESTSET</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%87%bd%e6%95%b0%e8%b0%83%e7%94%a8" aria-label="å‡½æ•°è°ƒç”¨">å‡½æ•°è°ƒç”¨</a><ul>
                        
                <li>
                    <a href="#op_call" aria-label="OP_CALL">OP_CALL</a></li>
                <li>
                    <a href="#op_tailcall" aria-label="OP_TAILCALL">OP_TAILCALL</a></li>
                <li>
                    <a href="#op_return" aria-label="OP_RETURN">OP_RETURN</a></li>
                <li>
                    <a href="#op_return0" aria-label="OP_RETURN0">OP_RETURN0</a></li>
                <li>
                    <a href="#op_return1" aria-label="OP_RETURN1">OP_RETURN1</a></li>
                <li>
                    <a href="#op_vararg" aria-label="OP_VARARG">OP_VARARG</a></li>
                <li>
                    <a href="#op_varargprep" aria-label="OP_VARARGPREP">OP_VARARGPREP</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#iabx%e6%93%8d%e4%bd%9c%e6%95%b0%e6%a8%a1%e5%bc%8f" aria-label="iABxæ“ä½œæ•°æ¨¡å¼">iABxæ“ä½œæ•°æ¨¡å¼</a><ul>
                        
                <li>
                    <a href="#op_loadk" aria-label="OP_LOADK">OP_LOADK</a></li>
                <li>
                    <a href="#op_loadkx" aria-label="OP_LOADKX">OP_LOADKX</a></li>
                <li>
                    <a href="#for%e5%be%aa%e7%8e%af" aria-label="forå¾ªç¯">forå¾ªç¯</a><ul>
                        
                <li>
                    <a href="#op_forloop" aria-label="OP_FORLOOP">OP_FORLOOP</a></li>
                <li>
                    <a href="#op_forprep" aria-label="OP_FORPREP">OP_FORPREP</a></li>
                <li>
                    <a href="#op_tforprep" aria-label="OP_TFORPREP">OP_TFORPREP</a></li>
                <li>
                    <a href="#op_tforcall" aria-label="OP_TFORCALL">OP_TFORCALL</a></li>
                <li>
                    <a href="#op_tforloop" aria-label="OP_TFORLOOP">OP_TFORLOOP</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%87%bd%e6%95%b0%e8%b0%83%e7%94%a8-1" aria-label="å‡½æ•°è°ƒç”¨">å‡½æ•°è°ƒç”¨</a><ul>
                        
                <li>
                    <a href="#op_closure" aria-label="OP_CLOSURE">OP_CLOSURE</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#iasbx%e6%93%8d%e4%bd%9c%e6%95%b0%e6%a8%a1%e5%bc%8f" aria-label="iAsBxæ“ä½œæ•°æ¨¡å¼">iAsBxæ“ä½œæ•°æ¨¡å¼</a><ul>
                        
                <li>
                    <a href="#%e5%8a%a0%e8%bd%bd" aria-label="åŠ è½½">åŠ è½½</a><ul>
                        
                <li>
                    <a href="#op_loadi" aria-label="OP_LOADI">OP_LOADI</a></li>
                <li>
                    <a href="#op_loadf" aria-label="OP_LOADF">OP_LOADF</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#iax%e6%93%8d%e4%bd%9c%e6%95%b0%e6%a8%a1%e5%bc%8f" aria-label="iAxæ“ä½œæ•°æ¨¡å¼">iAxæ“ä½œæ•°æ¨¡å¼</a><ul>
                        
                <li>
                    <a href="#%e9%a2%9d%e5%a4%96%e5%8f%82%e6%95%b0" aria-label="é¢å¤–å‚æ•°">é¢å¤–å‚æ•°</a><ul>
                        
                <li>
                    <a href="#op_extraarg" aria-label="OP_EXTRAARG">OP_EXTRAARG</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#isj%e6%93%8d%e4%bd%9c%e6%95%b0%e6%a8%a1%e5%bc%8f" aria-label="isJæ“ä½œæ•°æ¨¡å¼">isJæ“ä½œæ•°æ¨¡å¼</a><ul>
                        
                <li>
                    <a href="#%e5%88%86%e6%94%af%e4%b8%8e%e8%b7%b3%e8%bd%ac-1" aria-label="åˆ†æ”¯ä¸è·³è½¬">åˆ†æ”¯ä¸è·³è½¬</a><ul>
                        
                <li>
                    <a href="#op_jmp" aria-label="OP_JMP">OP_JMP</a></li></ul>
                </li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e6%8c%87%e4%bb%a4%e5%b1%9e%e6%80%a7%e7%9a%84%e6%8e%a9%e7%a0%81" aria-label="æŒ‡ä»¤å±æ€§çš„æ©ç ">æŒ‡ä»¤å±æ€§çš„æ©ç </a></li>
                <li>
                    <a href="#%e6%8c%87%e4%bb%a4%e7%9a%84%e5%88%9b%e5%bb%ba" aria-label="æŒ‡ä»¤çš„åˆ›å»º">æŒ‡ä»¤çš„åˆ›å»º</a><ul>
                        
                <li>
                    <a href="#%e5%88%9b%e5%bb%baabck%e6%8c%87%e4%bb%a4" aria-label="åˆ›å»ºABCKæŒ‡ä»¤">åˆ›å»ºABCKæŒ‡ä»¤</a></li>
                <li>
                    <a href="#%e5%88%9b%e5%bb%baabx%e6%8c%87%e4%bb%a4" aria-label="åˆ›å»ºABxæŒ‡ä»¤">åˆ›å»ºABxæŒ‡ä»¤</a></li>
                <li>
                    <a href="#%e5%88%9b%e5%bb%baax%e6%8c%87%e4%bb%a4" aria-label="åˆ›å»ºAxæŒ‡ä»¤">åˆ›å»ºAxæŒ‡ä»¤</a></li>
                <li>
                    <a href="#%e5%88%9b%e5%bb%basj%e6%8c%87%e4%bb%a4" aria-label="åˆ›å»ºsJæŒ‡ä»¤">åˆ›å»ºsJæŒ‡ä»¤</a></li></ul>
                </li>
                <li>
                    <a href="#luac%e5%91%bd%e4%bb%a4" aria-label="luacå‘½ä»¤">luacå‘½ä»¤</a><ul>
                        
                <li>
                    <a href="#luac54--l-helloworldlua%e5%91%bd%e4%bb%a4" aria-label="luac54 -l Helloworld.luaå‘½ä»¤">luac54 -l Helloworld.luaå‘½ä»¤</a></li>
                <li>
                    <a href="#luac54--l--l-helloworldlua" aria-label="luac54 -l -l Helloworld.lua">luac54 -l -l Helloworld.lua</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        
        <div class="post-content"><h2 id="æŒ‡ä»¤é›†ç®€ä»‹"><span>æŒ‡ä»¤é›†ç®€ä»‹</span></h2>
<ul>
<li>
<p><code>Lua</code>è™šæ‹Ÿæœºé‡‡ç”¨å®šé•¿æŒ‡ä»¤,æ¯æ¡æŒ‡ä»¤å <code>4</code>ä¸ªå­—èŠ‚</p>
</li>
<li>
<p><code>Lua 5.4</code>å°†æ“ä½œç æ‰©å±•åˆ°äº†ç¬¬<code>7</code>ä½æ€»å…±èƒ½å¤Ÿå®¹çº³<code>128</code>æ¡æŒ‡ä»¤,ç°åœ¨å®šä¹‰äº†<code>83</code>æ¡</p>
<p><img loading="lazy" src="image-20230226165405507.png" alt="image-20230226165405507"  />
</p>
</li>
</ul>
<h2 id="æ“ä½œæ•°ç¼–ç æ¨¡å¼ä¸€å…±5ä¸­"><span>æ“ä½œæ•°ç¼–ç æ¨¡å¼ä¸€å…±5ä¸­</span></h2>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#cdcd00">enum</span> OpMode {iABC, iABx, iAsBx, iAx, isJ};
</span></span></code></pre></div><p><img loading="lazy" src="image-20230223204632470.png" alt="image-20230223204632470"  />
</p>
<table>
<thead>
<tr>
<th>ç¬¦å·</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>i</td>
<td>instruction æŒ‡ä»¤çš„æ„æ€</td>
</tr>
<tr>
<td>A</td>
<td>æŒ‡ä»¤1å‚æ•° ä¸€èˆ¬ç”¨ä½œç›®æ ‡å¯„å­˜å™¨ç´¢å¼•</td>
</tr>
<tr>
<td>B</td>
<td>æŒ‡ä»¤2å‚æ•° æ—¢å¯ä»¥æ˜¯å¯„å­˜å™¨ç´¢å¼•,ä¹Ÿå¯ä»¥æ˜¯å¸¸é‡æ± ç´¢å¼•</td>
</tr>
<tr>
<td>C</td>
<td>æŒ‡ä»¤3å‚æ•° æ—¢å¯ä»¥æ˜¯å¯„å­˜å™¨ç´¢å¼•,ä¹Ÿå¯ä»¥æ˜¯å¸¸é‡æ± ç´¢å¼•</td>
</tr>
<tr>
<td>k</td>
<td>ä¸€bitæ ‡å¿—ä½ æ¯”å¦‚ æ ‡å¿—ä½kä¸º1è¡¨ç¤ºå¸¸é‡æ± ç´¢å¼•,å¦åˆ™è¡¨ç¤ºå¯„å­˜å™¨ç´¢å¼•</td>
</tr>
<tr>
<td>x</td>
<td>extended æ‰©å±•çš„æ„æ€</td>
</tr>
<tr>
<td>s</td>
<td>signed ç¬¦å· è¯¥å‚æ•°åº”è¯¥è¢«è§£é‡Šä¸ºæœ‰ç¬¦å·æ•´æ•°</td>
</tr>
<tr>
<td>sJ</td>
<td>è¡¨ç¤ºè·³è½¬çš„PCåç§»é‡</td>
</tr>
<tr>
<td>sBx</td>
<td>sbxè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæœ‰ç¬¦å·çš„æ•°,ä¹Ÿå°±æ˜¯sbxå¯ä»¥æ˜¯è´Ÿæ•°</td>
</tr>
<tr>
<td>bx</td>
<td>bxæ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°</td>
</tr>
<tr>
<td>Ax</td>
<td>åšå‚æ•°æ‰©å±•ä½¿ç”¨,åªèƒ½å’Œåˆ«çš„æŒ‡ä»¤æ­é…ä½¿ç”¨,æ¯”å¦‚LOADKXæŒ‡ä»¤</td>
</tr>
</tbody>
</table>
<p><strong>åŸºäºCPUå¯„å­˜å™¨æ¶æ„</strong></p>
<p><img loading="lazy" src="image-20230223215246031.png" alt="image-20230223215246031"  />
</p>
<p>ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¿™äº›å¯„å­˜å™¨ç»„ä»¶æ˜¯å’Œ<code>CPU</code>æ†ç»‘åœ¨ä¸€å—çš„,æ‰€ä»¥è·¨å¹³å°å’Œå…¼å®¹æ€§å°±å¾ˆå·®,ä½†æ˜¯å› ä¸ºæ˜¯ç›´æ¥åœ¨<code>CPU</code>ä¸Šç›´æ¥å¯¹æ•°æ®è¿›è¡Œè¿ç®—,æ‰€ä»¥é€Ÿåº¦å¾ˆå¿«</p>
<p><strong>Luaè™šæ‹Ÿæœºæ ˆ</strong></p>
<p><img loading="lazy" src="image-20230226001738964.png" alt="image-20230226001738964"  />
</p>
<p><img loading="lazy" src="image-20230224114012173.png" alt="image-20230224114012173"  />
</p>
<ul>
<li>
<p>ä»ä¸Šå›¾ä¸­æˆ‘ä»¬èƒ½çœ‹å‡º<code>Lua</code>çš„å¯„å­˜å™¨æ˜¯åŸºäºè™šæ‹Ÿæœºçš„,ä½†æ˜¯è¿™äº›å¯„å­˜å™¨å’ŒCPUå¯„å­˜å™¨æ˜¯ä¸ä¸€æ ·çš„ä¸œè¥¿å’Œ<code>CPU</code>æ˜¯æ²¡æœ‰ä»»ä½•å…³è”,å¦‚æœæœ‰å…³è”çš„è¯,å› ä¸º<code>CPU</code>çš„æ¯ä¸ªå¹³å°ä½¿ç”¨çš„æ¶æ„ä¸ä¸€æ ·,ä¼šå¯¼è‡´<code>Lua</code>å¤±å»ç§»æ¤å’Œå…¼å®¹æ€§,æ‰€ä»¥<code>Lua</code>ä½¿ç”¨äº†ä¸€ä¸ªæ ˆæ¥ä¿å­˜è¿™äº›å¯„å­˜å™¨,åŒæ—¶æ¯ä¸€ä¸ªè¿è¡Œçš„å‡½æ•°éƒ½æœ‰è‡ªå·±çš„æ´»åŠ¨æ•°æ®,å•ç‹¬çš„å¯„å­˜å™¨æ•°é‡,åŒæ—¶åœ¨<code>Lua5.4.4</code>ä¸­ä¹Ÿè§„å®šäº†æ¯ä¸ªå‡½æ•°æœ€å¤§çš„å¯„å­˜å™¨ä¸ªæ•°æ˜¯<code>255</code>ä¸ª</p>
</li>
<li>
<p>ä¹Ÿå¯ä»¥çœ‹å‡ºæˆ‘ä»¬çš„æŒ‡ä»¤å…¶å®éƒ½æ˜¯å­˜åœ¨äº†<code>Proto</code>ç»“æ„ä½“é‡Œé¢çš„<code>code</code>å­—æ®µ</p>
</li>
<li>
<p>ç”±äº<code>Lua</code>æœ‰å¦‚æ­¤å¤§é‡çš„å¯„å­˜å™¨,æ‰€ä»¥åœ¨é¢„ç¼–è¯‘æ—¶èƒ½å¤Ÿå°†æ‰€æœ‰çš„<code>å±€éƒ¨å˜é‡</code>å­˜æ”¾åˆ°å¯„å­˜å™¨ä¸­,å› ä¸ºå¯„å­˜å™¨æ•°æ®æ˜¯åœ¨æ ˆä¸­,<code>upvalue</code>å˜é‡å­˜æ”¾åœ¨é“¾è¡¨ä¸­,<code>global</code>å˜é‡å­˜æ”¾åœ¨å…¨å±€çš„è¡¨ä¸­ä¹Ÿå¯ä»¥è¯´æ˜¯åœ¨<code>env</code>è¡¨ä¸­</p>
<p>æ•ˆç‡ä»å¤§åˆ°å°:<code>local &gt; upvalue &gt; global</code></p>
</li>
<li>
<p>æ‰€ä»¥ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨å¦‚ä¸‹é¢çš„å®šä¹‰æ–¹å¼æ¥æé«˜æ•ˆç‡,æ¯•ç«Ÿè¿™æ ·åšçœå»è°ƒç”¨æ—¶å†å»å…¨å±€è¡¨ä¸­,ä¸Šå€¼é“¾è¡¨ä¸­æŸ¥æ‰¾çš„å¼€é”€,åŒæ—¶ç”Ÿæˆçš„æŒ‡ä»¤ä¹Ÿä¼šå‡å°‘å¾ˆå¤š</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> sin <span style="color:#39c">=</span> math.sin  
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> table_remove_f <span style="color:#39c">=</span> table_t.remove
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> table_insert_f <span style="color:#39c">=</span> table_t.insert
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> table_unpack_f <span style="color:#39c">=</span> table_t.unpack
</span></span></code></pre></div></li>
</ul>
<h3 id="çœ‹æŒ‡ä»¤å‰çš„ä¸€äº›ç¬¦å·è§£é‡Š"><span>çœ‹æŒ‡ä»¤å‰çš„ä¸€äº›ç¬¦å·è§£é‡Š</span></h3>
<table>
<thead>
<tr>
<th>ç¬¦å·</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td>R(x)</td>
<td>ä¸€å®šæ˜¯å¯„å­˜å™¨ç´¢å¼• ä¸€å®šä¼šè®¿é—®<code>Lua</code>æ ˆ</td>
</tr>
<tr>
<td>Kst(x)</td>
<td>ä¸€å®šæ˜¯å¸¸é‡ç´¢å¼• ä¸€å®šä¼šè®¿é—®å¸¸é‡è¡¨</td>
</tr>
<tr>
<td>RK(x)</td>
<td>å¯èƒ½æ˜¯å¸¸é‡ç´¢å¼•ä¹Ÿæœ‰å¯èƒ½æ˜¯å¯„å­˜å™¨ç´¢å¼•,å–å†³äºç´¢å¼•<code>k</code>çš„ç±»å‹</td>
</tr>
<tr>
<td>ç«‹å³æ•°</td>
<td>ç«‹å³æ•°å°±æ˜¯å†™åœ¨æŒ‡ä»¤é‡Œçš„å¸¸æ•°.ç”¨<code>CPUæ¶æ„</code>ä¸‹çš„<code>mov</code>æŒ‡ä»¤ä¸¾ä¾‹å­,<code>mov 12, %rax</code><br />é‚£ä¹ˆè¿™ä¸ª <code>12</code> å°±åœ¨æ“ä½œè¯­å¥é‡Œ.é‚£ä¹ˆ <code>12</code> ç›¸å½“äºæŒ‡ä»¤é‡Œçš„ç«‹å³æ•°,<br /><code>lua</code>ä¸­çš„æŒ‡ä»¤ä¹Ÿç±»ä¼¼,ç›´æ¥ä»æŒ‡ä»¤å‚æ•°ä¸­åŠ è½½çš„æ•´æ•°å’Œæµ®ç‚¹æ•°å°±æ˜¯ç«‹å³æ•°</td>
</tr>
<tr>
<td>PC</td>
<td>ç¨‹åºæŒ‡ä»¤è®¡æ•°å™¨,ä¸»è¦æ˜¯ä¸ºäº†è®¡ç®—æŒ‡ä»¤çš„ç›¸å¯¹ä½ç½®ç”¨çš„</td>
</tr>
<tr>
<td>Upvalue[n]</td>
<td>ä¸‹æ ‡ç´¢å¼•ä¸ºnçš„ä¸Šå€¼</td>
</tr>
</tbody>
</table>
<h3 id="iabcæ“ä½œæ•°æ¨¡å¼"><span>iABCæ“ä½œæ•°æ¨¡å¼</span></h3>
<p><img loading="lazy" src="image-20230225184020461.png" alt="image-20230225184020461"  />
</p>
<p>é¦–å…ˆè¿™ä¸ªæŒ‡ä»¤å’Œ<code>lua5.4</code>ç‰ˆæœ¬ä¹‹å‰çš„<code>lua</code>è¡¨è¾¾æ–¹å¼ä¸ä¸€æ ·<code>,lua5.4</code>ä½¿ç”¨<code>k</code>ä½æ¥è¡¨ç¤º<code>B,C</code>ä¸¤ä½åˆ°åº•æ˜¯å¯„å­˜å™¨ç´¢å¼•[å…¶å®å°±æ˜¯æ ˆç´¢å¼•],è¿˜æ˜¯å¸¸é‡æ± ç´¢å¼•</p>
<ul>
<li><code>k</code>:<code>1</code>è¡¨ç¤ºå¸¸é‡æ± ç´¢å¼• <code>0</code>è¡¨ç¤ºå¯„å­˜å™¨ç´¢å¼•</li>
<li><code>B,C</code>:ä¸Šé¢çš„<code>k</code>å€¼å†³å®šæ˜¯å¯„å­˜å™¨ç´¢å¼•[å…¶å®å°±æ˜¯æ ˆç´¢å¼•],è¿˜æ˜¯å¸¸é‡æ± ç´¢å¼•</li>
<li><code>A</code>:ç›®æ ‡ç´¢å¼•</li>
</ul>
<p>å ç”¨<code>bit</code>ä½èŒƒå›´</p>
<table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>èŒƒå›´(å•ä½bit)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Op(7)</td>
<td>0~6</td>
</tr>
<tr>
<td>A(8)</td>
<td>7~14</td>
</tr>
<tr>
<td>k(1)</td>
<td>15</td>
</tr>
<tr>
<td>B(8)</td>
<td>16~23</td>
</tr>
<tr>
<td>C(8)</td>
<td>24~31</td>
</tr>
</tbody>
</table>
<h4 id="èµ‹å€¼åŠ è½½æŒ‡ä»¤"><span>èµ‹å€¼åŠ è½½æŒ‡ä»¤</span></h4>
<h5 id="op_move"><span>OP_MOVE</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A B  R[A] := R[B]</code> <code>å°†Bå¯„å­˜å™¨çš„å€¼èµ‹å€¼ç»™Aå¯„å­˜å™¨</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> B <span style="color:#39c">=</span> <span style="color:#cd00cd">10</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> A <span style="color:#39c">=</span> B
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">4</span> instructions at <span style="color:#cd00cd">00</span>CA2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>    <span style="">æŸ¥çœ‹å¯å˜å‚æ•°æ–¹å¼ä¸‹å›ºå®šå‚æ•°ä¸ªæ•°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">10</span> <span style="">å°†æ•´å‹ç«‹å³æ•°</span><span style="color:#cd00cd">10</span><span style="">åŠ è½½åˆ°å¯„å­˜å™¨çš„</span><span style="color:#cd00cd">0</span><span style="">å·ä½ç½®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     MOVE            <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">0</span>  <span style="">å°†</span>(<span style="">å¯„å­˜å™¨çš„</span><span style="color:#cd00cd">0</span><span style="">å·ä½ç½®</span>)<span style="">ä¸Šé¢çš„å±€éƒ¨å˜é‡</span>B<span style="">çš„å€¼ä»˜ç»™</span>(<span style="">å¯„å­˜å™¨çš„</span><span style="color:#cd00cd">1</span><span style="">å·ä½ç½®</span>)<span style="">ä¸Šé¢å±€éƒ¨å˜é‡</span>A
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out <span style="">è¿”å›</span><span style="color:#cd00cd">0</span><span style="">ä¸ªå€¼</span>
</span></span></code></pre></div><p>ä¸Šé¢æ­¥éª¤å¤§æ¦‚æ„æ€æ˜¯</p>
<p>åœ¨ç¼–è¯‘è¿‡ç¨‹,<code>Lua</code>ä¼šå°†æ¯ä¸ª<code>local</code>å˜é‡éƒ½åˆ†é…åˆ°ä¸€ä¸ªæŒ‡å®šçš„å¯„å­˜å™¨ä¸­,æ¯”å¦‚å±€éƒ¨å˜é‡<code>B</code>åˆ†é…åˆ°å¯„å­˜å™¨<code>0</code>å·ä½ç½®,å±€éƒ¨å˜é‡<code>A</code>åˆ†é…åˆ°å¯„å­˜å™¨<code>1</code>å·ä½ç½®</p>
<ol>
<li>ç„¶åæ‰§è¡Œ<code>VARARGPREP</code>æŒ‡ä»¤æŸ¥çœ‹ä¸‹å¯å˜å‚æ•°æ–¹å¼ä¸‹çš„å›ºå®šå‚æ•°æ•°é‡</li>
<li>è°ƒç”¨<code>LOADI</code>æ‰§è¡Œå°†æ•´å‹ç«‹å³æ•°<code>10</code>åŠ è½½åˆ°å¯„å­˜å™¨<code>0</code>å·ä½ç½®</li>
<li>è°ƒç”¨<code>MOVE</code>å°†<code>å¯„å­˜å™¨çš„0å·ä½ç½®</code>ä¸Šé¢çš„å±€éƒ¨å˜é‡Bçš„å€¼ä»˜ç»™<code>å¯„å­˜å™¨çš„1å·ä½ç½®</code>ä¸Šé¢å±€éƒ¨å˜é‡<code>A</code></li>
<li><code>0 out</code> çš„æ„æ€æ˜¯è¿”å›<code>0</code>ä¸ªå€¼</li>
</ol>
</li>
</ul>
<h5 id="op_loadfalse"><span>OP_LOADFALSE</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A	R[A] := false</code> <code>åŠ è½½falseåˆ°å¯„å­˜å™¨</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cdcd00">false</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">3</span> instructions at <span style="color:#cd00cd">00</span>F32290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span> <span style="">æŸ¥çœ‹å¯å˜å‚æ•°æ–¹å¼ä¸‹å›ºå®šå‚æ•°ä¸ªæ•°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADFALSE       <span style="color:#cd00cd">0</span> <span style="">å°†</span>false<span style="">åŠ è½½åˆ°å¯„å­˜å™¨çš„</span><span style="color:#cd00cd">0</span><span style="">å·ä½ç½®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_lfalseskip"><span>OP_LFALSESKIP</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A	R[A] := false; pc++	(*)</code> <code>åŠ è½½falseåˆ°å¯„å­˜å™¨,åŒæ—¶è·³è¿‡ä¸‹ä¸€æ¡æŒ‡ä»¤</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">5</span> <span style="color:#39c">&gt;</span> <span style="color:#cd00cd">2</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span> <span style="">æŸ¥çœ‹å¯å˜å‚æ•°æ–¹å¼ä¸‹å›ºå®šå‚æ•°ä¸ªæ•°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">2</span> <span style="">å°†ç«‹å³æ•´æ•°</span><span style="color:#cd00cd">2</span><span style="">åŠ è½½åˆ°å¯„å­˜å™¨</span><span style="color:#cd00cd">0</span><span style="">å·ä½ç½®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LTI             <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">5</span> <span style="color:#cd00cd">1</span> <span style="">æ¯”è¾ƒå¤§å°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     JMP             <span style="color:#cd00cd">1</span>       ; to <span style="color:#cd00cd">6</span> <span style="">è¿›è¡Œè·³è½¬</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">1</span>]     LFALSESKIP      <span style="color:#cd00cd">0</span>	<span style="">åŠ è½½</span>false<span style="">åˆ°å¯„å­˜å™¨</span>,<span style="">åŒæ—¶è·³è¿‡ä¸‹ä¸€æ¡æŒ‡ä»¤</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">1</span>]     LOADTRUE        <span style="color:#cd00cd">0</span> 	<span style="">åŠ è½½</span>true<span style="">åˆ°å¯„å­˜å™¨</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_loadtrue"><span>OP_LOADTRUE</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A	R[A] := true</code> <code>åŠ è½½trueåˆ°å¯„å­˜å™¨</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cdcd00">true</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">3</span> instructions at <span style="color:#cd00cd">014</span>C2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>  <span style="">æŸ¥çœ‹å¯å˜å‚æ•°æ–¹å¼ä¸‹å›ºå®šå‚æ•°ä¸ªæ•°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADTRUE        <span style="color:#cd00cd">0</span>  <span style="">å°†</span>true<span style="">åŠ è½½åˆ°å¯„å­˜å™¨çš„</span><span style="color:#cd00cd">0</span><span style="">å·ä½ç½®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_loadnil"><span>OP_LOADNIL</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A B	R[A], R[A+1], ..., R[A+B] := nil</code> <code>å°†åºå·[A,A+B]è¿ç»­B+1ä¸ªå¯„å­˜å™¨è®¾ç½®æˆnilå€¼,ç”¨äºåŠ è½½nilåˆ°ä¸€æ‰¹å¯„å­˜å™¨</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cdcd00">nil</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> a1 <span style="color:#39c">=</span> <span style="color:#cdcd00">nil</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> a2 <span style="color:#39c">=</span> <span style="color:#cdcd00">nil</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> a3 <span style="color:#39c">=</span> <span style="color:#cdcd00">nil</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> a4 <span style="color:#39c">=</span> <span style="color:#cdcd00">nil</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">3</span> instructions at <span style="color:#cd00cd">015422</span>A0)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">5</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">5</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADNIL         <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">4</span>     ; <span style="color:#cd00cd">5</span> out <span style="">å°†åºå·</span>[A:<span style="color:#cd00cd">0</span>,A:<span style="color:#cd00cd">0</span><span style="color:#39c">+</span>B:<span style="color:#cd00cd">4</span>]<span style="">è¿ç»­</span>B:<span style="color:#cd00cd">4</span><span style="color:#39c">+</span><span style="color:#cd00cd">1</span><span style="">ä¸ªå¯„å­˜å™¨è®¾ç½®æˆ</span>nil<span style="">å€¼</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">5</span>]     RETURN          <span style="color:#cd00cd">5</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_getupval"><span>OP_GETUPVAL</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A B	R[A] := UpValue[B]</code> <code>è¯»å–ä¸€ä¸ªä¸Šå€¼åˆ°å¯„å­˜å™¨</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">function</span> test() 
</span></span><span style="display:flex;"><span>	a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>	<span style="color:#cdcd00">return</span> a 
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">end</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">5</span> instructions at <span style="color:#cd00cd">01542290</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">1</span> <span style="color:#cdcd00">function</span>
</span></span><span style="display:flex;"><span>        <span style="">1</span>       <span style="">[1]</span>     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADNIL         <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; <span style="color:#cd00cd">1</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">5</span>]     CLOSURE         <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">0</span>     ; <span style="color:#cd00cd">01543</span>CB8
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     SETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>   ; _ENV <span style="color:#cd0000">&#34;test&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">5</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>k  ; <span style="color:#cd00cd">0</span> out
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">function</span> <span style="">&lt;</span>.<span style="">\</span><span style="color:#00cdcd">helloworld</span>.<span style="color:#00cdcd">lua</span>:<span style="">2,5&gt;</span> (<span style="color:#cd00cd">5</span> instructions at <span style="color:#cd00cd">01543</span>CB8)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">0</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">3</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">3</span>]     SETUPVAL        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; a
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">4</span>]     GETUPVAL        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; a <span style="">æŠŠå½“å‰é—­åŒ…çš„</span>B:<span style="color:#cd00cd">0</span><span style="">ä½ç½®çš„å€¼æ‹·è´åˆ°ç›®æ ‡å¯„å­˜å™¨</span>A:<span style="color:#cd00cd">0</span><span style="">ä¸­</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">4</span>]     RETURN1         <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">5</span>]     RETURN0
</span></span></code></pre></div></li>
</ul>
<h5 id="op_setupval"><span>OP_SETUPVAL</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A B	UpValue[B] := R[A]</code> <code>å†™ä¸€ä¸ªå¯„å­˜å™¨å€¼åˆ°ä¸Šå€¼</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">function</span> test() 
</span></span><span style="display:flex;"><span>	a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>	<span style="color:#cdcd00">return</span> a 
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">end</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">5</span> instructions at <span style="color:#cd00cd">01542290</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">1</span> <span style="color:#cdcd00">function</span>
</span></span><span style="display:flex;"><span>        <span style="">1</span>       <span style="">[1]</span>     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADNIL         <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; <span style="color:#cd00cd">1</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">5</span>]     CLOSURE         <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">0</span>     ; <span style="color:#cd00cd">01543</span>CB8
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     SETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>   ; _ENV <span style="color:#cd0000">&#34;test&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">5</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>k  ; <span style="color:#cd00cd">0</span> out
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">function</span> <span style="">&lt;</span>.<span style="">\</span><span style="color:#00cdcd">helloworld</span>.<span style="color:#00cdcd">lua</span>:<span style="">2,5&gt;</span> (<span style="color:#cd00cd">5</span> instructions at <span style="color:#cd00cd">01543</span>CB8)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">0</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">3</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">3</span>]     SETUPVAL        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; a <span style="">æŠŠå½“å‰å¯„å­˜å™¨</span>A:<span style="color:#cd00cd">0</span><span style="">ä½ç½®çš„å€¼è®¾ç½®åˆ°</span>B:<span style="color:#cd00cd">0</span><span style="">ä½ç½®å¹¶åšä¸ºé—­åŒ…çš„ä¸Šå€¼</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">4</span>]     GETUPVAL        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; a 
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">4</span>]     RETURN1         <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">5</span>]     RETURN0
</span></span></code></pre></div></li>
</ul>
<h4 id="è¡¨æ“ä½œ"><span>è¡¨æ“ä½œ</span></h4>
<h5 id="op_gettabup"><span>OP_GETTABUP</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := UpValue[B][K[C]:string]</code> <code>ä»è¡¨å–å€¼åˆ°å¯„å­˜å™¨,è¡¨åœ¨upvalue</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>global_var <span style="color:#39c">=</span> <span style="color:#cd00cd">40</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> local_var <span style="color:#39c">=</span> global_var
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">4</span> instructions at <span style="color:#cd00cd">012</span>C2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">2</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     SETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>k  ; _ENV <span style="color:#cd0000">&#34;global_var&#34;</span> <span style="color:#cd00cd">40</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;global_var&#34;</span> <span style="">å°†</span>upvalues<span style="">è¡¨ç´¢å¼•ä¸º</span>B:<span style="color:#cd00cd">0</span><span style="">çš„</span>upvalue(<span style="">å³ï¼š</span>_ENV)<span style="">ä¸­</span>key<span style="">ä¸ºå¸¸é‡è¡¨ç´¢å¼•ä¸º</span>C:<span style="color:#cd00cd">0</span><span style="">çš„</span>(<span style="">å³</span>global_var),<span style="">æ”¾åˆ°å¯„å­˜å™¨ç´¢å¼•ä¸º</span>A:<span style="color:#cd00cd">0</span><span style="">çš„åœ°æ–¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div><p><code>OP_GETTABUP</code>å’Œä¸<code>OP_GETTABLE</code>æŒ‡ä»¤ç›¸ä¼¼,åªæ˜¯è¡¨è¢«å¼•ç”¨ä¸ºä¸Šå€¼.è¿™äº›æŒ‡ä»¤ç”¨äºè®¿é—®å…¨å±€å˜é‡,æ˜¯é€šè¿‡åä¸º<code>_ENV</code>çš„ä¸Šå€¼è®¿é—®çš„</p>
</li>
</ul>
<h5 id="op_gettable"><span>OP_GETTABLE</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B][R[C]]</code> <code>å°†å¯„å­˜å™¨Bä½ç½®çš„è¡¨t,ä¸‹æ ‡ä¸ºkeyä¸ºCé‡Œé¢çš„å†…å®¹æ‹·è´åˆ°å¯„å­˜å™¨Aä¸Š</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> k <span style="color:#39c">=</span> <span style="color:#cd0000">&#34;a&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> ra <span style="color:#39c">=</span> t[k]
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">5</span> instructions at <span style="color:#cd00cd">01202290</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">2</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADK           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; <span style="color:#cd0000">&#34;a&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     GETTABUP        <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>   ; _ENV <span style="color:#cd0000">&#34;t&#34;</span> <span style="">å°†</span>upvalues<span style="">è¡¨ç´¢å¼•ä¸º</span>B:<span style="color:#cd00cd">0</span><span style="">çš„</span>upvalue(<span style="">å³ï¼š</span>_ENV)<span style="">ä¸­</span>key<span style="">ä¸ºå¸¸é‡è¡¨ç´¢å¼•ä¸º</span>C:<span style="color:#cd00cd">1</span><span style="">çš„</span>(<span style="">å³</span>t),<span style="">æ”¾åˆ°å¯„å­˜å™¨ç´¢å¼•ä¸º</span>A:<span style="color:#cd00cd">1</span><span style="">çš„åœ°æ–¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     GETTABLE        <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">0</span>    <span style="">å°†å¯„å­˜å™¨</span>B:<span style="color:#cd00cd">1</span><span style="">ä½ç½®çš„è¡¨</span>t,<span style="">ä¸‹æ ‡ä¸º</span>key<span style="">ä¸º</span>C:<span style="color:#cd00cd">0</span><span style="">é‡Œé¢çš„å†…å®¹æ‹·è´åˆ°å¯„å­˜å™¨</span>A:<span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_geti"><span>OP_GETI</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B][C]	</code> <code>ä»è¡¨å–keyä¸ºæ•´å‹çš„å†…å®¹ç»™å¯„å­˜å™¨</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> t[<span style="color:#cd00cd">2</span>]
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">4</span> instructions at <span style="color:#cd00cd">01492290</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;t&#34;</span> <span style="">å°†</span>upvalues<span style="">è¡¨ç´¢å¼•ä¸º</span>B:<span style="color:#cd00cd">0</span><span style="">çš„</span>upvalue(<span style="">å³ï¼š</span>_ENV)<span style="">ä¸­</span>key<span style="">ä¸ºå¸¸é‡è¡¨ç´¢å¼•ä¸º</span>C:<span style="color:#cd00cd">0</span><span style="">çš„</span>(<span style="">å³</span>t),<span style="">æ”¾åˆ°å¯„å­˜å™¨ç´¢å¼•ä¸º</span>A:<span style="color:#cd00cd">0</span><span style="">çš„åœ°æ–¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     GETI            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">2</span> <span style="">å°†å¯„å­˜å™¨</span>B:<span style="color:#cd00cd">0</span><span style="">ä½ç½®çš„è¡¨</span>t,<span style="">ä¸‹æ ‡ä¸º</span>key<span style="">ä¸ºç«‹å³æ•´æ•°</span><span style="color:#cd00cd">2</span><span style="">é‡Œé¢çš„å†…å®¹æ‹·è´åˆ°å¯„å­˜å™¨</span>A:<span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_getfield"><span>OP_GETFIELD</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B][K[C]:string]</code> <code>ä»è¡¨å–keyä¸ºå­—ç¬¦ä¸²çš„å†…å®¹ç»™å¯„å­˜å™¨</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> ra <span style="color:#39c">=</span> t[<span style="color:#cd0000">&#34;11&#34;</span>]
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">4</span> instructions at <span style="color:#cd00cd">00</span>AC2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">2</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;t&#34;</span>  <span style="">å°†</span>upvalues<span style="">è¡¨ç´¢å¼•ä¸º</span>B:<span style="color:#cd00cd">0</span><span style="">çš„</span>upvalue(<span style="">å³ï¼š</span>_ENV)<span style="">ä¸­</span>key<span style="">ä¸ºå¸¸é‡è¡¨ç´¢å¼•ä¸º</span>C:<span style="color:#cd00cd">0</span><span style="">çš„</span>(<span style="">å³</span>t),<span style="">æ”¾åˆ°å¯„å­˜å™¨ç´¢å¼•ä¸º</span>A:<span style="color:#cd00cd">0</span><span style="">çš„åœ°æ–¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     GETFIELD        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd0000">&#34;11&#34;</span> <span style="">å°†å¯„å­˜å™¨</span>B:<span style="color:#cd00cd">0</span><span style="">ä½ç½®çš„è¡¨</span>t,<span style="">ä¸‹æ ‡ä¸º</span>key<span style="">ä¸º</span>C:<span style="color:#cd00cd">1</span><span style="">çš„å†…å®¹æ‹·è´åˆ°å¯„å­˜å™¨</span>A:<span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_settabup"><span>OP_SETTABUP</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A B C	UpValue[A][K[B]:string] := RK(C)</code> <code>è®¾ç½®å¯„å­˜å™¨å€¼ç»™è¡¨å…ƒç´ ,è¡¨åœ¨upvalue</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>global_var <span style="color:#39c">=</span> <span style="color:#cd00cd">40</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> local_var <span style="color:#39c">=</span> global_var
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">4</span> instructions at <span style="color:#cd00cd">012</span>C2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">2</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     SETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>k  ; _ENV <span style="color:#cd0000">&#34;global_var&#34;</span> <span style="color:#cd00cd">40</span> <span style="">å°†å¸¸é‡è¡¨ä¸­</span>Key<span style="">ä¸º</span>C:<span style="color:#cd00cd">1</span><span style="">ä¸Šçš„å€¼</span><span style="color:#cd00cd">40</span>  <span style="">èµ‹å€¼ç»™å¯„å­˜å™¨</span>A:<span style="color:#cd00cd">0</span><span style="">ä¸Šçš„ä¸Šå€¼è¡¨</span>key<span style="">ä¸º</span>B:<span style="color:#cd00cd">0</span><span style="">çš„ä¸Šå€¼</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;global_var&#34;</span> <span style="">å°†</span>upvalues<span style="">è¡¨ç´¢å¼•ä¸º</span>B:<span style="color:#cd00cd">0</span><span style="">çš„</span>upvalue(<span style="">å³ï¼š</span>_ENV)<span style="">ä¸­</span>key<span style="">ä¸ºå¸¸é‡è¡¨ç´¢å¼•ä¸º</span>C:<span style="color:#cd00cd">0</span><span style="">çš„</span>(<span style="">å³</span>global_var),<span style="">æ”¾åˆ°å¯„å­˜å™¨ç´¢å¼•ä¸º</span>A:<span style="color:#cd00cd">0</span><span style="">çš„åœ°æ–¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_newtable"><span>OP_NEWTABLE</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A B C k	R[A] := {}</code> <code>æ–°å»ºä¸€ä¸ªè¡¨</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> t <span style="color:#39c">=</span> {}
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">4</span> instructions at <span style="color:#cd00cd">00</span>A522A8)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     NEWTABLE        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; <span style="color:#cd00cd">0</span> <span style="">åˆ›å»ºä¸€ä¸ªç©ºè¡¨</span>,<span style="">å¹¶å°†ç©ºè¡¨æ”¾åˆ°å¯„å­˜å™¨</span>A:<span style="color:#cd00cd">0</span><span style="">ä½ç½®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     EXTRAARG        <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_self"><span>OP_SELF</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A B C	R[A+1] := R[B]; R[A] := R[B][RK(C):string]</code> <code>å‡†å¤‡ä¸€ä¸ªå¯¹è±¡æ–¹æ³•çš„è°ƒç”¨</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>foo:getLua(<span style="color:#cd0000">&#34;lua&#34;</span>)
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">012E2290</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">0</span> locals, <span style="color:#cd00cd">3</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;foo&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     SELF            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>k  ; <span style="color:#cd0000">&#34;getLua&#34;</span> <span style="">æŠŠå¯„å­˜å™¨ä¸­å¯¹è±¡</span>B:<span style="color:#cd00cd">0</span>(<span style="">å³</span>foo)<span style="">å’Œå¸¸é‡è¡¨ä¸­æ–¹æ³•</span>C:<span style="color:#cd00cd">1</span>(<span style="">å³</span>getLua)<span style="">æ‹·è´åˆ°ç›¸é‚»çš„ä¸¤ä¸ªç›®æ ‡å¯„å­˜å™¨ä¸­</span>,<span style="">ç›¸é‚»ç›®æ ‡çš„å…¶å®ä½ç½®ç”±</span>A:<span style="color:#cd00cd">0</span><span style="">å†³å®š</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     LOADK           <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">2</span>     ; <span style="color:#cd0000">&#34;lua&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">1</span>]     CALL            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">2</span> <span style="color:#cdcd00">in</span> <span style="color:#cd00cd">0</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div><ul>
<li>
<p>ä¸Šé¢æ–¹æ³•<code>foo:getLua(&quot;lua&quot;)</code>è°ƒç”¨ç›¸å½“äº<code>foo.getLua(foo,&quot;lua&quot;)</code>,è®©å…¨å±€<code>foo</code>åªè¢«æŸ¥æ‰¾ä¸€æ¬¡,ä¸‹é¢åœ¨ä»‹ç»ä¸‹æ²¡æœ‰<code>self</code>æŒ‡ä»¤æƒ…å†µä¸‹çš„æƒ…å†µ</p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>foo.getLua(foo,<span style="color:#cd0000">&#34;lua&#34;</span>)
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">7</span> instructions at <span style="color:#cd00cd">008</span>F2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">0</span> locals, <span style="color:#cd00cd">3</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;foo&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     GETFIELD        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd0000">&#34;getLua&#34;</span> <span style="">å°†</span>upvalues<span style="">è¡¨ç´¢å¼•ä¸º</span>B:<span style="color:#cd00cd">0</span><span style="">çš„</span>upvalue(<span style="">å³ï¼š</span>_ENV)<span style="">ä¸­</span>key<span style="">ä¸ºå¸¸é‡è¡¨ç´¢å¼•ä¸º</span>C:<span style="color:#cd00cd">1</span><span style="">çš„</span>(<span style="">å³</span>getLua),<span style="">æ”¾åˆ°å¯„å­˜å™¨ç´¢å¼•ä¸º</span>A:<span style="color:#cd00cd">0</span><span style="">çš„åœ°æ–¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     GETTABUP        <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;foo&#34;</span> <span style="">å°†</span>upvalues<span style="">è¡¨ç´¢å¼•ä¸º</span>B:<span style="color:#cd00cd">0</span><span style="">çš„</span>upvalue(<span style="">å³ï¼š</span>_ENV)<span style="">ä¸­</span>key<span style="">ä¸ºå¸¸é‡è¡¨ç´¢å¼•ä¸º</span>C:<span style="color:#cd00cd">0</span><span style="">çš„</span>(<span style="">å³</span><span style="color:#cd0000">&#34;foo&#34;</span>),<span style="">æ”¾åˆ°å¯„å­˜å™¨ç´¢å¼•ä¸º</span>A:<span style="color:#cd00cd">1</span><span style="">çš„åœ°æ–¹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">1</span>]     LOADK           <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">2</span>     ; <span style="color:#cd0000">&#34;lua&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">1</span>]     CALL            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">2</span> <span style="color:#cdcd00">in</span> <span style="color:#cd00cd">0</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div><p>ä»å¯¹ä¸¤ä¸ªå‡½æ•°è¿›è¡ŒæŒ‡ä»¤é›†å¯¹æ¯”ä»¥åæˆ‘ä»¬å¯ä»¥çœ‹å‡º<code>foo:getLua(&quot;lua&quot;)</code>å‡½æ•°çš„ç¬¬3è¡Œçš„</p>
<p><code>   3       [1]     SELF            0 0 1k  ; &quot;getLua&quot;</code></p>
<p>å’Œ</p>
<p><code>foo.getLua(foo,&quot;lua&quot;)</code>å‡½æ•°ç¬¬<code>3,4</code>è¡Œ</p>
<p><code> 3       [1]     GETFIELD        0 0 1   ; &quot;getLua&quot;</code></p>
<p><code> 4       [1]     GETTABUP        1 0 0   ; _ENV &quot;foo&quot;</code></p>
<p>ç­‰ä»·</p>
</li>
<li>
<p>æ‰€ä»¥ç»¼åˆæ¥è¯´<code>SELF</code>æŒ‡ä»¤èŠ‚çœäº†é¢å¤–çš„æŒ‡ä»¤,å¹¶åŠ å¿«äº†é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­æ–¹æ³•çš„è°ƒç”¨.ä½†æ˜¯å®ƒåªä¸ºä½¿ç”¨å†’å·è¯­æ³•çš„æ–¹æ³•è°ƒç”¨ç”ŸæˆæœåŠ¡</p>
</li>
</ul>
</li>
</ul>
<h5 id="op_setlist"><span>OP_SETLIST</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A B C k R[A][C+i] := R[A+i], 1 &lt;= i &lt;= B</code> <code>ç»™è¡¨è®¾ç½®ä¸€æ‰¹æ•°ç»„å…ƒç´ </code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> q <span style="color:#39c">=</span> {<span style="color:#cd00cd">1</span>,<span style="color:#cd00cd">2</span>,<span style="color:#cd00cd">3</span>,<span style="color:#cd00cd">4</span>,<span style="color:#cd00cd">5</span>}
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">10</span> instructions at <span style="color:#cd00cd">01572290</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">6</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     NEWTABLE        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">5</span>   ; <span style="color:#cd00cd">5</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     EXTRAARG        <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">3</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">4</span> <span style="color:#cd00cd">4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">8</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">5</span> <span style="color:#cd00cd">5</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">9</span>       [<span style="color:#cd00cd">1</span>]     SETLIST         <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">5</span> <span style="color:#cd00cd">0</span> <span style="">è¿™é‡Œçš„</span><span style="color:#cd00cd">5</span><span style="">å°±æ˜¯æ•°ç»„æ•°é‡</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">10</span>      [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div><p>å¦‚æœéœ€è¦å†™å…¥æ•°ç»„çš„ä¸€ç³»åˆ—å€¼å¹¶ä¸”æ˜¯ç´§æŒ¨ç€æ•°ç»„åˆ™æ•°é‡ç”±æ“ä½œæ•°<code>B</code>æŒ‡å®š,æ•°ç»„èµ·å§‹ç´¢å¼•åˆ™ç”±æ“ä½œ<code>C</code>æŒ‡å®š</p>
<p>å…¶å®è¿™ä¹ˆåšä¹Ÿæ˜¯ä¸ºäº†çœæŒ‡ä»¤æ¡æ•°,åªéœ€è¦ä¸€æ¡æŒ‡ä»¤<code>OP_SETLIST</code>å°±å¤Ÿäº†</p>
</li>
</ul>
<h4 id="ç®—æœ¯å’Œä½è¿ç®—"><span>ç®—æœ¯å’Œä½è¿ç®—</span></h4>
<h5 id="op_addi"><span>OP_ADDI</span></h5>
<p><code>å…¬å¼</code>:<code>A B sC	R[A] := R[B] + sC</code> <code>ç«‹å³æ•°åŠ </code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a,b <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>,<span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span> a <span style="color:#39c">=</span> a <span style="color:#39c">+</span> <span style="color:#cd00cd">5</span>
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00812290</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     ADDI            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">5</span> <span style="">ç«‹å³æ•°ç›¸åŠ </span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">2</span>]     MMBINI          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">5</span> <span style="color:#cd00cd">6</span> <span style="color:#cd00cd">0</span> ; __add
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_addk"><span>OP_ADDK</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] + K[C]:number</code> <code>å¸¸é‡åŠ </code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a,b <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>,<span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span> a <span style="color:#39c">=</span> a <span style="color:#39c">+</span> <span style="color:#cd00cd">5.0</span>
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">007</span>B2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     ADDK            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; <span style="color:#cd00cd">5.0</span> <span style="">å¸¸é‡åŠ </span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">2</span>]     MMBINK          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">6</span> <span style="color:#cd00cd">0</span> ; __add <span style="color:#cd00cd">5.0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_subk"><span>OP_SUBK</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] - K[C]:number</code> <code>å¸¸é‡å‡</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a,b <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>,<span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span> a <span style="color:#39c">=</span> a <span style="color:#39c">-</span> <span style="color:#cd00cd">5.0</span>
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00</span>DB2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     SUBK            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; <span style="color:#cd00cd">5.0</span> <span style="">å¸¸é‡å‡</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">2</span>]     MMBINK          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">7</span> <span style="color:#cd00cd">0</span> ; __sub <span style="color:#cd00cd">5.0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_mulk"><span>OP_MULK</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] * K[C]:number</code> <code>å¸¸é‡ä¹˜</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a,b <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>,<span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span> a <span style="color:#39c">=</span> a <span style="color:#39c">*</span> <span style="color:#cd00cd">5.0</span>
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">015</span>D2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     MULK            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; <span style="color:#cd00cd">5.0</span> <span style="">å¸¸é‡ä¹˜</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">2</span>]     MMBINK          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">8</span> <span style="color:#cd00cd">0</span> ; __mul <span style="color:#cd00cd">5.0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_modk"><span>OP_MODK</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] % K[C]:number</code> <code>å¸¸é‡æ¨¡</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a,b <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>,<span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span> a <span style="color:#39c">=</span> a <span style="color:#39c">%</span> <span style="color:#cd00cd">5.0</span>
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">01732290</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     MODK            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; <span style="color:#cd00cd">5.0</span> <span style="">å¸¸é‡æ¨¡</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">2</span>]     MMBINK          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">9</span> <span style="color:#cd00cd">0</span> ; __mod <span style="color:#cd00cd">5.0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_divk"><span>OP_DIVK</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] / K[C]:number</code> <code>å¸¸é‡é™¤</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a,b <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>,<span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span> a <span style="color:#39c">=</span> a <span style="color:#39c">/</span> <span style="color:#cd00cd">5.0</span>
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">008E2298</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     DIVK            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; <span style="color:#cd00cd">5.0</span> <span style="">å¸¸é‡é™¤</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">2</span>]     MMBINK          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">11</span> <span style="color:#cd00cd">0</span>        ; __div <span style="color:#cd00cd">5.0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_idivk"><span>OP_IDIVK</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] // K[C]:number</code> <code>å¸¸é‡æ•´é™¤</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a,b <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>,<span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span> a <span style="color:#39c">=</span> a <span style="color:#39c">//</span> <span style="color:#cd00cd">5.0</span>
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00</span>BB2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     IDIVK           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; <span style="color:#cd00cd">5.0</span> <span style="">å¸¸é‡æ•´é™¤</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">2</span>]     MMBINK          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">12</span> <span style="color:#cd00cd">0</span>        ; __idiv <span style="color:#cd00cd">5.0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_bandk"><span>OP_BANDK</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] &amp; K[C]:integer</code> <code>å¸¸é‡ä¸</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a,b <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>,<span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span> a <span style="color:#39c">=</span> a <span style="color:#39c">&amp;</span> <span style="color:#cd00cd">5</span>
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00</span>C22290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     BANDK           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; <span style="color:#cd00cd">5</span> <span style="">å¸¸é‡ä¸</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">2</span>]     MMBINK          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">13</span> <span style="color:#cd00cd">0</span>        ; __band <span style="color:#cd00cd">5</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_bork"><span>OP_BORK</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] | K[C]:integer</code> <code>å¸¸é‡æˆ–</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a,b <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>,<span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span> a <span style="color:#39c">=</span> a <span style="color:#39c">|</span> <span style="color:#cd00cd">5</span>
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00832428</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     BORK            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; <span style="color:#cd00cd">5</span> <span style="">å¸¸é‡æˆ–</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">2</span>]     MMBINK          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">14</span> <span style="color:#cd00cd">0</span>        ; __bor <span style="color:#cd00cd">5</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_bxork"><span>OP_BXORK</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] ~ K[C]:integer	</code> <code>å¸¸é‡å¼‚æˆ–</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a,b <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>,<span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span> a <span style="color:#39c">=</span> a <span style="color:#39c">~</span> <span style="color:#cd00cd">5</span>
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">009E2290</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     BXORK           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; <span style="color:#cd00cd">5</span> <span style="">å¸¸é‡å¼‚æˆ–</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">2</span>]     MMBINK          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">15</span> <span style="color:#cd00cd">0</span>        ; __bxor <span style="color:#cd00cd">5</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_shri"><span>OP_SHRI</span></h5>
<p><code>å…¬å¼</code>:<code>A B sC	R[A] := R[B] &gt;&gt; sC	</code> <code>ç«‹å³æ•°å³ç§»</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a,b <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>,<span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span> a <span style="color:#39c">=</span> a <span style="color:#39c">&gt;&gt;</span> <span style="color:#cd00cd">5</span>
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">007625</span>B8)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     SHRI            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">5</span> <span style="">ç«‹å³æ•°å³ç§»</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">2</span>]     MMBINI          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">5</span> <span style="color:#cd00cd">17</span> <span style="color:#cd00cd">0</span>        ; __shr
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_shli"><span>OP_SHLI</span></h5>
<p><code>å…¬å¼</code>:<code>A B sC	R[A] := sC &lt;&lt; R[B]	</code> <code>ç«‹å³æ•°å·¦ç§»</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> a <span style="color:#39c">+</span> b
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00</span>A22290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     SHLI            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">5</span> <span style="">ç«‹å³æ•°å·¦ç§»</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">2</span>]     MMBINI          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">5</span> <span style="color:#cd00cd">16</span> <span style="color:#cd00cd">1</span>        ; __shl flip
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_add"><span>OP_ADD</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] + R[C]	</code> <code>åŠ </code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> a <span style="color:#39c">+</span> b
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00</span>ED22A0)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">3</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     ADD             <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="">åŠ </span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">3</span>]     MMBIN           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">6</span>   ; __add
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_sub"><span>OP_SUB</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] - R[C]	</code> <code>å‡</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> a <span style="color:#39c">-</span> b
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00</span>FC22A0)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">3</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     SUB             <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="">å‡</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">3</span>]     MMBIN           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">7</span>   ; __sub
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_mul"><span>OP_MUL</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] * R[C]	</code> <code>ä¹˜</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> a <span style="color:#39c">*</span> b
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00</span>EF2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">3</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     MUL             <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="">ä¹˜</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">3</span>]     MMBIN           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">8</span>   ; __mul
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_mod"><span>OP_MOD</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] % R[C]	</code> <code>æ¨¡</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> a <span style="color:#39c">%</span> b
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">01102290</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">3</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     MOD             <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="">æ¨¡</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">3</span>]     MMBIN           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">9</span>   ; __mod
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_pow"><span>OP_POW</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] ^ R[C]	</code> <code>å¹‚</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> a <span style="color:#39c">^</span> b
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">006</span>F2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">3</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     POW             <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="">å¹‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">3</span>]     MMBIN           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">10</span>  ; __pow
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_div"><span>OP_DIV</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] / R[C]	</code> <code>æµ®ç‚¹é™¤</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> a <span style="color:#39c">/</span> b
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">008</span>B2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">3</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     DIV             <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="">æµ®ç‚¹é™¤</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">3</span>]     MMBIN           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">11</span>  ; __div
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_idiv"><span>OP_IDIV</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] // R[C]	</code> <code>æ•´é™¤</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> a <span style="color:#39c">//</span> b
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">011</span>A22A8)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">3</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     IDIV            <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="">æ•´é™¤</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">3</span>]     MMBIN           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">12</span>  ; __idiv
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_band"><span>OP_BAND</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] &amp; R[C]	</code> <code>ä½ä¸</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> a <span style="color:#39c">&amp;</span> b
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00</span>C32290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">3</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     BAND            <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="">ä½ä¸</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">3</span>]     MMBIN           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">13</span>  ; __band
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_bor"><span>OP_BOR</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] | R[C]	</code> <code>ä½æˆ–</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> a <span style="color:#39c">|</span> b
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00</span>D422A8)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">3</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     BOR             <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="">ä½æˆ–</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">3</span>]     MMBIN           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">14</span>  ; __bor
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_bxor"><span>OP_BXOR</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] ~ R[C]	</code> <code>ä½å¼‚æˆ–</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> a <span style="color:#39c">~</span> b
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">01592748</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">3</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     BXOR            <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="">ä½å¼‚æˆ–</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">3</span>]     MMBIN           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">15</span>  ; __bxor
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_shl"><span>OP_SHL</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] &lt;&lt; R[C]	</code> <code>å·¦ç§»</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> a <span style="color:#39c">&lt;&lt;</span> b
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">015</span>F2280)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">3</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     SHL             <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="">å·¦ç§»</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">3</span>]     MMBIN           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">16</span>  ; __shl
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_shl-1"><span>OP_SHL</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A] := R[B] &gt;&gt; R[C]	</code> <code>å³ç§»</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> a <span style="color:#39c">&gt;&gt;</span> b
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00</span>D72290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">3</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     SHR             <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="">å³ç§»</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">3</span>]     MMBIN           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">17</span>  ; __shr
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="å‰é¢ç®—æœ¯å’Œä½è¿ç®—å¤±è´¥å°è¯•è°ƒç”¨cå±‚å…ƒæ–¹æ³•"><span>å‰é¢ç®—æœ¯å’Œä½è¿ç®—å¤±è´¥å°è¯•è°ƒç”¨Cå±‚å…ƒæ–¹æ³•</span></h5>
<h6 id="op_mmbin"><span>OP_MMBIN</span></h6>
<p><code>å…¬å¼</code>:<code>A B C	call C metamethod over R[A] and R[B]	(*)</code> <code>ä½å¼‚æˆ–å¤±è´¥ä»¥åè°ƒç”¨Cå…ƒæ–¹æ³•</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> a <span style="color:#39c">~</span> b
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">01592748</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">3</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     BXOR            <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="">ä½å¼‚æˆ–</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">3</span>]     MMBIN           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">15</span>  ; __bxor <span style="">ä½å¼‚æˆ–å¤±è´¥äº†å°±ä¼šå»è°ƒç”¨</span>__bxor<span style="">å…ƒæ–¹æ³•</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h6 id="op_mmbini"><span>OP_MMBINI</span></h6>
<p><code>å…¬å¼</code>:<code>A B sC	R[A] := sC &lt;&lt; R[B]	</code> <code>ç«‹å³æ•°å·¦ç§»å¤±è´¥ä»¥åè°ƒç”¨Cå…ƒæ–¹æ³•</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> a <span style="color:#39c">+</span> b
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00</span>A22290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     SHLI            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">5</span> <span style="">ç«‹å³æ•°å·¦ç§»</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">2</span>]     MMBINI          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">5</span> <span style="color:#cd00cd">16</span> <span style="color:#cd00cd">1</span>        ; __shl flip <span style="">ç«‹å³æ•°å·¦ç§»å¤±è´¥äº†å°±ä¼šå»è°ƒç”¨</span>__shl<span style="">å…ƒæ–¹æ³•</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h6 id="op_mmbink"><span>OP_MMBINK</span></h6>
<p><code>å…¬å¼</code>:<code>A B C k   call C metamethod over R[A] and K[B]</code> <code>å¸¸é‡å¼‚æˆ–å¤±è´¥ä»¥åè°ƒç”¨Cå…ƒæ–¹æ³•</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a,b <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>,<span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span> a <span style="color:#39c">=</span> a <span style="color:#39c">~</span> <span style="color:#cd00cd">5</span>
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">009E2290</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     BXORK           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; <span style="color:#cd00cd">5</span> <span style="">å¸¸é‡å¼‚æˆ–</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">2</span>]     MMBINK          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">15</span> <span style="color:#cd00cd">0</span>        ; __bxor <span style="color:#cd00cd">5</span> <span style="">å¸¸é‡å¼‚æˆ–å¤±è´¥äº†å°±ä¼šå»è°ƒç”¨</span>__bxor<span style="">å…ƒæ–¹æ³•</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h4 id="ä¸€å…ƒè¿ç®—"><span>ä¸€å…ƒè¿ç®—</span></h4>
<h5 id="op_unm"><span>OP_UNM</span></h5>
<p><code>å…¬å¼</code>:<code>A B	R[A] := -R[B]</code> <code>ä¸€å…ƒå‡</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#39c">-</span>a
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">4</span> instructions at <span style="color:#cd00cd">009722</span>B8)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     UNM             <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">0</span> <span style="">ä¸€å…ƒå‡</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_bnot"><span>OP_BNOT</span></h5>
<p><code>å…¬å¼</code>:<code>A B	R[A] := ~R[B]</code> <code>ä½é</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#39c">~</span>a
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">4</span> instructions at <span style="color:#cd00cd">00</span>CB2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     BNOT            <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">0</span> <span style="">ä½é</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h4 id="é€»è¾‘è¿ç®—"><span>é€»è¾‘è¿ç®—</span></h4>
<h5 id="op_not"><span>OP_NOT</span></h5>
<p><code>å…¬å¼</code>:<code>A B	R[A] := not R[B]</code> <code>é€»è¾‘å–å</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cdcd00">not</span>(a)
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">4</span> instructions at <span style="color:#cd00cd">00</span>A12290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     NOT             <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">0</span> <span style="">é€»è¾‘å–å</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h4 id="å‘¨è¾¹æ“ä½œ"><span>å‘¨è¾¹æ“ä½œ</span></h4>
<h5 id="op_len"><span>OP_LEN</span></h5>
<p><code>å…¬å¼</code>:<code>A B	R[A] := #R[B] (length operator)</code> <code>å–é•¿åº¦</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#39c">#</span>a
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">4</span> instructions at <span style="color:#cd00cd">00952290</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LEN             <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">0</span> <span style="">å–é•¿åº¦</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_concat"><span>OP_CONCAT</span></h5>
<p><code>å…¬å¼</code>:<code>A B	R[A] := R[A].. ... ..R[A + B - 1]</code> <code>æ‹¼æ¥å¯¹è±¡</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> a <span style="color:#39c">..</span> <span style="color:#cd00cd">22</span>
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00</span>D122A8)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     MOVE            <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">22</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">2</span>]     CONCAT          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span> <span style="">æ‹¼æ¥å¯¹è±¡</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h4 id="å…³é—­ä¸Šå€¼"><span>å…³é—­ä¸Šå€¼</span></h4>
<h5 id="op_close"><span>OP_CLOSE</span></h5>
<p><code>å…¬å¼</code>:<code>A	close all upvalues &gt;= R[A]</code> <code>å…³é—­ä¸Šå€¼</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#cdcd00">do</span>
</span></span><span style="display:flex;"><span>	<span style="color:#00cd00">local</span> testvar
</span></span><span style="display:flex;"><span>	<span style="color:#cdcd00">function</span> fun( ... )
</span></span><span style="display:flex;"><span>		testvar <span style="color:#39c">=</span> <span style="color:#cd00cd">22222</span>
</span></span><span style="display:flex;"><span>	<span style="color:#cdcd00">end</span>
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">end</span>
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">01172290</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">1</span> <span style="color:#cdcd00">function</span>
</span></span><span style="display:flex;"><span>        <span style="">1</span>       <span style="">[1]</span>     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">2</span>]     LOADNIL         <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; <span style="color:#cd00cd">1</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">5</span>]     CLOSURE         <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">0</span>     ; <span style="color:#cd00cd">01173</span>D38
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     SETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>   ; _ENV <span style="color:#cd0000">&#34;fun&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">5</span>]     CLOSE           <span style="color:#cd00cd">0</span>    <span style="">å…³é—­ä¸Šå€¼</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">7</span>]     RETURN          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>k  ; <span style="color:#cd00cd">0</span> out
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">function</span> <span style="">&lt;</span>.<span style="">\</span><span style="color:#00cdcd">helloworld</span>.<span style="color:#00cdcd">lua</span>:<span style="">3,5&gt;</span> (<span style="color:#cd00cd">4</span> instructions at <span style="color:#cd00cd">01173</span>D38)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">0</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">3</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">4</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">22222</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">4</span>]     SETUPVAL        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; testvar
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">5</span>]     RETURN          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h4 id="tbcå˜é‡"><span>tbcå˜é‡</span></h4>
<h5 id="op_tbc"><span>OP_TBC</span></h5>
<p><code>å…¬å¼</code>:<code>A	mark variable A &quot;to be closed&quot;</code> <code>æ ‡è®°å¯„å­˜å™¨ä¸ºtbc</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span> <span style="color:#00cd00">local</span> tt<span style="color:#39c">&lt;</span>close<span style="color:#39c">&gt;</span> <span style="color:#39c">=</span> t;
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">4</span> instructions at <span style="color:#cd00cd">011</span>C2428)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;t&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     TBC             <span style="color:#cd00cd">0</span>  <span style="">æ ‡è®°å¯„å­˜å™¨ä¸º</span>tbc
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>k  ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h4 id="åˆ†æ”¯ä¸è·³è½¬"><span>åˆ†æ”¯ä¸è·³è½¬</span></h4>
<h5 id="op_eq"><span>OP_EQ</span></h5>
<ul>
<li>
<p><code>OP_EQ</code>åˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„<code>JMP</code>æŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®</p>
</li>
<li>
<p><code>å…¬å¼</code>:<code>A B k	if ((R[A] == R[B]) ~= k) then pc++</code> <code>ç›¸ç­‰æµ‹è¯•,æ¡ä»¶è·³è½¬</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">5</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> c <span style="color:#39c">=</span> a<span style="color:#39c">==</span>b
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">8</span> instructions at <span style="color:#cd00cd">016</span>F2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">3</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">5</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     EQ              <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="">æ¯”è¾ƒç›¸ç­‰</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">3</span>]     JMP             <span style="color:#cd00cd">1</span>       ; to <span style="color:#cd00cd">7</span> <span style="">ä¸æ»¡è¶³æ¡ä»¶è·³è½¬</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">3</span>]     LFALSESKIP      <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">3</span>]     LOADTRUE        <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">8</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_lt"><span>OP_LT</span></h5>
<ul>
<li>
<p><code>OP_LT</code>åˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„<code>JMP</code>æŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®</p>
</li>
<li>
<p><code>å…¬å¼</code>:<code>A B k	if ((R[A] &lt;  R[B]) ~= k) then pc++</code> <code>å°äºæµ‹è¯•,æ¡ä»¶è·³è½¬</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">5</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> c <span style="color:#39c">=</span> a <span style="color:#39c">&lt;</span> b
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">8</span> instructions at <span style="color:#cd00cd">00782290</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">3</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">5</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     LT              <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="">æ¯”è¾ƒå°äº</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">3</span>]     JMP             <span style="color:#cd00cd">1</span>       ; to <span style="color:#cd00cd">7</span> <span style="">ä¸æ»¡è¶³æ¡ä»¶è·³è½¬</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">3</span>]     LFALSESKIP      <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">3</span>]     LOADTRUE        <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">8</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_le"><span>OP_LE</span></h5>
<ul>
<li>
<p><code>OP_LE</code>åˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„<code>JMP</code>æŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®</p>
</li>
<li>
<p><code>å…¬å¼</code>:<code>A B k	if ((R[A] &lt;= R[B]) ~= k) then pc++</code> <code>å°äºç­‰äºæµ‹è¯•,æ¡ä»¶è·³è½¬</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">5</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> c <span style="color:#39c">=</span> a <span style="color:#39c">&lt;=</span> b
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">8</span> instructions at <span style="color:#cd00cd">00</span>BA2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">3</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">5</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     LE              <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="">æ¯”è¾ƒå°äºç­‰äº</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">3</span>]     JMP             <span style="color:#cd00cd">1</span>       ; to <span style="color:#cd00cd">7</span> <span style="">ä¸æ»¡è¶³æ¡ä»¶è·³è½¬</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">3</span>]     LFALSESKIP      <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">3</span>]     LOADTRUE        <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">8</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_eqk"><span>OP_EQK</span></h5>
<ul>
<li>
<p><code>OP_EQK</code>åˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„<code>JMP</code>æŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®</p>
</li>
<li>
<p><code>å…¬å¼</code>:<code>A B k	if ((R[A] == K[B]) ~= k) then pc++</code> <code>å¸¸é‡ç›¸ç­‰æµ‹è¯•,æ¡ä»¶è·³è½¬</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> c <span style="color:#39c">=</span> a <span style="color:#39c">==</span> <span style="color:#cd0000">&#34;1&#34;</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">7</span> instructions at <span style="color:#cd00cd">01622290</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">2</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;a&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     EQK             <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd0000">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     JMP             <span style="color:#cd00cd">1</span>       ; to <span style="color:#cd00cd">6</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">1</span>]     LFALSESKIP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">1</span>]     LOADTRUE        <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_eqi"><span>OP_EQI</span></h5>
<ul>
<li>
<p><code>OP_EQI</code>åˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„<code>JMP</code>æŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®</p>
</li>
<li>
<p><code>å…¬å¼</code>:<code>A sB k	if ((R[A] == sB) ~= k) then pc++</code> <code>ç«‹å³æ•°ç›¸ç­‰æµ‹è¯•,æ¡ä»¶è·³è½¬</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> c <span style="color:#39c">=</span> a <span style="color:#39c">==</span> <span style="color:#cd00cd">1</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">7</span> instructions at <span style="color:#cd00cd">00802290</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;a&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     EQI             <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="">ç«‹å³æ•°ç›¸ç­‰æµ‹è¯•</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     JMP             <span style="color:#cd00cd">1</span>       ; to <span style="color:#cd00cd">6</span> <span style="">ä¸ç›¸ç­‰è·³è½¬</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">1</span>]     LFALSESKIP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">1</span>]     LOADTRUE        <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_lti"><span>OP_LTI</span></h5>
<ul>
<li>
<p><code>OP_LTI</code>åˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„<code>JMP</code>æŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®</p>
</li>
<li>
<p><code>å…¬å¼</code>:<code>A sB k	if ((R[A] &lt; sB) ~= k) then pc++</code> <code>ç«‹å³æ•°å°äºæµ‹è¯•,æ¡ä»¶è·³è½¬</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> c <span style="color:#39c">=</span> a <span style="color:#39c">&lt;</span> <span style="color:#cd00cd">1</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">7</span> instructions at <span style="color:#cd00cd">00</span>FF2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;a&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LTI             <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="">ç«‹å³æ•°å°äºæµ‹è¯•</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     JMP             <span style="color:#cd00cd">1</span>       ; to <span style="color:#cd00cd">6</span> <span style="">ä¸ç¬¦åˆæ¡ä»¶è·³è½¬</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">1</span>]     LFALSESKIP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">1</span>]     LOADTRUE        <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_lei"><span>OP_LEI</span></h5>
<ul>
<li>
<p><code>OP_LEI</code>åˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„<code>JMP</code>æŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®</p>
</li>
<li>
<p><code>å…¬å¼</code>:<code>A sB k	if ((R[A] &lt;= sB) ~= k) then pc++</code> <code>ç«‹å³æ•°å°äºç­‰äºæµ‹è¯•,æ¡ä»¶è·³è½¬</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> c <span style="color:#39c">=</span> a <span style="color:#39c">&lt;=</span> <span style="color:#cd00cd">1</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">7</span> instructions at <span style="color:#cd00cd">00</span>CE2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;a&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LEI             <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="">ç«‹å³æ•°å°äºç­‰äºæµ‹è¯•</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     JMP             <span style="color:#cd00cd">1</span>       ; to <span style="color:#cd00cd">6</span> <span style="">ä¸ç¬¦åˆæ¡ä»¶è·³è½¬</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">1</span>]     LFALSESKIP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">1</span>]     LOADTRUE        <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_gti"><span>OP_GTI</span></h5>
<ul>
<li>
<p><code>OP_GTI</code>åˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„<code>JMP</code>æŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®</p>
</li>
<li>
<p><code>å…¬å¼</code>:<code>A sB k	if ((R[A] &gt; sB) ~= k) then pc++</code> <code>ç«‹å³æ•°å¤§äºæµ‹è¯•,æ¡ä»¶è·³è½¬</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> c <span style="color:#39c">=</span> a <span style="color:#39c">&gt;</span> <span style="color:#cd00cd">1</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">7</span> instructions at <span style="color:#cd00cd">01142290</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;a&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     GTI             <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="">ç«‹å³æ•°å¤§äºæµ‹è¯•</span>,<span style="">æ¡ä»¶è·³è½¬</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     JMP             <span style="color:#cd00cd">1</span>       ; to <span style="color:#cd00cd">6</span> <span style="">ä¸ç¬¦åˆæ¡ä»¶è·³è½¬</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">1</span>]     LFALSESKIP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">1</span>]     LOADTRUE        <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_gei"><span>OP_GEI</span></h5>
<ul>
<li>
<p><code>OP_GEI</code>åˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„<code>JMP</code>æŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®</p>
</li>
<li>
<p><code>å…¬å¼</code>:<code>A sB k	if ((R[A] &gt;= sB) ~= k) then pc++</code> <code>ç«‹å³æ•°å¤§äºç­‰äºæµ‹è¯•,æ¡ä»¶è·³è½¬</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> c <span style="color:#39c">=</span> a <span style="color:#39c">&gt;=</span> <span style="color:#cd00cd">1</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">7</span> instructions at <span style="color:#cd00cd">00</span>C72290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;a&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     GEI             <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="">ç«‹å³æ•°å¤§äºç­‰äºæµ‹è¯•</span>,<span style="">æ¡ä»¶è·³è½¬</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     JMP             <span style="color:#cd00cd">1</span>       ; to <span style="color:#cd00cd">6</span> <span style="">ä¸ç¬¦åˆæ¡ä»¶è·³è½¬</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">1</span>]     LFALSESKIP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">1</span>]     LOADTRUE        <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_test"><span>OP_TEST</span></h5>
<ul>
<li>
<p><code>OP_TEST</code>åˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„<code>JMP</code>æŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®</p>
</li>
<li>
<p><code>OP_TEST</code>é€»è¾‘æŒ‡ä»¤ç”¨äºå®ç° <code>and</code> å’Œ <code>or </code>é€»è¾‘è¿ç®—ç¬¦
å¦‚æœç›¸ç­‰åˆ™å°†<code>å¯„å­˜å™¨B</code>çš„å€¼ èµ‹ç»™<code>å¯„å­˜å™¨ A</code>,ç„¶åç»§ç»­æ‰§è¡Œ,åä¹‹å¦‚æœä¸ç›¸ç­‰,åˆ™è·³è¿‡åé¢çš„ <code>JMP</code>æŒ‡ä»¤</p>
</li>
<li>
<p><code>å…¬å¼</code>:<code>A k	if (not R[A] == k) then pc++</code> <code>boolæµ‹è¯•,æ¡ä»¶è·³è½¬</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> c <span style="color:#39c">=</span> a <span style="color:#cdcd00">and</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> c <span style="color:#39c">=</span> a <span style="color:#cdcd00">or</span> <span style="color:#cd00cd">1</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">10</span> instructions at <span style="color:#cd00cd">00</span>B82290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;a&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     TEST            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> and<span style="">è¿ç®—ç¬¦çš„æµ‹è¯•</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     JMP             <span style="color:#cd00cd">1</span>       ; to <span style="color:#cd00cd">6</span> <span style="">ä¸æ»¡è¶³æ¡ä»¶è·³è½¬</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">2</span>]     GETTABUP        <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;a&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">2</span>]     TEST            <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> or<span style="">è¿ç®—ç¬¦çš„æµ‹è¯•</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">8</span>       [<span style="color:#cd00cd">2</span>]     JMP             <span style="color:#cd00cd">1</span>       ; to <span style="color:#cd00cd">10</span> <span style="">ä¸æ»¡è¶³æ¡ä»¶è·³è½¬</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">9</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">10</span>      [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_testset"><span>OP_TESTSET</span></h5>
<ul>
<li>
<p><code>OP_TESTSET</code>åˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„<code>JMP</code>æŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®</p>
</li>
<li>
<p><code>å…¬å¼</code>:<code>A B k	if (not R[B] == k) then pc++ else R[A] := R[B] (*)</code> <code>boolæµ‹è¯•,æ¡ä»¶è·³è½¬å’Œèµ‹å€¼</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> c <span style="color:#39c">=</span> a <span style="color:#cdcd00">and</span> b
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00</span>A42290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">3</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADNIL         <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>     ; <span style="color:#cd00cd">2</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">3</span>]     TESTSET         <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="">åˆ¤æ–­å¯„å­˜å™¨</span>B:<span style="color:#cd00cd">0</span><span style="">ä¸Šé¢çš„å€¼è½¬æˆ</span>bool<span style="">å€¼å</span>,<span style="">æ˜¯å¦å’Œå¯„å­˜å™¨</span>C:<span style="color:#cd00cd">0</span><span style="">è¡¨ç¤ºçš„</span>bool<span style="">å€¼ç›¸ç­‰</span>
</span></span><span style="display:flex;"><span><span style="">å¦‚æœç»“æœä¸€è‡´</span>,<span style="">å°†å¯„å­˜å™¨</span>B:<span style="color:#cd00cd">0</span><span style="">ä¸Šé¢çš„å€¼å¤åˆ¶åˆ°å¯„å­˜å™¨</span>A:<span style="color:#cd00cd">2</span><span style="">ä¸Šé¢</span>,<span style="">å¦åˆ™æ¡ä»¶è·³è½¬</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     JMP             <span style="color:#cd00cd">1</span>       ; to <span style="color:#cd00cd">6</span> <span style="">ä¸ç¬¦åˆæ¡ä»¶è·³è½¬</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">3</span>]     MOVE            <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
<li>
<p>åˆ¤æ–­å¯„å­˜å™¨<code>B:0</code>ä¸Šé¢çš„å€¼è½¬æˆ<code>bool</code>å€¼å,æ˜¯å¦å’Œå¯„å­˜å™¨<code>C:0</code>è¡¨ç¤ºçš„<code>bool</code>å€¼ç›¸ç­‰
å¦‚æœç»“æœä¸€è‡´,å°†å¯„å­˜å™¨<code>B:0</code>ä¸Šé¢çš„å€¼å¤åˆ¶åˆ°å¯„å­˜å™¨<code>A:2</code>ä¸Šé¢,å¦åˆ™æ¡ä»¶è·³è½¬</p>
</li>
<li>
<p>ä¸ç¬¦åˆæ¡ä»¶è·³è½¬</p>
</li>
</ul>
<h4 id="å‡½æ•°è°ƒç”¨"><span>å‡½æ•°è°ƒç”¨</span></h4>
<h5 id="op_call"><span>OP_CALL</span></h5>
<p><code>å…¬å¼</code>:<code>A B C	R[A], ... ,R[A+C-2] := R[A](R[A+1], ... ,R[A+B-1]) </code> <code>å‡½æ•°è°ƒç”¨</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#cdcd00">function</span> fun()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fun()
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00802290</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">0</span> locals, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">1</span> <span style="color:#cdcd00">function</span>
</span></span><span style="display:flex;"><span>        <span style="">1</span>       <span style="">[1]</span>     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">3</span>]     CLOSURE         <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; <span style="color:#cd00cd">00803</span>BE8
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     SETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;fun&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">5</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;fun&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">5</span>]     CALL            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> <span style="color:#cdcd00">in</span> <span style="color:#cd00cd">0</span> out <span style="">å‡½æ•°è°ƒç”¨</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">5</span>]     RETURN          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">function</span> <span style="">&lt;</span>.<span style="">\</span><span style="color:#00cdcd">helloworld</span>.<span style="color:#00cdcd">lua</span>:<span style="">1,3&gt;</span> (<span style="color:#cd00cd">1</span> instruction at <span style="color:#cd00cd">00803</span>BE8)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">0</span> upvalues, <span style="color:#cd00cd">0</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">3</span>]     RETURN0
</span></span></code></pre></div></li>
</ul>
<h5 id="op_tailcall"><span>OP_TAILCALL</span></h5>
<p><code>å…¬å¼</code>:<code>A B C k	return R[A](R[A+1], ... ,R[A+B-1]) </code> <code>å°¾è°ƒç”¨</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#cdcd00">function</span> fun1() 
</span></span><span style="display:flex;"><span>    <span style="color:#cdcd00">return</span> fun2(<span style="color:#cd00cd">111</span>, <span style="color:#cd00cd">222</span>)
</span></span><span style="display:flex;"><span> <span style="color:#cdcd00">end</span>
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">4</span> instructions at <span style="color:#cd00cd">00E82290</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">0</span> locals, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">1</span> <span style="color:#cdcd00">function</span>
</span></span><span style="display:flex;"><span>        <span style="">1</span>       <span style="">[1]</span>     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">3</span>]     CLOSURE         <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; <span style="color:#cd00cd">00E83</span>BE8
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     SETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;fun1&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">function</span> <span style="">&lt;</span>.<span style="">\</span><span style="color:#00cdcd">helloworld</span>.<span style="color:#00cdcd">lua</span>:<span style="">1,3&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00E83</span>BE8)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">0</span> locals, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">2</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;fun2&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">111</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">222</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     TAILCALL        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">0</span>   ; <span style="color:#cd00cd">2</span> <span style="color:#cdcd00">in</span> <span style="">å°¾è°ƒç”¨</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; all out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">3</span>]     RETURN0
</span></span></code></pre></div></li>
</ul>
<p>å› ä¸ºè°ƒç”¨<code>fun2</code>å,<code>fun1</code>ä¸­ä¸å†æ‰§è¡Œä»»ä½•ä»£ç ,æ‰€ä»¥ä¸éœ€è¦ä¿ç•™<code>fun1</code>çš„è°ƒç”¨æ ˆä¿¡æ¯,<code>Lua</code>åšäº†è¿™æ ·çš„ä¼˜åŒ–,ç§°ä¸º<code>å°¾è°ƒç”¨æ¶ˆé™¤</code>,<code>fun2</code>è¿”å›å,æ§åˆ¶ç‚¹ç›´æ¥è¿”å›åˆ°è°ƒç”¨<code>fun1</code>çš„åœ°æ–¹,æœ‰ç‚¹ç±»ä¼¼<code>c</code>è¯­è¨€çš„<code>goto</code>è¯­å¥,è¿™æ ·åšèƒ½å‡å°‘æ ˆçš„ç©ºé—´æ¶ˆè€—,éå¸¸<code>nice</code></p>
<h5 id="op_return"><span>OP_RETURN</span></h5>
<p><code>å…¬å¼</code>:<code>A B C k	return R[A], ... ,R[A+B-2]	(see note) </code> <code>ä»å‡½æ•°è°ƒç”¨è¿”å›</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#cdcd00">function</span> fun1() 
</span></span><span style="display:flex;"><span>    <span style="color:#cdcd00">return</span> <span style="color:#cd00cd">1</span>,<span style="color:#cd00cd">2</span>,<span style="color:#cd00cd">3</span>,<span style="color:#cd00cd">4</span>
</span></span><span style="display:flex;"><span> <span style="color:#cdcd00">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#00cd00">local</span> x,y,z <span style="color:#39c">=</span> fun1()
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00E22280</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">3</span> locals, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">1</span> <span style="color:#cdcd00">function</span>
</span></span><span style="display:flex;"><span>        <span style="">1</span>       <span style="">[1]</span>     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">3</span>]     CLOSURE         <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; <span style="color:#cd00cd">00E23</span>BD8
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     SETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;fun1&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">5</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;fun1&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">5</span>]     CALL            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">4</span>   ; <span style="color:#cd00cd">0</span> <span style="color:#cdcd00">in</span> <span style="color:#cd00cd">3</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">5</span>]     RETURN          <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">function</span> <span style="">&lt;</span>.<span style="">\</span><span style="color:#00cdcd">helloworld</span>.<span style="color:#00cdcd">lua</span>:<span style="">1,3&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00E23</span>BD8)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span> params, <span style="color:#cd00cd">4</span> slots, <span style="color:#cd00cd">0</span> upvalues, <span style="color:#cd00cd">0</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">3</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">2</span>]     RETURN          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">5</span> <span style="color:#cd00cd">0</span>   ; <span style="color:#cd00cd">4</span> out <span style="">è¿”å›</span><span style="color:#cd00cd">4</span><span style="">ä¸ªå‚æ•°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">3</span>]     RETURN0
</span></span></code></pre></div><ul>
<li>å¦‚æœå¯„å­˜å™¨<code>B==0</code> è¾“å‡º<code>all out</code></li>
<li>å¦‚æœå¯„å­˜å™¨<code>B&gt;0</code> è¾“å…¥<code>B-1</code>ä¸ªè¿”å›å€¼</li>
</ul>
</li>
</ul>
<h5 id="op_return0"><span>OP_RETURN0</span></h5>
<p><code>å…¬å¼</code>:<code>return</code> <code>è¿”å›æ— ç»“æœ</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#cdcd00">function</span> fun1() 
</span></span><span style="display:flex;"><span>    <span style="color:#cdcd00">return</span>
</span></span><span style="display:flex;"><span> <span style="color:#cdcd00">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> x <span style="color:#39c">=</span> fun1()
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00</span>C32290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">1</span> <span style="color:#cdcd00">function</span>
</span></span><span style="display:flex;"><span>        <span style="">1</span>       <span style="">[1]</span>     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">3</span>]     CLOSURE         <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; <span style="color:#cd00cd">00</span>C33BE8
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     SETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;fun1&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">5</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;fun1&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">5</span>]     CALL            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>   ; <span style="color:#cd00cd">0</span> <span style="color:#cdcd00">in</span> <span style="color:#cd00cd">1</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">5</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">function</span> <span style="">&lt;</span>.<span style="">\</span><span style="color:#00cdcd">helloworld</span>.<span style="color:#00cdcd">lua</span>:<span style="">1,3&gt;</span> (<span style="color:#cd00cd">2</span> instructions at <span style="color:#cd00cd">00</span>C33BE8)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">0</span> upvalues, <span style="color:#cd00cd">0</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">2</span>]     RETURN0 <span style="">è¿”å›æ— ç»“æœ</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">3</span>]     RETURN0 <span style="">è¿”å›æ— ç»“æœ</span>
</span></span></code></pre></div></li>
</ul>
<h5 id="op_return1"><span>OP_RETURN1</span></h5>
<p><code>å…¬å¼</code>:<code>A	return R[A]</code> <code>è¿”å›ä¸€ä¸ªå‚æ•°</code></p>
<ul>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#cdcd00">function</span> fun1() 
</span></span><span style="display:flex;"><span>    <span style="color:#cdcd00">return</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span> <span style="color:#cdcd00">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#00cd00">local</span> x <span style="color:#39c">=</span> fun1()
</span></span></code></pre></div></li>
<li>
<p><code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">6</span> instructions at <span style="color:#cd00cd">00</span>BA2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">1</span> <span style="color:#cdcd00">function</span>
</span></span><span style="display:flex;"><span>        <span style="">1</span>       <span style="">[1]</span>     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">3</span>]     CLOSURE         <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; <span style="color:#cd00cd">00</span>BA3BE8
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     SETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;fun1&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">5</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;fun1&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">5</span>]     CALL            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>   ; <span style="color:#cd00cd">0</span> <span style="color:#cdcd00">in</span> <span style="color:#cd00cd">1</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">5</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">function</span> <span style="">&lt;</span>.<span style="">\</span><span style="color:#00cdcd">helloworld</span>.<span style="color:#00cdcd">lua</span>:<span style="">1,3&gt;</span> (<span style="color:#cd00cd">3</span> instructions at <span style="color:#cd00cd">00</span>BA3BE8)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">0</span> upvalues, <span style="color:#cd00cd">0</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">2</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">2</span>]     RETURN1         <span style="color:#cd00cd">0</span> <span style="">è¿”å›</span><span style="color:#cd00cd">1</span><span style="">ä¸ªå€¼</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">3</span>]     RETURN0
</span></span></code></pre></div></li>
</ul>
<h5 id="op_vararg"><span>OP_VARARG</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A C	R[A], R[A+1], ..., R[A+C-2] = vararg</code> <code>å°†å‡½æ•°çš„å¯å˜å‚æ•°æ‹·è´ç»™å¯„å­˜å™¨</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> ...
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">3</span> instructions at <span style="color:#cd00cd">00</span>A92290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     VARARG          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">2</span>     ; <span style="color:#cd00cd">1</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<p>â€‹		å¦‚æœ<code>å¯„å­˜å™¨Cç­‰äº0</code>é‚£ä¹ˆå°±è¾“å‡º<code>all out </code>å¦åˆ™è¾“å‡º <code>c-1</code> <code>out</code></p>
<p>â€‹		è¿™ä¸ªCé‡Œé¢çš„å€¼å°±æ˜¯<code>local a = ...</code> ç­‰å·å‰é¢å±€éƒ¨å˜é‡çš„ä¸ªæ•°,æ¯”å¦‚ç°åœ¨åªæœ‰ä¸€ä¸ªå±€éƒ¨å˜é‡<code>a</code>é‚£ä¹ˆå°±æ˜¯<code>1</code></p>
<h5 id="op_varargprep"><span>OP_VARARGPREP</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A	(adjust vararg parameters)</code> <code>æŸ¥çœ‹å¯å˜å‚æ•°æ–¹å¼ä¸‹å›ºå®šå‚æ•°ä¸ªæ•°</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#cdcd00">function</span> func(a,b, ...)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">end</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">4</span> instructions at <span style="color:#cd00cd">00</span>F52290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">0</span> locals, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">1</span> <span style="color:#cdcd00">function</span>
</span></span><span style="display:flex;"><span>        <span style="">1</span>       <span style="">[1]</span>     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">3</span>]     CLOSURE         <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; <span style="color:#cd00cd">00</span>F53BE8
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     SETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;func&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">function</span> <span style="">&lt;</span>.<span style="">\</span><span style="color:#00cdcd">helloworld</span>.<span style="color:#00cdcd">lua</span>:<span style="">1,3&gt;</span> (<span style="color:#cd00cd">2</span> instructions at <span style="color:#cd00cd">00</span>F53BE8)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">2</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">0</span> upvalues, <span style="color:#cd00cd">2</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">2</span> <span style="">æŸ¥çœ‹å¯å˜å‚æ•°æ–¹å¼ä¸‹å›ºå®šå‚æ•°ä¸ªæ•°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">3</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<p>â€‹	  å› ä¸º<code>func</code>å‡½æ•°é‡Œé¢æœ‰<code>a,b</code>å›ºå®šçš„ä¸¤ä¸ªå›ºå®šå˜é‡,æ‰€ä»¥æŒ‡ä»¤å“ªé‡Œå¯ä»¥çœ‹åˆ°æ˜¯<code>2</code></p>
<h3 id="iabxæ“ä½œæ•°æ¨¡å¼"><span>iABxæ“ä½œæ•°æ¨¡å¼</span></h3>
<p><img loading="lazy" src="image-20230226110849907.png" alt="image-20230226110849907"  />
</p>
<p>å ç”¨<code>bit</code>ä½èŒƒå›´</p>
<table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>èŒƒå›´(å•ä½bit)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Op(7)</td>
<td>0~6</td>
</tr>
<tr>
<td>A(8)</td>
<td>7~14</td>
</tr>
<tr>
<td>Bx(17)</td>
<td>15~31</td>
</tr>
</tbody>
</table>
<h4 id="op_loadk"><span>OP_LOADK</span></h4>
<p><code>å…¬å¼</code>:<code>A Bx	R[A] := K[Bx]</code> <code>åŠ è½½å¸¸é‡ç«‹å³æ•°åˆ°å¯„å­˜å™¨</code></p>
<ul>
<li>
<p><code>lua</code>ä¼šå°†</p>
<ul>
<li>å¸¸é‡è¡¨è¾¾å¼</li>
<li>å­—ç¬¦ä¸²</li>
<li>æ•´å‹,æµ®ç‚¹å‹è¶…å‡ºå¯„å­˜å™¨<code>sBx</code>æ“ä½œæ•°å€¼èŒƒå›´çš„æ•°</li>
<li>ç­‰ç­‰</li>
</ul>
<p>éƒ½æ”¾åˆ°å¸¸é‡è¡¨ä¸­</p>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd0000">&#34;lllllll&#34;</span> <span style="">å­—ç¬¦ä¸²</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> b <span style="color:#39c">=</span> <span style="color:#cd00cd">333333333333333333333333333333333333333333333</span> <span style="">æ•´å‹è¶…å‡ºå¯„å­˜å™¨</span>sBx<span style="">æ“ä½œæ•°å€¼</span>
</span></span><span style="display:flex;"><span><span style="color:#00cd00">local</span> c <span style="color:#39c">=</span> <span style="color:#cd00cd">111111111111111111111111.111111111111111111111</span> <span style="">æµ®ç‚¹æ•°è¶…å‡ºå¯„å­˜å™¨</span>sBx<span style="">æ“ä½œæ•°å€¼</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">5</span> instructions at <span style="color:#cd00cd">00</span>F822A8)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">3</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">3</span> locals, <span style="color:#cd00cd">3</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADK           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; <span style="color:#cd0000">&#34;lllllll&#34;</span> <span style="">ä»å¸¸é‡è¡¨</span><span style="color:#cd00cd">0</span><span style="">å·ä½ç½®ä¸­å°†</span><span style="color:#cd0000">&#34;lllllll&#34;</span><span style="">åŠ è½½åˆ°å¯„å­˜å™¨çš„</span><span style="color:#cd00cd">0</span><span style="">å·ä½ç½®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     LOADK           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>     ; <span style="color:#cd00cd">3.3333333333333e+44</span> <span style="">ä»å¸¸é‡è¡¨</span><span style="color:#cd00cd">1</span><span style="">å·ä½ç½®å°†</span><span style="color:#cd00cd">3.3333333333333e+44</span><span style="">åŠ è½½åˆ°å¯„å­˜å™¨çš„</span><span style="color:#cd00cd">1</span><span style="">å·ä½ç½®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     LOADK           <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">2</span>     ; <span style="color:#cd00cd">1.1111111111111e+23</span> <span style="">ä»å¸¸é‡è¡¨</span><span style="color:#cd00cd">2</span><span style="">å·ä½ç½®å°†</span><span style="color:#cd00cd">1.1111111111111e+23</span><span style="">åŠ è½½åˆ°å¯„å­˜å™¨çš„</span><span style="color:#cd00cd">2</span><span style="">å·ä½ç½®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h4 id="op_loadkx"><span>OP_LOADKX</span></h4>
<p><code>å…¬å¼</code>:<code>A	R[A] := K[extra arg]</code> <code>åŠ è½½å¸¸é‡,å¸¸é‡ä»ä¸‹ä¸€æ¡OP_EXTRAARGæŒ‡ä»¤å¾—åˆ°</code></p>
<p>å½“éœ€è¦ç”Ÿæˆ<code>LOADK</code>æŒ‡ä»¤æ—¶,å¦‚æœéœ€è¦ç´¢å¼•çš„å¸¸é‡<code>id</code>è¶…å‡ºäº†<code>Bx</code>æ‰€èƒ½è¡¨ç¤ºçš„æœ‰æ•ˆèŒƒå›´,é‚£ä¹ˆå°±ç”Ÿæˆä¸€ä¸ª<code>LOADKX</code>æŒ‡ä»¤,å–ä»£<code>LOADK</code>æŒ‡ä»¤,å¹¶ä¸”æ¥ä¸‹æ¥ç«‹å³ç”Ÿæˆä¸€ä¸ª<code>EXTRAARG</code>æŒ‡ä»¤,å¹¶ç”¨å…¶<code>Ax</code>æ¥å­˜æ”¾è¿™ä¸ª<code>id</code></p>
<ul>
<li><code>Bx</code>çš„ä½æ•°æ˜¯<code>17</code>ä½,é‚£ä¹ˆèƒ½æ ‡è¯†çš„æ— ç¬¦å·æœ€å¤§å€¼æ˜¯<code>17</code>ä¸ª<code>1</code> ä¹Ÿå°±æ˜¯<code>2^17-1</code> = <code>262143</code>ä¸ªç´¢å¼•</li>
<li><code>Ax</code>çš„ä½æ•°æ˜¯<code>25</code>ä½,é‚£ä¹ˆèƒ½æ ‡è¯†çš„æ— ç¬¦å·æœ€å¤§å€¼æ˜¯<code>25</code>ä¸ª<code>1</code> ä¹Ÿå°±æ˜¯<code>2^25-1</code> = <code>67108863</code>ä¸ªç´¢å¼•</li>
<li>æ‰€ä»¥æˆ‘ä»¬èƒ½å¾—å‡ºç»“è®º<code>lua</code>å¸¸é‡è¡¨çš„ç´¢å¼•èƒ½è¾¾åˆ°æƒŠäººçš„ <code>262143 + 67108863</code> = <code>67371006</code>ä¸ªç´¢å¼•</li>
</ul>
<p>é‰´äºè¶…çº§å¤§çš„ç´¢å¼•èŒƒå›´,è¿™ä¸ªå°±ä¸å¼„luaç¤ºä¾‹ä»£ç äº†,å¤§å®¶çŸ¥é“åªè¦è¶…è¿‡262143çš„ç´¢å¼•,å°±ä¼šè§¦å‘<code>OP_LOADKX</code>æŒ‡ä»¤,å¹¶ç”¨å…¶<code>Ax</code>æ¥å­˜æ”¾è¿™ä¸ªè¶…å‡ºèŒƒå›´çš„<code>id</code>å°±å¥½äº†</p>
<h4 id="forå¾ªç¯"><span>forå¾ªç¯</span></h4>
<h5 id="op_forloop"><span>OP_FORLOOP</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A Bx	update counters; if loop continues then pc-=Bx;</code> <code>æ•°å€¼forå¾ªç¯</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#cdcd00">for</span> i<span style="color:#39c">=</span><span style="color:#cd00cd">1</span>,<span style="color:#cd00cd">100</span>,<span style="color:#cd00cd">10</span> <span style="color:#cdcd00">do</span>  <span style="color:#39c">//</span><span style="">åˆå§‹å€¼ä¸º</span><span style="color:#cd00cd">1</span>,<span style="">æ­¥é•¿ä¸º</span><span style="color:#cd00cd">10</span>,<span style="">ä¸Šé™ä¸º</span><span style="color:#cd00cd">100</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">end</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">7</span> instructions at <span style="color:#cd00cd">00</span>A022A8)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">4</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">4</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">100</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">10</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">1</span>]     FORPREP         <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; exit to <span style="color:#cd00cd">7</span> <span style="">æ•°å€¼</span>for<span style="">å¾ªç¯</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">1</span>]     FORLOOP         <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>     ; to <span style="color:#cd00cd">6</span> <span style="">æ•°å€¼</span>for<span style="">å¾ªç¯</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div><ol>
<li>
<p>è¯¥æŒ‡ä»¤å…ˆç»™<code>i</code>åŠ ä¸Šæ­¥é•¿,ç„¶ååˆ¤æ–­<code>i</code>æ˜¯å¦åœ¨èŒƒå›´ä¹‹å†….è‹¥å·²ç»è¶…å‡ºèŒƒå›´,åˆ™å¾ªç¯ç»“æŸ</p>
</li>
<li>
<p>è‹¥æ²¡è¶…å‡ºèŒƒå›´,åˆ™å°†æ•°å€¼æ‹·è´ç»™ç”¨æˆ·å®šä¹‰çš„å±€éƒ¨å˜é‡</p>
</li>
<li>
<p>ç„¶åè·³è½¬åˆ°å¾ªç¯ä½“å†…éƒ¨å¼€å§‹æ‰§è¡Œå…·ä½“çš„ä»£ç å—</p>
</li>
</ol>
</li>
</ul>
<h5 id="op_forprep"><span>OP_FORPREP</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A Bx	&lt;check values and prepare counters&gt;; if not to run then pc+=Bx+1;</code>  æ•°å€¼forå¾ªç¯</p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#cdcd00">for</span> i<span style="color:#39c">=</span><span style="color:#cd00cd">1</span>,<span style="color:#cd00cd">100</span>,<span style="color:#cd00cd">10</span> <span style="color:#cdcd00">do</span>  <span style="color:#39c">//</span><span style="">åˆå§‹å€¼ä¸º</span><span style="color:#cd00cd">1</span>,<span style="">æ­¥é•¿ä¸º</span><span style="color:#cd00cd">10</span>,<span style="">ä¸Šé™ä¸º</span><span style="color:#cd00cd">100</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">end</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">7</span> instructions at <span style="color:#cd00cd">00</span>A022A8)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">4</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">4</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">100</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">10</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">1</span>]     FORPREP         <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; exit to <span style="color:#cd00cd">7</span> <span style="">æ•°å€¼</span>for<span style="">å¾ªç¯</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">1</span>]     FORLOOP         <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>     ; to <span style="color:#cd00cd">6</span> <span style="">æ•°å€¼</span>for<span style="">å¾ªç¯</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div><p>è¯¥æŒ‡ä»¤çš„ç›®çš„æ˜¯åœ¨å¾ªç¯ä¹‹å‰é¢„å…ˆå°†<code>i</code>å‡å»æ­¥é•¿å¾—åˆ°<code>-1</code>,ç„¶åè·³è½¬åˆ°<code>FORLOOP</code>æŒ‡ä»¤æ­£å¼å¼€å§‹å¾ªç¯</p>
</li>
</ul>
<h5 id="op_tforprep"><span>OP_TFORPREP</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A Bx	create upvalue for R[A + 3]; pc+=Bx</code> é™¤äº†é€šç”¨forå¾ªç¯ä½œç”¨è¿˜å…¼é¡¾å…³é—­<code>upvalue</code>å€¼</p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#cdcd00">for</span> k,v <span style="color:#cdcd00">in</span> pairs(t) <span style="color:#cdcd00">do</span> 
</span></span><span style="display:flex;"><span>    print(k,v) 
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">end</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">13</span> instructions at <span style="color:#cd00cd">00</span>C22290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">9</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">6</span> locals, <span style="color:#cd00cd">3</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;pairs&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     GETTABUP        <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>   ; _ENV <span style="color:#cd0000">&#34;t&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     CALL            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">5</span>   ; <span style="color:#cd00cd">1</span> <span style="color:#cdcd00">in</span> <span style="color:#cd00cd">4</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">1</span>]     TFORPREP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">4</span>     ; to <span style="color:#cd00cd">10</span> <span style="">é™¤äº†é€šç”¨</span>for<span style="">å¾ªç¯ä½œç”¨è¿˜å…¼é¡¾å…³é—­`</span>upvalue<span style="">`å€¼</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">2</span>]     GETTABUP        <span style="color:#cd00cd">6</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">2</span>   ; _ENV <span style="color:#cd0000">&#34;print&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">2</span>]     MOVE            <span style="color:#cd00cd">7</span> <span style="color:#cd00cd">4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">8</span>       [<span style="color:#cd00cd">2</span>]     MOVE            <span style="color:#cd00cd">8</span> <span style="color:#cd00cd">5</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">9</span>       [<span style="color:#cd00cd">2</span>]     CALL            <span style="color:#cd00cd">6</span> <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">2</span> <span style="color:#cdcd00">in</span> <span style="color:#cd00cd">0</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">10</span>      [<span style="color:#cd00cd">1</span>]     TFORCALL        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">11</span>      [<span style="color:#cd00cd">1</span>]     TFORLOOP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">6</span>     ; to <span style="color:#cd00cd">6</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">12</span>      [<span style="color:#cd00cd">3</span>]     CLOSE           <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">13</span>      [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>k  ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h5 id="op_tforcall"><span>OP_TFORCALL</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A C	R[A+4], ... ,R[A+3+C] := R[A](R[A+1], R[A+2]);</code> é€šç”¨forå¾ªç¯</p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#cdcd00">for</span> k,v <span style="color:#cdcd00">in</span> pairs(t) <span style="color:#cdcd00">do</span> 
</span></span><span style="display:flex;"><span>    print(k,v) 
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">end</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">13</span> instructions at <span style="color:#cd00cd">00</span>C22290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">9</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">6</span> locals, <span style="color:#cd00cd">3</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;pairs&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     GETTABUP        <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>   ; _ENV <span style="color:#cd0000">&#34;t&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     CALL            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">5</span>   ; <span style="color:#cd00cd">1</span> <span style="color:#cdcd00">in</span> <span style="color:#cd00cd">4</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">1</span>]     TFORPREP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">4</span>     ; to <span style="color:#cd00cd">10</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">2</span>]     GETTABUP        <span style="color:#cd00cd">6</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">2</span>   ; _ENV <span style="color:#cd0000">&#34;print&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">2</span>]     MOVE            <span style="color:#cd00cd">7</span> <span style="color:#cd00cd">4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">8</span>       [<span style="color:#cd00cd">2</span>]     MOVE            <span style="color:#cd00cd">8</span> <span style="color:#cd00cd">5</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">9</span>       [<span style="color:#cd00cd">2</span>]     CALL            <span style="color:#cd00cd">6</span> <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">2</span> <span style="color:#cdcd00">in</span> <span style="color:#cd00cd">0</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">10</span>      [<span style="color:#cd00cd">1</span>]     TFORCALL        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">2</span>  <span style="">é€šç”¨</span>for<span style="">å¾ªç¯</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">11</span>      [<span style="color:#cd00cd">1</span>]     TFORLOOP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">6</span>     ; to <span style="color:#cd00cd">6</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">12</span>      [<span style="color:#cd00cd">3</span>]     CLOSE           <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">13</span>      [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>k  ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div><p>ç¼–è¯‘å™¨ä½¿ç”¨çš„ç¬¬ä¸€ä¸ªç‰¹æ®Šå˜é‡<code>(generator):f</code>å­˜æ”¾çš„æ˜¯è¿­ä»£å™¨,å…¶ä»–ä¸¤ä¸ªç‰¹æ®Šå˜é‡<code>(state):s</code> <code>(control):var</code>æ¥è°ƒç”¨è¿­ä»£å™¨</p>
<p>æŠŠç»“æœä¿å­˜åœ¨ç”¨æˆ·å®šä¹‰çš„å˜é‡<code>k,v</code>ä¸­</p>
</li>
</ul>
<h5 id="op_tforloop"><span>OP_TFORLOOP</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A Bx	if R[A+2] ~= nil then { R[A]=R[A+2]; pc -= Bx }</code> é€šç”¨forå¾ªç¯</p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#cdcd00">for</span> k,v <span style="color:#cdcd00">in</span> pairs(t) <span style="color:#cdcd00">do</span> 
</span></span><span style="display:flex;"><span>    print(k,v) 
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">end</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">13</span> instructions at <span style="color:#cd00cd">00</span>C22290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">9</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">6</span> locals, <span style="color:#cd00cd">3</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     GETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;pairs&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     GETTABUP        <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>   ; _ENV <span style="color:#cd0000">&#34;t&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     CALL            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">5</span>   ; <span style="color:#cd00cd">1</span> <span style="color:#cdcd00">in</span> <span style="color:#cd00cd">4</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">1</span>]     TFORPREP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">4</span>     ; to <span style="color:#cd00cd">10</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">2</span>]     GETTABUP        <span style="color:#cd00cd">6</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">2</span>   ; _ENV <span style="color:#cd0000">&#34;print&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">2</span>]     MOVE            <span style="color:#cd00cd">7</span> <span style="color:#cd00cd">4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">8</span>       [<span style="color:#cd00cd">2</span>]     MOVE            <span style="color:#cd00cd">8</span> <span style="color:#cd00cd">5</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">9</span>       [<span style="color:#cd00cd">2</span>]     CALL            <span style="color:#cd00cd">6</span> <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">2</span> <span style="color:#cdcd00">in</span> <span style="color:#cd00cd">0</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">10</span>      [<span style="color:#cd00cd">1</span>]     TFORCALL        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">2</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">11</span>      [<span style="color:#cd00cd">1</span>]     TFORLOOP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">6</span>     ; to <span style="color:#cd00cd">6</span> <span style="">é€šç”¨</span>for<span style="">å¾ªç¯</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">12</span>      [<span style="color:#cd00cd">3</span>]     CLOSE           <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">13</span>      [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>k  ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div><p>è‹¥è¿­ä»£å™¨è¿”å›çš„kå€¼ä¸æ˜¯<code>nil</code>ï¼Œåˆ™æŠŠè¯¥å€¼æ‹·è´åˆ°<code>(control):var</code>,ç„¶åè·³è½¬åˆ°å¾ªç¯ä½“ å¦åˆ™è‹¥ä¸º<code>nil</code>,åˆ™å¾ªç¯ç»“æŸ</p>
</li>
</ul>
<h4 id="å‡½æ•°è°ƒç”¨-1"><span>å‡½æ•°è°ƒç”¨</span></h4>
<h5 id="op_closure"><span>OP_CLOSURE</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A Bx	R[A] := closure(KPROTO[Bx])</code> <code>æ ¹æ®å‡½æ•°åŸå‹æ–°å»ºä¸€ä¸ªé—­åŒ…</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#cdcd00">function</span>
</span></span><span style="display:flex;"><span>	x() 
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">end</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">4</span> instructions at <span style="color:#cd00cd">00</span>BD22A8)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">0</span> locals, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">1</span> <span style="color:#cdcd00">function</span>
</span></span><span style="display:flex;"><span>        <span style="">1</span>       <span style="">[1]</span>     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">3</span>]     CLOSURE         <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; <span style="color:#cd00cd">00</span>BD3C08 <span style="">æ ¹æ®å‡½æ•°åŸå‹æ–°å»ºä¸€ä¸ªé—­åŒ…</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     SETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;x&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">3</span>]     RETURN          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">function</span> <span style="">&lt;</span>.<span style="">\</span><span style="color:#00cdcd">helloworld</span>.<span style="color:#00cdcd">lua</span>:<span style="">1,3&gt;</span> (<span style="color:#cd00cd">1</span> instruction at <span style="color:#cd00cd">00</span>BD3C08)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">0</span> upvalues, <span style="color:#cd00cd">0</span> locals, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">3</span>]     RETURN0
</span></span></code></pre></div></li>
</ul>
<p>â€‹		æŠŠå½“å‰<code>Lua</code>å‡½æ•°çš„å­å‡½æ•°åŸå‹å®ä¾‹åŒ–ä¸ºé—­åŒ…</p>
<h3 id="iasbxæ“ä½œæ•°æ¨¡å¼"><span>iAsBxæ“ä½œæ•°æ¨¡å¼</span></h3>
<p><img loading="lazy" src="image-20230226110806698.png" alt="image-20230226110806698"  />
</p>
<p>å ç”¨<code>bit</code>ä½èŒƒå›´</p>
<table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>èŒƒå›´(å•ä½bit)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Op(7)</td>
<td>0~6</td>
</tr>
<tr>
<td>A(8)</td>
<td>7~14</td>
</tr>
<tr>
<td>sBx(17)</td>
<td>15~31</td>
</tr>
</tbody>
</table>
<h4 id="åŠ è½½"><span>åŠ è½½</span></h4>
<h5 id="op_loadi"><span>OP_LOADI</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A sBx R[A] := sBx</code> <code>åŠ è½½æ•´å‹ç«‹å³æ•°åˆ°å¯„å­˜å™¨</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> B <span style="color:#39c">=</span> <span style="color:#cd00cd">10</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">3</span> instructions at <span style="color:#cd00cd">010</span>F2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span> <span style="">æŸ¥çœ‹å¯å˜å‚æ•°æ–¹å¼ä¸‹å›ºå®šå‚æ•°ä¸ªæ•°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">10</span>  <span style="">å°†æ•´å‹ç«‹å³æ•°</span><span style="color:#cd00cd">10</span><span style="">åŠ è½½åˆ°å¯„å­˜å™¨çš„</span><span style="color:#cd00cd">0</span><span style="">å·ä½ç½®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out <span style="">è¿”å›</span><span style="color:#cd00cd">0</span><span style="">ä¸ªå€¼</span>
</span></span></code></pre></div><p>ä¸Šé¢æ­¥éª¤å¤§æ¦‚æ„æ€</p>
<p>å°†å±€éƒ¨å˜é‡<code>B</code>åˆ†é…åˆ°å¯„å­˜å™¨<code>0</code>å·ä½ç½®</p>
<ol>
<li>ç„¶åæ‰§è¡Œ<code>VARARGPREP</code>æŒ‡ä»¤æŸ¥çœ‹ä¸‹å¯å˜å‚æ•°æ–¹å¼ä¸‹çš„å›ºå®šå‚æ•°æ•°é‡</li>
<li>å°†æ•´å‹ç«‹å³æ•°<code>10</code>åŠ è½½åˆ°å¯„å­˜å™¨çš„<code>0</code>å·ä½ç½®</li>
<li><code>0 out</code> çš„æ„æ€æ˜¯è¿”å›<code>0</code>ä¸ªå€¼</li>
</ol>
</li>
</ul>
<h5 id="op_loadf"><span>OP_LOADF</span></h5>
<ul>
<li>
<p><code>å…¬å¼</code>:<code>A sBx	R[A] := (lua_Number)sBx</code> <code>åŠ è½½æµ®ç‚¹ç«‹å³æ•°åˆ°å¯„å­˜å™¨</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> B <span style="color:#39c">=</span> <span style="color:#cd00cd">10.0</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">3</span> instructions at <span style="color:#cd00cd">010</span>F2290)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span> <span style="">æŸ¥çœ‹å¯å˜å‚æ•°æ–¹å¼ä¸‹å›ºå®šå‚æ•°ä¸ªæ•°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADF           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">10</span>  <span style="">å°†æµ®ç‚¹ç«‹å³æ•°</span><span style="color:#cd00cd">10</span><span style="">åŠ è½½åˆ°å¯„å­˜å™¨çš„</span><span style="color:#cd00cd">0</span><span style="">å·ä½ç½®</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out <span style="">è¿”å›</span><span style="color:#cd00cd">0</span><span style="">ä¸ªå€¼</span>
</span></span></code></pre></div><p>ä¸Šé¢æ­¥éª¤å¤§æ¦‚æ„æ€</p>
<p>å°†å±€éƒ¨å˜é‡<code>B</code>åˆ†é…åˆ°å¯„å­˜å™¨<code>0</code>å·ä½ç½®</p>
<ol>
<li>ç„¶åæ‰§è¡Œ<code>VARARGPREP</code>æŒ‡ä»¤æŸ¥çœ‹ä¸‹å¯å˜å‚æ•°æ–¹å¼ä¸‹çš„å›ºå®šå‚æ•°æ•°é‡</li>
<li>å°†ç«‹å³æ•°<code>10</code>åŠ è½½åˆ°å¯„å­˜å™¨çš„<code>0</code>å·ä½ç½®</li>
<li><code>0 out</code> çš„æ„æ€æ˜¯è¿”å›<code>0</code>ä¸ªå€¼</li>
</ol>
</li>
</ul>
<h3 id="iaxæ“ä½œæ•°æ¨¡å¼"><span>iAxæ“ä½œæ•°æ¨¡å¼</span></h3>
<p><img loading="lazy" src="image-20230228101415667.png" alt="image-20230228101415667"  />
</p>
<p>å ç”¨<code>bit</code>ä½èŒƒå›´</p>
<table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>èŒƒå›´(å•ä½bit)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Op(7)</td>
<td>0~6</td>
</tr>
<tr>
<td>Ax(25)</td>
<td>7~31</td>
</tr>
</tbody>
</table>
<h4 id="é¢å¤–å‚æ•°"><span>é¢å¤–å‚æ•°</span></h4>
<h5 id="op_extraarg"><span>OP_EXTRAARG</span></h5>
<p><code>Ax</code>çš„ä½æ•°æ˜¯<code>25</code>ä½,é‚£ä¹ˆèƒ½æ ‡è¯†çš„æ— ç¬¦å·æœ€å¤§å€¼æ˜¯<code>25</code>ä¸ª<code>1</code> ä¹Ÿå°±æ˜¯<code>2^25-1</code> = <code>67108863</code>ä¸ªç´¢å¼•</p>
<p>æ‰€ä»¥å½“<code>OP_LOADKX</code>æŒ‡ä»¤ç´¢å¼•ä¸å¤Ÿçš„æ—¶å€™,ä¹Ÿç”¨è¿™ä¸ªæŒ‡ä»¤ç»­ç´¢å¼•,OP_LOADKXå¼€è¾Ÿçš„æŒ‡ä»¤ç´¢å¼•åŠ è½½è¿™ä¸ªé¢å¤–æ‰©å±•çš„ç´¢å¼•è¶³å¤Ÿä½¿ç”¨äº†</p>
<h3 id="isjæ“ä½œæ•°æ¨¡å¼"><span>isJæ“ä½œæ•°æ¨¡å¼</span></h3>
<p><img loading="lazy" src="image-20230227200602942.png" alt="image-20230227200602942"  />
</p>
<p>å ç”¨<code>bit</code>ä½èŒƒå›´</p>
<table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>èŒƒå›´(å•ä½bit)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Op(7)</td>
<td>0~6</td>
</tr>
<tr>
<td>sJ(25)</td>
<td>7~31</td>
</tr>
</tbody>
</table>
<h4 id="åˆ†æ”¯ä¸è·³è½¬-1"><span>åˆ†æ”¯ä¸è·³è½¬</span></h4>
<h5 id="op_jmp"><span>OP_JMP</span></h5>
<ul>
<li>
<p><code>OP_EQ</code> <code>OP_LT</code> <code>OP_LE</code>  <code>OP_EQK</code> <code>OP_EQI</code> <code>OP_LTI</code> <code>OP_LEI</code> <code>OP_GTI</code>  <code>OP_GEI</code> <code>OP_TEST</code>  <code>OP_TESTSET</code>  11ä¸ªåˆ†æ”¯æŒ‡ä»¤å¿…é¡»ä¸åé¢çš„ç´§æŒ¨çš„<code>JMP</code>æŒ‡ä»¤çœ‹åšä¸€ä½“.å½“æ¡ä»¶æˆç«‹æ—¶,ç»§ç»­è¿è¡Œ,æ¡ä»¶ä¸æˆç«‹æ—¶,è·³è½¬åˆ°æŒ‡å®šä½ç½®</p>
</li>
<li>
<p><code>å…¬å¼</code>:<code>sJ	pc += sJ</code> <code>æ— æ¡ä»¶è·³è½¬</code></p>
</li>
<li>
<p><code>lua</code>ç¤ºä¾‹ä»£ç </p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#00cd00">local</span> a <span style="color:#39c">=</span> <span style="color:#cd00cd">5</span> <span style="color:#39c">&lt;</span> <span style="color:#cd00cd">2</span>
</span></span></code></pre></div><p>æ‰§è¡Œ<code>luac54 -l Helloworld.lua</code>ç»“æœ</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">1</span> <span style="color:#00cd00">local</span>, <span style="color:#cd00cd">0</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     LOADI           <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     LTI             <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">5</span> <span style="color:#cd00cd">1</span> <span style="">æ¯”è¾ƒå¤§å°</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">1</span>]     JMP             <span style="color:#cd00cd">1</span>       ; to <span style="color:#cd00cd">6</span> <span style="">è¿›è¡Œè·³è½¬</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">1</span>]     LFALSESKIP      <span style="color:#cd00cd">0</span>	
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">1</span>]     LOADTRUE        <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">1</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div></li>
</ul>
<h2 id="æŒ‡ä»¤å±æ€§çš„æ©ç "><span>æŒ‡ä»¤å±æ€§çš„æ©ç </span></h2>
<p><img loading="lazy" src="image-20230226165711463.png" alt="image-20230226165711463"  />
</p>
<table>
<thead>
<tr>
<th>bitä½</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>0~2</td>
<td>æŒ‡ä»¤çš„ç±»å‹ ä¹Ÿå°±æ˜¯è¿™äº› {iABC, iABx, iAsBx, iAx, isJ}</td>
</tr>
<tr>
<td>3</td>
<td>æŒ‡ä»¤æ˜¯å¦ä¿®æ”¹äº†å¯„å­˜å™¨A</td>
</tr>
<tr>
<td>4</td>
<td>åˆ¤æ–­å½“å‰æŒ‡ä»¤æ˜¯å¦æ¶‰åŠä¸€æ¬¡æ¡ä»¶è·³è½¬ <br />å¢åŠ è¿™ä¸ªæ ‡è®°å¯ä»¥ç”¨æ¥æ£€æµ‹åˆ†æ”¯æŒ‡ä»¤è¿™ä¸€ä¸ªæ‰“çš„ç±»åˆ«,<br />è¿™æ ·ç®€åŒ–äº†æŒ‡ä»¤é›†,å½“é‡åˆ°è·³è½¬æŒ‡ä»¤çš„æ—¶å€™,<br />å¯ä»¥å›åˆ°å‰ä¸€æ¡æŒ‡ä»¤æ¥çœ‹çœ‹é‚£æ˜¯å¦æ˜¯æ¡ä»¶è·³è½¬</td>
</tr>
<tr>
<td>5</td>
<td>ä½¿ç”¨å‰ä¸€æ¡æŒ‡ä»¤è®¾ç½®çš„æ ˆé¡¶å€¼ï¼ˆå½“ B == 0 æ—¶ï¼‰</td>
</tr>
<tr>
<td>6</td>
<td>å°†å€¼æ”¾åˆ°æ ˆé¡¶,ä¾›åé¢çš„æŒ‡ä»¤ä½¿ç”¨ï¼ˆå½“C == 0æ—¶ï¼‰</td>
</tr>
<tr>
<td>7</td>
<td>æŒ‡ä»¤æ˜¯MMæŒ‡ä»¤ï¼ˆè°ƒç”¨å…ƒæ–¹æ³•ï¼‰</td>
</tr>
</tbody>
</table>
<h2 id="æŒ‡ä»¤çš„åˆ›å»º"><span>æŒ‡ä»¤çš„åˆ›å»º</span></h2>
<h3 id="åˆ›å»ºabckæŒ‡ä»¤"><span>åˆ›å»ºABCKæŒ‡ä»¤</span></h3>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#000080">#define CREATE_ABCk(o,a,b,c,k)	((cast(Instruction, o)&lt;&lt;POS_OP) \
</span></span></span><span style="display:flex;"><span><span style="color:#000080">			| (cast(Instruction, a)&lt;&lt;POS_A) \
</span></span></span><span style="display:flex;"><span><span style="color:#000080">			| (cast(Instruction, b)&lt;&lt;POS_B) \
</span></span></span><span style="display:flex;"><span><span style="color:#000080">			| (cast(Instruction, c)&lt;&lt;POS_C) \
</span></span></span><span style="display:flex;"><span><span style="color:#000080">			| (cast(Instruction, k)&lt;&lt;POS_k))
</span></span></span></code></pre></div><h3 id="åˆ›å»ºabxæŒ‡ä»¤"><span>åˆ›å»ºABxæŒ‡ä»¤</span></h3>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#000080">#define CREATE_ABx(o,a,bc)	((cast(Instruction, o)&lt;&lt;POS_OP) \
</span></span></span><span style="display:flex;"><span><span style="color:#000080">			| (cast(Instruction, a)&lt;&lt;POS_A) \
</span></span></span><span style="display:flex;"><span><span style="color:#000080">			| (cast(Instruction, bc)&lt;&lt;POS_Bx))
</span></span></span></code></pre></div><h3 id="åˆ›å»ºaxæŒ‡ä»¤"><span>åˆ›å»ºAxæŒ‡ä»¤</span></h3>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#000080">#define CREATE_Ax(o,a)		((cast(Instruction, o)&lt;&lt;POS_OP) \
</span></span></span><span style="display:flex;"><span><span style="color:#000080">			| (cast(Instruction, a)&lt;&lt;POS_Ax))
</span></span></span></code></pre></div><h3 id="åˆ›å»ºsjæŒ‡ä»¤"><span>åˆ›å»ºsJæŒ‡ä»¤</span></h3>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#000080">#define CREATE_sJ(o,j,k)	((cast(Instruction, o) &lt;&lt; POS_OP) \
</span></span></span><span style="display:flex;"><span><span style="color:#000080">			| (cast(Instruction, j) &lt;&lt; POS_sJ) \
</span></span></span><span style="display:flex;"><span><span style="color:#000080">			| (cast(Instruction, k) &lt;&lt; POS_k))
</span></span></span></code></pre></div><p>å¯ä»¥å‘ç°å…¶å®æŒ‡ä»¤çš„åˆ›å»ºéƒ½æ˜¯ä½¿ç”¨çš„å®å’Œæˆ–è¿ç®—è¿›è¡Œç»„åˆ,è€Œä¸”ä¹Ÿæ˜¯ä¸¥æ ¼æŒ‰ç…§å¦‚ä¸‹å›¾ç¼–ç æ–¹å¼åˆ›å»ºçš„</p>
<p><img loading="lazy" src="image-20230223204632470.png" alt="image-20230223204632470"  />
</p>
<h2 id="luacå‘½ä»¤"><span>luacå‘½ä»¤</span></h2>
<h3 id="luac54--l-helloworldluaå‘½ä»¤"><span>luac54 -l Helloworld.luaå‘½ä»¤</span></h3>
<p><img loading="lazy" src="image-20230224175942244.png" alt="image-20230224175942244"  />
</p>
<p>æ¯”å¦‚æˆ‘ä»¬å¯¹è¿™ä¸ª<code>helloworld.lua</code>ä½¿ç”¨<code>luac54 -l Helloworld.lua</code>æŸ¥çœ‹æŒ‡ä»¤é›†å‘½ä»¤,å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯</p>
<p><img loading="lazy" src="image-20230224215319200.png" alt="image-20230224215319200"  />
</p>
<ul>
<li>
<p><code>1</code>å·ä½ç½®</p>
<ul>
<li>
<p>ç¬¬ä¸€è¡Œå¦‚æœæ˜¯<code>main</code>,è¯´æ˜æ˜¯ç¼–è¯‘å™¨ç»™æˆ‘ä»¬æ·»åŠ çš„ä¸»å‡½æ•°,å¯¹äºä¸»å‡½æ•°èµ·æ­¢éƒ½æ˜¯<code>0</code>,å¯¹äº<code>æ™®é€šå‡½æ•°</code>å°±æ˜¯æ–‡ä»¶å†…éƒ¨çš„èµ·æ­¢è¡Œå·</p>
</li>
<li>
<p>å¦‚æœæ˜¯<code>function</code>,é‚£å°±è¯´æ˜æ˜¯æˆ‘ä»¬è‡ªå·±çš„å®šä¹‰çš„æ™®é€šå‡½æ•°,æ¯”å¦‚ä¸‹é¢å†™æ³•</p>
<p><img loading="lazy" src="image-20230225144230820.png" alt="image-20230225144230820"  />
</p>
<p><img loading="lazy" src="image-20230225144316846.png" alt="image-20230225144316846"  />
</p>
</li>
<li>
<p><img loading="lazy" src="image-20230225143326441.png" alt="image-20230225143326441"  />
è¿™ä¸ªè¡¨ç¤ºå¸¦æ–‡ä»¶è·¯å¾„çš„æºæ–‡ä»¶å,å’Œå‡½æ•°åœ¨æ–‡ä»¶ä¸­çš„èµ·æ­¢è¡Œå·</p>
</li>
<li>
<p><img loading="lazy" src="image-20230225143359633.png" alt="image-20230225143359633"  />
è¡¨ç¤ºå½“å‰å‡½æ•°çš„æŒ‡ä»¤ä¸ªæ•°,å‡½æ•°åœ°å€</p>
</li>
</ul>
</li>
<li>
<p><code>2</code>å·ä½ç½®</p>
<ul>
<li><img loading="lazy" src="image-20230225144747738.png" alt="image-20230225144747738"  />
è¡¨ç¤ºæ˜¯å›ºå®šå‚æ•°æ•°é‡,å¦‚æœæœ‰<code>+</code>å·ä»£è¡¨æ˜¯ä¸ªå¯å˜å‚æ•°å‡½æ•°</li>
<li><img loading="lazy" src="image-20230225145002452.png" alt="image-20230225145002452"  />
å¯„å­˜å™¨æ•°é‡</li>
<li><img loading="lazy" src="image-20230225145302707.png" alt="image-20230225145302707"  />
ä¸Šå€¼æ•°é‡</li>
<li><img loading="lazy" src="image-20230225145316817.png" alt="image-20230225145316817"  />
å±€éƒ¨å˜é‡æ•°é‡</li>
<li><img loading="lazy" src="image-20230225145327832.png" alt="image-20230225145327832"  />
å¸¸é‡æ•°é‡</li>
<li><img loading="lazy" src="image-20230225145340303.png" alt="image-20230225145340303"  />
å­å‡½æ•°æ•°é‡</li>
</ul>
</li>
<li>
<p><code>3</code>å·ä½ç½®</p>
<p>ä¸‹é¢æŠŠæ¯åˆ—åšä»€ä¹ˆçš„éƒ½å†™å‡ºæ¥</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="">åºå·</span>     <span style="">ä»£ç è¡Œå·</span>  <span style="">æ“ä½œç </span>          <span style="">æ“ä½œæ•°</span>   <span style="">æ³¨é‡Š</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">1</span>]     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">1</span>]     NEWTABLE        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>   ; <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">1</span>]     EXTRAARG        <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">2</span>]     SETI            <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">0</span>k  ; <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">3</span>]     LOADI           <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">3</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">5</span>]     LOADI           <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">5</span>]     SETLIST         <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">8</span>       [<span style="color:#cd00cd">7</span>]     GETTABUP        <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>   ; _ENV <span style="color:#cd0000">&#34;ipairs&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">9</span>       [<span style="color:#cd00cd">7</span>]     MOVE            <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">10</span>      [<span style="color:#cd00cd">7</span>]     CALL            <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">5</span>   ; <span style="color:#cd00cd">1</span> <span style="color:#cdcd00">in</span> <span style="color:#cd00cd">4</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">11</span>      [<span style="color:#cd00cd">7</span>]     TFORPREP        <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">4</span>     ; to <span style="color:#cd00cd">16</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">12</span>      [<span style="color:#cd00cd">8</span>]     GETTABUP        <span style="color:#cd00cd">7</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">2</span>   ; _ENV <span style="color:#cd0000">&#34;print&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">13</span>      [<span style="color:#cd00cd">8</span>]     MOVE            <span style="color:#cd00cd">8</span> <span style="color:#cd00cd">5</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">14</span>      [<span style="color:#cd00cd">8</span>]     MOVE            <span style="color:#cd00cd">9</span> <span style="color:#cd00cd">6</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">15</span>      [<span style="color:#cd00cd">8</span>]     CALL            <span style="color:#cd00cd">7</span> <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">2</span> <span style="color:#cdcd00">in</span> <span style="color:#cd00cd">0</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">16</span>      [<span style="color:#cd00cd">7</span>]     TFORCALL        <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">17</span>      [<span style="color:#cd00cd">7</span>]     TFORLOOP        <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">6</span>     ; to <span style="color:#cd00cd">12</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">18</span>      [<span style="color:#cd00cd">9</span>]     CLOSE           <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">19</span>      [<span style="color:#cd00cd">9</span>]     RETURN          <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>k  ; <span style="color:#cd00cd">0</span> out
</span></span></code></pre></div><p>æ“ä½œæ•°é‚£ä¸€åˆ—ä¸­çš„æ¯ä¸€å°åˆ—å°±æ˜¯å¦‚ä¸‹å›¾é™¤å¼€<code>0p(7)</code>å‰©ä¸‹çš„å¯¹åº”æ“ä½œæ¨¡å¼<code>bit</code>ä½çš„åˆ†å¸ƒ</p>
<p><img loading="lazy" src="image-20230223204632470.png" alt="image-20230223204632470"  />
</p>
<p>æ¯”å¦‚ä¸Šé¢çš„ç¬¬ä¸€è¡Œ<code> 1       [1]     VARARGPREP      0</code>æŒ‡ä»¤å¯¹åº”çš„æ˜¯<code>iAx</code>æ“ä½œæ•°æ¨¡å¼,æ‰€ä»¥ä»–åªæœ‰ä¸€ä¸ªå‚æ•°<code>0</code></p>
</li>
</ul>
<h3 id="luac54--l--l-helloworldlua"><span>luac54 -l -l Helloworld.lua</span></h3>
<p>é€šè¿‡è¿™ä¸ªå‘½ä»¤é™¤äº†<code>luac54 -l Helloworld.lua</code>å‘½ä»¤å†…å®¹å¤–,è¿˜èƒ½æŠŠ<code>å¸¸é‡è¡¨</code>,<code>å±€éƒ¨å˜é‡è¡¨</code>å’Œ <code>upvalue è¡¨</code>çš„ä¿¡æ¯æ‰“å°å‡ºæ¥</p>
<p><img loading="lazy" src="image-20230225160444424.png" alt="image-20230225160444424"  />
</p>
<div class="highlight"><pre tabindex="0" style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>main <span style="color:#39c">&lt;</span>.<span style="">\</span>helloworld.lua:<span style="color:#cd00cd">0</span>,<span style="color:#cd00cd">0</span><span style="color:#39c">&gt;</span> (<span style="color:#cd00cd">4</span> instructions at <span style="color:#cd00cd">008422E8</span>)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">0</span><span style="color:#39c">+</span> params, <span style="color:#cd00cd">2</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">0</span> locals, <span style="color:#cd00cd">1</span> constant, <span style="color:#cd00cd">1</span> <span style="color:#cdcd00">function</span>
</span></span><span style="display:flex;"><span>        <span style="">1</span>       <span style="">[1]</span>     VARARGPREP      <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">12</span>]    CLOSURE         <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>     ; <span style="color:#cd00cd">00843</span>C48
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">2</span>]     SETTABUP        <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">0</span>   ; _ENV <span style="color:#cd0000">&#34;test&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">12</span>]    RETURN          <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">0</span> out
</span></span><span style="display:flex;"><span>constants (<span style="color:#cd00cd">1</span>) <span style="color:#cdcd00">for</span> <span style="color:#cd00cd">008422E8</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">0</span>       S       <span style="color:#cd0000">&#34;test&#34;</span>
</span></span><span style="display:flex;"><span>locals (<span style="color:#cd00cd">0</span>) <span style="color:#cdcd00">for</span> <span style="color:#cd00cd">008422E8</span>:
</span></span><span style="display:flex;"><span>upvalues (<span style="color:#cd00cd">1</span>) <span style="color:#cdcd00">for</span> <span style="color:#cd00cd">008422E8</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">0</span>       _ENV    <span style="color:#cd00cd">1</span>       <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cdcd00">function</span> <span style="">&lt;</span>.<span style="">\</span><span style="color:#00cdcd">helloworld</span>.<span style="color:#00cdcd">lua</span>:<span style="">2,12&gt;</span> (<span style="color:#cd00cd">19</span> instructions at <span style="color:#cd00cd">00843</span>C48)
</span></span><span style="display:flex;"><span><span style="color:#cd00cd">1</span><span style="color:#39c">+</span> param, <span style="color:#cd00cd">11</span> slots, <span style="color:#cd00cd">1</span> upvalue, <span style="color:#cd00cd">8</span> locals, <span style="color:#cd00cd">3</span> constants, <span style="color:#cd00cd">0</span> functions
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       [<span style="color:#cd00cd">2</span>]     VARARGPREP      <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       [<span style="color:#cd00cd">3</span>]     NEWTABLE        <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>   ; <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       [<span style="color:#cd00cd">3</span>]     EXTRAARG        <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       [<span style="color:#cd00cd">4</span>]     SETI            <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">0</span>k  ; <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       [<span style="color:#cd00cd">5</span>]     LOADI           <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">3</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       [<span style="color:#cd00cd">7</span>]     LOADI           <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       [<span style="color:#cd00cd">7</span>]     SETLIST         <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">8</span>       [<span style="color:#cd00cd">9</span>]     GETTABUP        <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">1</span>   ; _ENV <span style="color:#cd0000">&#34;ipairs&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">9</span>       [<span style="color:#cd00cd">9</span>]     MOVE            <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">10</span>      [<span style="color:#cd00cd">9</span>]     CALL            <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">5</span>   ; <span style="color:#cd00cd">1</span> <span style="color:#cdcd00">in</span> <span style="color:#cd00cd">4</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">11</span>      [<span style="color:#cd00cd">9</span>]     TFORPREP        <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">4</span>     ; to <span style="color:#cd00cd">16</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">12</span>      [<span style="color:#cd00cd">10</span>]    GETTABUP        <span style="color:#cd00cd">8</span> <span style="color:#cd00cd">0</span> <span style="color:#cd00cd">2</span>   ; _ENV <span style="color:#cd0000">&#34;print&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">13</span>      [<span style="color:#cd00cd">10</span>]    MOVE            <span style="color:#cd00cd">9</span> <span style="color:#cd00cd">6</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">14</span>      [<span style="color:#cd00cd">10</span>]    MOVE            <span style="color:#cd00cd">10</span> <span style="color:#cd00cd">7</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">15</span>      [<span style="color:#cd00cd">10</span>]    CALL            <span style="color:#cd00cd">8</span> <span style="color:#cd00cd">3</span> <span style="color:#cd00cd">1</span>   ; <span style="color:#cd00cd">2</span> <span style="color:#cdcd00">in</span> <span style="color:#cd00cd">0</span> out
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">16</span>      [<span style="color:#cd00cd">9</span>]     TFORCALL        <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">17</span>      [<span style="color:#cd00cd">9</span>]     TFORLOOP        <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">6</span>     ; to <span style="color:#cd00cd">12</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">18</span>      [<span style="color:#cd00cd">11</span>]    CLOSE           <span style="color:#cd00cd">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">19</span>      [<span style="color:#cd00cd">12</span>]    RETURN          <span style="color:#cd00cd">2</span> <span style="color:#cd00cd">1</span> <span style="color:#cd00cd">2</span>k  ; <span style="color:#cd00cd">0</span> out
</span></span><span style="display:flex;"><span>constants (<span style="color:#cd00cd">3</span>) <span style="color:#cdcd00">for</span> <span style="color:#cd00cd">00843</span>C48:
</span></span><span style="display:flex;"><span>       <span style="">åºå·</span>     <span style="">å¸¸é‡åç±»å‹</span>    <span style="">å¸¸é‡å</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">0</span>       I       <span style="color:#cd00cd">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       S       <span style="color:#cd0000">&#34;ipairs&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       S       <span style="color:#cd0000">&#34;print&#34;</span>
</span></span><span style="display:flex;"><span>locals (<span style="color:#cd00cd">8</span>) <span style="color:#cdcd00">for</span> <span style="color:#cd00cd">00843</span>C48:
</span></span><span style="display:flex;"><span>       <span style="">åºå·</span>     <span style="">å˜é‡åå­—</span>  <span style="">èµ·å§‹æŒ‡ä»¤åºå·</span>      <span style="">ç»ˆæ­¢æŒ‡ä»¤åºå·</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">0</span>       var1    	    <span style="color:#cd00cd">1</span>           <span style="color:#cd00cd">20</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">1</span>       reward  	    <span style="color:#cd00cd">8</span>           <span style="color:#cd00cd">20</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">2</span>       (<span style="color:#cdcd00">for</span> state)     <span style="color:#cd00cd">11</span>           <span style="color:#cd00cd">19</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">3</span>       (<span style="color:#cdcd00">for</span> state)     <span style="color:#cd00cd">11</span>           <span style="color:#cd00cd">19</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">4</span>       (<span style="color:#cdcd00">for</span> state)     <span style="color:#cd00cd">11</span>           <span style="color:#cd00cd">19</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">5</span>       (<span style="color:#cdcd00">for</span> state)     <span style="color:#cd00cd">11</span>           <span style="color:#cd00cd">19</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">6</span>       k       	    <span style="color:#cd00cd">12</span>           <span style="color:#cd00cd">16</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">7</span>       v       	    <span style="color:#cd00cd">12</span>           <span style="color:#cd00cd">16</span>
</span></span><span style="display:flex;"><span>upvalues (<span style="color:#cd00cd">1</span>) <span style="color:#cdcd00">for</span> <span style="color:#cd00cd">00843</span>C48:
</span></span><span style="display:flex;"><span>        <span style="">åºå·</span>    upvalue<span style="">å</span>     <span style="">æŒ‡æ˜è¿™ä¸ªä¸Šå€¼å­˜åœ¨å“ªé‡Œ</span>                  	     <span style="">æŒ‡æ˜è¿™ä¸ªä¸Šå€¼å­˜åœ¨ä½ç½®çš„ç´¢å¼•</span>
</span></span><span style="display:flex;"><span>        				    <span style="color:#cd00cd">1</span>:<span style="">è¡¨ç¤ºåœ¨æ ˆä¸­åˆ›å»ºå­˜åœ¨ä¸Šå±‚å‡½æ•°çš„å±€éƒ¨å˜é‡è¡¨ä¸­</span>    <span style="">å¦‚æœä½ç½®æ˜¯åœ¨æ ˆä¸­åœ¨ä¸Šå±‚å‡½æ•°çš„å±€éƒ¨å˜é‡è¡¨ä¸­çš„ç´¢å¼•</span>
</span></span><span style="display:flex;"><span>        				    <span style="color:#cd00cd">0</span>:<span style="">è¡¨è¿°ä¸åœ¨æ ˆä¸­åœ¨ä¸Šå±‚å‡½æ•°çš„</span>upvalues<span style="">åˆ—è¡¨ä¸­</span>     <span style="">å¦‚æœä¸æ˜¯æ ˆä¸­</span>,<span style="">é‚£ä¹ˆå°±åœ¨ä¸Šå±‚å‡½æ•°çš„</span>upvalues<span style="">è¡¨ä¸­çš„ç´¢å¼•</span>	
</span></span><span style="display:flex;"><span>        <span style="color:#cd00cd">0</span>       _ENV    		<span style="color:#cd00cd">0</span>       						 					<span style="color:#cd00cd">0</span>
</span></span></code></pre></div>

        </div>
        <div class="post-reward">
            <div style="padding: 0 0 0 0; margin: 0 0 0 0; width: 100%; font-size:16px; text-align: center;">
                <div id="QR" style="opacity: 0;">
                    <div id="wechat" style="display: inline-block">
                        <a class="fancybox" rel="group">
                            <img id="wechat_qr" src="https://frog-game.github.io/img/wechat_pay.png" alt="wechat_pay"></a>
                        <p>å¾®ä¿¡</p>
                    </div>
                    <div id="alipay" style="display: inline-block">
                        <a class="fancybox" rel="group">
                            <img id="alipay_qr" src="https://frog-game.github.io/img/alipay_pay.png" alt="alipay"></a>
                        <p>æ”¯ä»˜å®</p>
                    </div>
                </div>
                <button id="rewardButton"
                        onclick="
                    var qr = document.getElementById('QR');
                    if (qr.style.opacity === '0') {
                        qr.style.opacity='1';
                    } else {
                        qr.style.opacity='0'
                    }"
                >
                    <span>ğŸ§§ é¼“åŠ±</span>
                </button>
            </div>
        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="prev" href="https://frog-game.github.io/posts/read/lua5.4.4.matatable/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>[Lua5.4.4æºç ].å…ƒè¡¨</span>
  </a>
  <a class="next" href="https://frog-game.github.io/posts/read/lua5.4.4.gc/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>[Lua5.4.4æºç ].GC</span>
  </a>
</nav>

        </footer>
    </div>



<div>
    <div class="pagination__title">
        <span class="pagination__title-h" style="font-size: 20px;">ğŸ’¬è¯„è®º</span>
        <hr />
    </div>

    <div id="tcomment"></div>

    <script src="https://cdn.staticfile.org/twikoo/1.6.7/twikoo.all.min.js">
    </script>
    

    

    <script>
        twikoo.init({
            envId: "https://www.frog-game.work/", 
            el: "#tcomment",
            lang: 'zh-CN',
            region: "ap-beijing",
            path: window.TWIKOO_MAGIC_PATH||window.location.pathname,
            
            
            
            
            
            
            
        });
    </script>

</div>
</article>
</main>


<script async src="https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js"></script>


<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<footer class="footer">
    <span>
        Copyright
        &copy;
        2020-2023 
        <a href="https://frog-game.github.io/" style="color:#939393;">frog&#39;s Blog</a>
         All Rights Reserved
    </span>

    <a href="https://beian.miit.gov.cn/" target="_blank" style="color:#939393;">å¤‡æ¡ˆå·</a>&nbsp;

    <span>
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null"style="display:inline-block;text-decoration:none;height:20px;color:#939393;">
            <img src="https://frog-game.github.io/img/beian.png" style="float:left;margin: 0px 5px 0px 0px;"/>
            å…¬ç½‘å®‰å¤‡
        </a>
    </span>

    <span id="busuanzi_container">
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
        æ€»è®¿å®¢æ•°: <span id="busuanzi_value_site_uv"></span>
        æ€»è®¿é—®é‡: <span id="busuanzi_value_site_pv"></span>
    </span>
    
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 400 || document.documentElement.scrollTop > 400) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"frog's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                    '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"frog's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                    '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'ğŸ“„å¤åˆ¶';

        function copyingDone() {
            copybutton.innerText = 'ğŸ‘ŒğŸ»å·²å¤åˆ¶!';
            setTimeout(() => {
                copybutton.innerText = 'ğŸ“„å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"frog's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                    '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {
            }
            ;
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
